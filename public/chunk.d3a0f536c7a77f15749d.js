/*! For license information please see chunk.d3a0f536c7a77f15749d.js.LICENSE.txt */
(self.webpackChunkai_workout_assistant=self.webpackChunkai_workout_assistant||[]).push([[572],{20264:function(t,e,n){(function(){"use strict";var t;function e(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var r="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t},i=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof n.g&&n.g];for(var e=0;e<t.length;++e){var r=t[e];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function o(t,e){if(e)t:{var n=i;t=t.split(".");for(var o=0;o<t.length-1;o++){var a=t[o];if(!(a in n))break t;n=n[a]}(e=e(o=n[t=t[t.length-1]]))!=o&&null!=e&&r(n,t,{configurable:!0,writable:!0,value:e})}}function a(t){return(t={next:t})[Symbol.iterator]=function(){return this},t}function s(t){var n="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return n?n.call(t):{next:e(t)}}function u(t){if(!(t instanceof Array)){t=s(t);for(var e,n=[];!(e=t.next()).done;)n.push(e.value);t=n}return t}o("Symbol",(function(t){function e(t,e){this.g=t,r(this,"description",{configurable:!0,writable:!0,value:e})}if(t)return t;e.prototype.toString=function(){return this.g};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return function t(r){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new e(n+(r||"")+"_"+i++,r)}})),o("Symbol.iterator",(function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var n="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),o=0;o<n.length;o++){var s=i[n[o]];"function"==typeof s&&"function"!=typeof s.prototype[t]&&r(s.prototype,t,{configurable:!0,writable:!0,value:function(){return a(e(this))}})}return t}));var l,h="function"==typeof Object.create?Object.create:function(t){function e(){}return e.prototype=t,new e};if("function"==typeof Object.setPrototypeOf)l=Object.setPrototypeOf;else{var c;t:{var d={};try{d.__proto__={a:!0},c=d.a;break t}catch(t){}c=!1}l=c?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var f=l;function p(t,e){if(t.prototype=h(e.prototype),t.prototype.constructor=t,f)f(t,e);else for(var n in e)if("prototype"!=n)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(e,n);r&&Object.defineProperty(t,n,r)}else t[n]=e[n];t.ea=e.prototype}function g(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.s=this.m=0,this.j=null}function m(t){if(t.l)throw new TypeError("Generator is already running");t.l=!0}function x(t,e){t.j={U:e,V:!0},t.g=t.m||t.s}function y(t,e,n){return t.g=n,{value:e}}function v(t){this.g=new g,this.h=t}function w(t,e,n,r){try{var i=e.call(t.g.i,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return t.g.l=!1,i;var o=i.value}catch(e){return t.g.i=null,x(t.g,e),b(t)}return t.g.i=null,r.call(t.g,o),b(t)}function b(t){for(;t.g.g;)try{var e=t.h(t.g);if(e)return t.g.l=!1,{value:e.value,done:!1}}catch(e){t.g.h=void 0,x(t.g,e)}if(t.g.l=!1,t.g.j){if(e=t.g.j,t.g.j=null,e.V)throw e.U;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function C(t){this.next=function(e){return m(t.g),t.g.i?e=w(t,t.g.i.next,e,t.g.o):(t.g.o(e),e=b(t)),e},this.throw=function(e){return m(t.g),t.g.i?e=w(t,t.g.i.throw,e,t.g.o):(x(t.g,e),e=b(t)),e},this.return=function(e){return function(t,e){m(t.g);var n=t.g.i;return n?w(t,"return"in n?n.return:function(t){return{value:t,done:!0}},e,t.g.return):(t.g.return(e),b(t))}(t,e)},this[Symbol.iterator]=function(){return this}}function T(t){return function(t){function e(e){return t.next(e)}function n(e){return t.throw(e)}return new Promise((function(r,i){!function t(o){o.done?r(o.value):Promise.resolve(o.value).then(e,n).then(t,i)}(t.next())}))}(new C(new v(t)))}g.prototype.o=function(t){this.h=t},g.prototype.return=function(t){this.j={return:t},this.g=this.s},o("Promise",(function(t){function e(t){this.h=0,this.i=void 0,this.g=[],this.o=!1;var e=this.j();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function n(){this.g=null}function r(t){return t instanceof e?t:new e((function(e){e(t)}))}if(t)return t;n.prototype.h=function(t){if(null==this.g){this.g=[];var e=this;this.i((function(){e.l()}))}this.g.push(t)};var o=i.setTimeout;n.prototype.i=function(t){o(t,0)},n.prototype.l=function(){for(;this.g&&this.g.length;){var t=this.g;this.g=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.j(t)}}}this.g=null},n.prototype.j=function(t){this.i((function(){throw t}))},e.prototype.j=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.C),reject:t(this.l)}},e.prototype.C=function(t){if(t===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.F(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.v(t):this.m(t)}},e.prototype.v=function(t){var e=void 0;try{e=t.then}catch(t){return void this.l(t)}"function"==typeof e?this.G(e,t):this.m(t)},e.prototype.l=function(t){this.s(2,t)},e.prototype.m=function(t){this.s(1,t)},e.prototype.s=function(t,e){if(0!=this.h)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.h);this.h=t,this.i=e,2===this.h&&this.D(),this.A()},e.prototype.D=function(){var t=this;o((function(){if(t.B()){var e=i.console;void 0!==e&&e.error(t.i)}}),1)},e.prototype.B=function(){if(this.o)return!1;var t=i.CustomEvent,e=i.Event,n=i.dispatchEvent;return void 0===n||("function"==typeof t?t=new t("unhandledrejection",{cancelable:!0}):"function"==typeof e?t=new e("unhandledrejection",{cancelable:!0}):(t=i.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,t),t.promise=this,t.reason=this.i,n(t))},e.prototype.A=function(){if(null!=this.g){for(var t=0;t<this.g.length;++t)a.h(this.g[t]);this.g=null}};var a=new n;return e.prototype.F=function(t){var e=this.j();t.J(e.resolve,e.reject)},e.prototype.G=function(t,e){var n=this.j();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{i(t(e))}catch(t){o(t)}}:e}var i,o,a=new e((function(t,e){i=t,o=e}));return this.J(r(t,i),r(n,o)),a},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.J=function(t,e){function n(){switch(r.h){case 1:t(r.i);break;case 2:e(r.i);break;default:throw Error("Unexpected state: "+r.h)}}var r=this;null==this.g?a.h(n):this.g.push(n),this.o=!0},e.resolve=r,e.reject=function(t){return new e((function(e,n){n(t)}))},e.race=function(t){return new e((function(e,n){for(var i=s(t),o=i.next();!o.done;o=i.next())r(o.value).J(e,n)}))},e.all=function(t){var n=s(t),i=n.next();return i.done?r([]):new e((function(t,e){function o(e){return function(n){a[e]=n,0==--s&&t(a)}}var a=[],s=0;do{a.push(void 0),s++,r(i.value).J(o(a.length-1),e),i=n.next()}while(!i.done)}))},e}));var E="function"==typeof Object.assign?Object.assign:function(t,e){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t};o("Object.assign",(function(t){return t||E})),o("Object.is",(function(t){return t||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}})),o("Array.prototype.includes",(function(t){return t||function(t,e){var n=this;n instanceof String&&(n=String(n));var r=n.length;for(0>(e=e||0)&&(e=Math.max(e+r,0));e<r;e++){var i=n[e];if(i===t||Object.is(i,t))return!0}return!1}})),o("String.prototype.includes",(function(t){return t||function(t,e){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(t,e||0)}})),o("Array.prototype.keys",(function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,r=!1,i={next:function(){if(!r&&n<t.length){var i=n++;return{value:e(i,t[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(t){return t}))}}));var S=this||self;function R(t,e){t=t.split(".");var n,r=S;t[0]in r||void 0===r.execScript||r.execScript("var "+t[0]);for(;t.length&&(n=t.shift());)t.length||void 0===e?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=e}function I(t){!function(t){S.setTimeout((function(){throw t}),0)}(t)}function O(t,e){I(Error("Invalid wire type: "+t+" (at position "+e+")"))}function _(){I(Error("Failed to read varint, encoding is invalid."))}function A(t,e){return e=String.fromCharCode.apply(null,e),null==t?e:t+e}var $,D,k="undefined"!=typeof TextDecoder,F="undefined"!=typeof TextEncoder;function P(t){if(F)t=(D||(D=new TextEncoder)).encode(t);else{var e=void 0;e=void 0!==e&&e;for(var n=0,r=new Uint8Array(3*t.length),i=0;i<t.length;i++){var o=t.charCodeAt(i);if(128>o)r[n++]=o;else{if(2048>o)r[n++]=o>>6|192;else{if(55296<=o&&57343>=o){if(56319>=o&&i<t.length){var a=t.charCodeAt(++i);if(56320<=a&&57343>=a){o=1024*(o-55296)+a-56320+65536,r[n++]=o>>18|240,r[n++]=o>>12&63|128,r[n++]=o>>6&63|128,r[n++]=63&o|128;continue}i--}if(e)throw Error("Found an unpaired surrogate");o=65533}r[n++]=o>>12|224,r[n++]=o>>6&63|128}r[n++]=63&o|128}}t=r.subarray(0,n)}return t}var L={},B=null;function M(t){var e;void 0===e&&(e=0),U(),e=L[e];for(var n=Array(Math.floor(t.length/3)),r=e[64]||"",i=0,o=0;i<t.length-2;i+=3){var a=t[i],s=t[i+1],u=t[i+2],l=e[a>>2];a=e[(3&a)<<4|s>>4],s=e[(15&s)<<2|u>>6],u=e[63&u],n[o++]=l+a+s+u}switch(l=0,u=r,t.length-i){case 2:u=e[(15&(l=t[i+1]))<<2]||r;case 1:t=t[i],n[o]=e[t>>2]+e[(3&t)<<4|l>>4]+u+r}return n.join("")}function N(t){var e=t.length,n=3*e/4;n%3?n=Math.floor(n):-1!="=.".indexOf(t[e-1])&&(n=-1!="=.".indexOf(t[e-2])?n-2:n-1);var r=new Uint8Array(n),i=0;return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=B[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}U();for(var r=0;;){var i=n(-1),o=n(0),a=n(64),s=n(64);if(64===s&&-1===i)break;e(i<<2|o>>4),64!=a&&(e(o<<4&240|a>>2),64!=s&&e(a<<6&192|s))}}(t,(function(t){r[i++]=t})),r.subarray(0,i)}function U(){if(!B){B={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var r=t.concat(e[n].split(""));L[n]=r;for(var i=0;i<r.length;i++){var o=r[i];void 0===B[o]&&(B[o]=i)}}}}var W,G="function"==typeof Uint8Array;function V(t){if(this.g=t,null!==t&&0===t.length)throw Error("ByteString should be constructed with non-empty values")}V.prototype.toJSON=function(){if(null==this.g)var t="";else t=this.g,t=this.g=null==t||"string"==typeof t?t:G&&t instanceof Uint8Array?M(t):null;return t};var j="function"==typeof Uint8Array.prototype.slice;function z(t,e,n){return e===n?W||(W=new Uint8Array(0)):j?t.slice(e,n):new Uint8Array(t.subarray(e,n))}var H=0;function X(t,e){e=void 0!==(e=void 0===e?{}:e).u&&e.u,this.h=null,this.g=this.i=this.l=0,this.j=!1,this.u=e,t&&K(this,t)}function K(t,e){t.h=function(t){if(t.constructor===Uint8Array)return t;if(t.constructor===ArrayBuffer)return new Uint8Array(t);if(t.constructor===Array)return new Uint8Array(t);if(t.constructor===String)return N(t);if(t.constructor===V){if(null==t.g)var e=W||(W=new Uint8Array(0));else{e=Uint8Array;var n=t.g;n=null==n||G&&null!=n&&n instanceof Uint8Array?n:"string"==typeof n?N(n):null,e=new e(t=t.g=n)}return e}if(t instanceof Uint8Array)return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, or Array of numbers")}(e),t.l=0,t.i=t.h.length,t.g=t.l}function Y(t){t.g>t.i&&(t.j=!0,I(Error("Tried to read past the end of the data "+t.g+" > "+t.i)))}function q(t){var e=t.h,n=e[t.g],r=127&n;return 128>n?(t.g+=1,Y(t),r):(r|=(127&(n=e[t.g+1]))<<7,128>n?(t.g+=2,Y(t),r):(r|=(127&(n=e[t.g+2]))<<14,128>n?(t.g+=3,Y(t),r):(r|=(127&(n=e[t.g+3]))<<21,128>n?(t.g+=4,Y(t),r):(r|=(15&(n=e[t.g+4]))<<28,128>n?(t.g+=5,Y(t),r>>>0):(t.g+=5,128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++]?(t.j=!0,_(),r):(Y(t),r))))))}X.prototype.reset=function(){this.g=this.l};var Q=[];function Z(){this.g=new Uint8Array(64),this.h=0}function J(t,e){if(!(t.h+1<t.g.length)){var n=t.g;t.g=new Uint8Array(Math.ceil(1+2*t.g.length)),t.g.set(n)}t.g[t.h++]=e}function tt(t,e){for(;127<e;)J(t,127&e|128),e>>>=7;J(t,e)}function et(t){var e={},n=void 0!==e.N&&e.N;this.m={u:void 0!==e.u&&e.u},this.N=n,e=this.m,Q.length?(n=Q.pop(),e&&(n.u=e.u),t&&K(n,t),t=n):t=new X(t,e),this.g=t,this.l=this.g.g,this.h=this.i=-1,this.j=!1}function nt(t){var e=t.g;if((e=e.g==e.i)||(e=t.j)||(e=(e=t.g).j||0>e.g||e.g>e.i),e)return!1;t.l=t.g.g;var n=q(t.g);return e=n>>>3,0<=(n&=7)&&5>=n?(t.i=e,t.h=n,!0):(t.j=!0,O(n,t.l),!1)}function rt(t){switch(t.h){case 0:if(0!=t.h)rt(t);else t:{for(var e=(t=t.g).g,n=0;10>n;n++){if(0==(128&t.h[e])){t.g=e+1,Y(t);break t}e++}t.j=!0,_()}break;case 1:(t=t.g).g+=8,Y(t);break;case 2:2!=t.h?rt(t):(e=q(t.g),(t=t.g).g+=e,Y(t));break;case 5:(t=t.g).g+=4,Y(t);break;case 3:for(e=t.i;;){if(!nt(t)){t.j=!0,I(Error("Unmatched start-group tag: stream EOF"));break}if(4==t.h){t.i!=e&&(t.j=!0,I(Error("Unmatched end-group tag")));break}rt(t)}break;default:t.j=!0,O(t.h,t.l)}}function it(t,e,n){t.N||(t=z(t.g.h,n,t.g.g),(n=e.m)?n.push(t):e.m=[t])}Z.prototype.length=function(){return this.h},Z.prototype.end=function(){var t=this.g,e=this.h;return this.h=0,z(t,0,e)},et.prototype.reset=function(){this.g.reset(),this.h=this.i=-1};var ot=[];function at(){this.h=[],this.i=0,this.g=new Z}function st(t,e){0!==e.length&&(t.h.push(e),t.i+=e.length)}function ut(t,e,n){tt(t.g,8*e+2),tt(t.g,n.length),st(t,t.g.end()),st(t,n)}var lt,ht="function"==typeof Symbol&&"symbol"==typeof Symbol()?Symbol(void 0):void 0;function ct(t,e){Object.isFrozen(t)||(ht?t[ht]|=e:void 0!==t.g?t.g|=e:Object.defineProperties(t,{g:{value:e,configurable:!0,writable:!0,enumerable:!1}}))}function dt(t){return t?null==(e=ht?t[ht]:t.g)?0:e:0;var e}function ft(t){return Array.isArray(t)?(ct(t,1),t):t}function pt(t){if(!Array.isArray(t))throw Error("cannot mark non-array as immutable");ct(t,2)}function gt(t){return null!==t&&"object"==typeof t&&t.constructor===Object}function mt(t){switch(typeof t){case"number":return isFinite(t)?t:String(t);case"object":return G&&null!=t&&t instanceof Uint8Array?M(t):t;default:return t}}function xt(t,e){if(null!=t)return Array.isArray(t)||gt(t)?yt(t,e):e(t)}function yt(t,e){if(Array.isArray(t)){for(var n=Array(t.length),r=0;r<t.length;r++)n[r]=xt(t[r],e);return 1&dt(t)&&ft(n),n}for(r in n={},t)n[r]=xt(t[r],e);return n}function vt(t,e,n){var r=lt;if(lt=null,t||(t=r),r=this.constructor.ca,t||(t=r?[r]:[]),this.j=(r?0:-1)-(this.constructor.aa||0),this.i=null,this.g=t,t=(r=this.g.length)-1,r&&gt(r=this.g[t])?(this.l=t-this.j,this.h=r):void 0!==e&&-1<e?(this.l=Math.max(e,t+1-this.j),this.h=null):this.l=Number.MAX_VALUE,n)for(e=0;e<n.length;e++)(t=n[e])<this.l?(t+=this.j,(r=this.g[t])?ft(r):this.g[t]=Ct):(Tt(this),(r=this.h[t])?ft(r):this.h[t]=Ct)}var wt,bt,Ct=Object.freeze(ft([]));function Tt(t){var e=t.l+t.j;t.g[e]||(t.h=t.g[e]={})}function Et(t,e,n){return-1===e?null:void 0!==n&&n||e>=t.l?t.h?t.h[e]:void 0:t.g[e+t.j]}function St(t,e,n){n=void 0===n||n;var r=void 0!==r&&r,i=Et(t,e,r);return null==i&&(i=Ct),i===Ct?It(t,e,i=ft([]),r):n&&Array.isArray(i)&&2&dt(i)&&It(t,e,i=i.slice(),r),i}function Rt(t,e,n){return null==(t=null==(t=Et(t,e))?t:+t)?void 0===n?0:n:t}function It(t,e,n,r){void 0!==r&&r||e>=t.l?(Tt(t),t.h[e]=n):t.g[e+t.j]=n}function Ot(t,e,n){t.i||(t.i={});var r=t.i[n];if(!r){var i=St(t,n,!1);r=[];for(var o=!!Array.isArray(i)&&!!(2&dt(i)),a=0;a<i.length;a++)r[a]=new e(i[a]),o&&pt(r[a].g);o&&(pt(r),Object.freeze(r)),t.i[n]=r}return r}function _t(t,e,n,r,i){var o=Ot(t,r,e);n=n||new r,t=St(t,e),null!=i?(o.splice(i,0,n),t.splice(i,0,At(n))):(o.push(n),t.push(At(n)))}function At(t){if(t.i)for(var e in t.i){var n=t.i[e];if(Array.isArray(n))for(var r=0;r<n.length;r++)n[r]&&At(n[r]);else n&&At(n)}return t.g}function $t(t,e){return null==(t=Et(t,e))?0:t}function Dt(t,e){return null==(t=Et(t,e))?"":t}function kt(t,e){if(t=t.m){st(e,e.g.end());for(var n=0;n<t.length;n++)st(e,t[n])}}function Ft(t){var e=t[0];switch(t.length){case 2:var n=t[1];return function(t,r,i){return e(t,r,i,n)};case 3:var r=t[1],i=t[2];return function(t,n,o){return e(t,n,o,r,i)};case 4:var o=t[1],a=t[2],s=t[3];return function(t,n,r){return e(t,n,r,o,a,s)};default:throw Error("unsupported number of parameters, expected [2-4], got "+t.length)}}function Pt(t,e,n){for(;nt(e)&&4!=e.h;){var r=e.i,i=n[r];if(i){if(Array.isArray(i)&&(i=n[r]=Ft(i)),!i(e,t,r)){i=t;var o=(r=e).l;rt(r),it(r,i,o)}}else i=t,o=(r=e).l,rt(r),it(r,i,o)}return t}function Lt(t,e){var n=new at;if(e(t,n),0===(t=n.i+n.g.length()))n=new Uint8Array(0);else{t=new Uint8Array(t);for(var r=n.h,i=r.length,o=e=0;o<i;o++){var a=r[o];0!==a.length&&(t.set(a,e),e+=a.length)}0!==(i=(r=n.g).h)&&(t.set(r.g.subarray(0,i),e),r.h=0),n.h=[t],n=t}return n}function Bt(t,e,n){if(ot.length){var r=ot.pop();t&&(K(r.g,t),r.i=-1,r.h=-1),t=r}else t=new et(t);try{return n(new e,t)}finally{(e=t.g).h=null,e.l=0,e.i=0,e.g=0,e.j=!1,e.u=!1,t.i=-1,t.h=-1,t.j=!1,100>ot.length&&ot.push(t)}}function Mt(t,e,n){if(null!=(e=Et(e,n))){tt(t.g,8*n+5),t=t.g;var r=e;0===(r=(n=0>r?1:0)?-r:r)?H=0<1/r?0:2147483648:isNaN(r)?H=2147483647:34028234663852886e22<r?H=(n<<31|2139095040)>>>0:11754943508222875e-54>r?(r=Math.round(r/Math.pow(2,-149)),H=(n<<31|r)>>>0):(e=Math.floor(Math.log(r)/Math.LN2),r*=Math.pow(2,-e),16777216<=(r=Math.round(8388608*r))&&++e,H=(n<<31|e+127<<23|8388607&r)>>>0),J(t,(n=H)>>>0&255),J(t,n>>>8&255),J(t,n>>>16&255),J(t,n>>>24&255)}}function Nt(t,e,n){if(5!==t.h)return!1;var r=(t=t.g).h[t.g],i=t.h[t.g+1],o=t.h[t.g+2],a=t.h[t.g+3];return t.g+=4,Y(t),t=2*((i=(r<<0|i<<8|o<<16|a<<24)>>>0)>>31)+1,r=i>>>23&255,i&=8388607,It(e,n,255==r?i?NaN:1/0*t:0==r?t*Math.pow(2,-149)*i:t*Math.pow(2,r-150)*(i+Math.pow(2,23))),!0}function Ut(t,e,n){if(0!==t.h)return!1;for(var r=t.g,i=128,o=0,a=t=0;4>a&&128<=i;a++)o|=(127&(i=r.h[r.g++]))<<7*a;if(128<=i&&(o|=(127&(i=r.h[r.g++]))<<28,t|=(127&i)>>4),128<=i)for(a=0;5>a&&128<=i;a++)t|=(127&(i=r.h[r.g++]))<<7*a+3;return 128>i?(r=o>>>0,(t=2147483648&(i=t>>>0))&&(i=~i>>>0,0==(r=1+~r>>>0)&&(i=i+1>>>0)),r=4294967296*i+(r>>>0),t=t?-r:r):(r.j=!0,_(),t=void 0),It(e,n,t),!0}function Wt(t,e,n){return 0===t.h&&(It(e,n,q(t.g)),!0)}function Gt(t,e,n){if(2!==t.h)return!1;var r,i=q(t.g),o=(t=t.g).g;if(t.g+=i,Y(t),t=t.h,k)(r=$)||(r=$=new TextDecoder("utf-8",{fatal:!1})),r=r.decode(t.subarray(o,o+i));else{i=o+i;for(var a,s,u,l=[],h=null;o<i;)128>(a=t[o++])?l.push(a):224>a?o>=i?l.push(65533):(s=t[o++],194>a||128!=(192&s)?(o--,l.push(65533)):l.push((31&a)<<6|63&s)):240>a?o>=i-1?l.push(65533):128!=(192&(s=t[o++]))||224===a&&160>s||237===a&&160<=s||128!=(192&(r=t[o++]))?(o--,l.push(65533)):l.push((15&a)<<12|(63&s)<<6|63&r):244>=a?o>=i-2?l.push(65533):128!=(192&(s=t[o++]))||0!=s-144+(a<<28)>>30||128!=(192&(r=t[o++]))||128!=(192&(u=t[o++]))?(o--,l.push(65533)):(a=(7&a)<<18|(63&s)<<12|(63&r)<<6|63&u,a-=65536,l.push(55296+(a>>10&1023),56320+(1023&a))):l.push(65533),8192<=l.length&&(h=A(h,l),l.length=0);r=A(h,l)}return It(e,n,r),!0}function Vt(t,e,n,r,i){if(2!==t.h)return!1;var o=new r,a=t.g.i,s=q(t.g),u=t.g.g+s;if(t.g.i=u,i(o,t),0!=(i=u-t.g.g))throw Error("Message parsing ended unexpectedly. Expected to read "+s+" bytes, instead read "+(s-i)+" bytes, either the data ended unexpectedly or the message misreported its own length");return t.g.g=u,t.g.i=a,_t(e,n,o,r,void 0),!0}function jt(t){vt.call(this,t)}function zt(t,e){var n=Et(t,1);if(null!=n&&null!=n){tt(e.g,8);var r=e.g;if(0<=n)tt(r,n);else{for(var i=0;9>i;i++)J(r,127&n|128),n>>=7;J(r,1)}}Mt(e,t,2),null!=(r=Et(t,3))&&ut(e,3,P(r)),null!=(r=Et(t,4))&&ut(e,4,P(r)),kt(t,e)}function Ht(t,e){return Pt(t,e,wt||(wt={1:Wt,2:Nt,3:Gt,4:Gt}))}function Xt(t){vt.call(this,t,-1,Qt)}function Kt(t,e){return Pt(t,e,bt||(bt={1:[Vt,jt,Ht]}))}vt.prototype.toJSON=function(){return yt(At(this),mt)},vt.prototype.toString=function(){return At(this).toString()},p(jt,vt),p(Xt,vt),Xt.prototype.addClassification=function(t,e){return _t(this,1,t,jt,e),this};var Yt,qt,Qt=[1];function Zt(t){vt.call(this,t)}function Jt(t,e){Mt(e,t,1),Mt(e,t,2),Mt(e,t,3),Mt(e,t,4),Mt(e,t,5),kt(t,e)}function te(t,e){return Pt(t,e,Yt||(Yt={1:Nt,2:Nt,3:Nt,4:Nt,5:Nt}))}function ee(t){vt.call(this,t,-1,ie)}function ne(t,e){return Pt(t,e,qt||(qt={1:[Vt,Zt,te]}))}p(Zt,vt),p(ee,vt);var re,ie=[1];function oe(t){vt.call(this,t)}function ae(t,e){Mt(e,t,1),Mt(e,t,2),Mt(e,t,3),Mt(e,t,4),Mt(e,t,5);var n=Et(t,6);if(null!=n&&null!=n){tt(e.g,48);var r=e.g,i=n;n=0>i;var o=(i=Math.abs(i))>>>0;for(i=Math.floor((i-o)/4294967296),i>>>=0,n&&(i=~i>>>0,4294967295<(o=1+(~o>>>0))&&(o=0,4294967295<++i&&(i=0))),n=H=o,o=i;0<o||127<n;)J(r,127&n|128),n=(n>>>7|o<<25)>>>0,o>>>=7;J(r,n)}kt(t,e)}function se(t,e){return Pt(t,e,re||(re={1:Nt,2:Nt,3:Nt,4:Nt,5:Nt,6:Ut}))}function ue(t,e,n){if(n=t.createShader(0===n?t.VERTEX_SHADER:t.FRAGMENT_SHADER),t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw Error("Could not compile WebGL shader.\n\n"+t.getShaderInfoLog(n));return n}function le(t){return Ot(t,jt,1).map((function(t){return{index:$t(t,1),X:Rt(t,2),label:null!=Et(t,3)?Dt(t,3):void 0,displayName:null!=Et(t,4)?Dt(t,4):void 0}}))}function he(t){return{x:Rt(t,1),y:Rt(t,2),z:Rt(t,3),visibility:null!=Et(t,4)?Rt(t,4):void 0}}function ce(t){return Ot(Bt(t,ee,ne),Zt,1).map(he)}function de(t,e){this.h=t,this.g=e,this.l=0}function fe(t,e,n){return function(t,e){var n=t.g;if(void 0===t.m){var r=ue(n,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",0),i=ue(n,"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D sampler0;\n  void main(){\n    gl_FragColor = texture2D(sampler0, vTex);\n  }",1),o=n.createProgram();if(n.attachShader(o,r),n.attachShader(o,i),n.linkProgram(o),!n.getProgramParameter(o,n.LINK_STATUS))throw Error("Could not compile WebGL program.\n\n"+n.getProgramInfoLog(o));r=t.m=o,n.useProgram(r),i=n.getUniformLocation(r,"sampler0"),t.j={I:n.getAttribLocation(r,"aVertex"),H:n.getAttribLocation(r,"aTex"),da:i},t.s=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.s),n.enableVertexAttribArray(t.j.I),n.vertexAttribPointer(t.j.I,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),t.o=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.o),n.enableVertexAttribArray(t.j.H),n.vertexAttribPointer(t.j.H,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.uniform1i(i,0)}r=t.j,n.useProgram(t.m),n.canvas.width=e.width,n.canvas.height=e.height,n.viewport(0,0,e.width,e.height),n.activeTexture(n.TEXTURE0),t.h.bindTexture2d(e.glName),n.enableVertexAttribArray(r.I),n.bindBuffer(n.ARRAY_BUFFER,t.s),n.vertexAttribPointer(r.I,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.H),n.bindBuffer(n.ARRAY_BUFFER,t.o),n.vertexAttribPointer(r.H,2,n.FLOAT,!1,0,0),n.bindFramebuffer(n.DRAW_FRAMEBUFFER?n.DRAW_FRAMEBUFFER:n.FRAMEBUFFER,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.colorMask(!0,!0,!0,!0),n.drawArrays(n.TRIANGLE_FAN,0,4),n.disableVertexAttribArray(r.I),n.disableVertexAttribArray(r.H),n.bindBuffer(n.ARRAY_BUFFER,null),t.h.bindTexture2d(0)}(t,e),"function"==typeof t.g.canvas.transferToImageBitmap?Promise.resolve(t.g.canvas.transferToImageBitmap()):n?Promise.resolve(t.g.canvas):"function"==typeof createImageBitmap?createImageBitmap(t.g.canvas):(void 0===t.i&&(t.i=document.createElement("canvas")),new Promise((function(e){t.i.height=t.g.canvas.height,t.i.width=t.g.canvas.width,t.i.getContext("2d",{}).drawImage(t.g.canvas,0,0,t.g.canvas.width,t.g.canvas.height),e(t.i)})))}function pe(t){this.g=t}p(oe,vt);var ge=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function me(t,e){return e+t}function xe(t,e){window[t]=e}function ye(t){if(this.g=t,this.listeners={},this.j={},this.F={},this.m={},this.s={},this.G=this.o=this.R=!0,this.C=Promise.resolve(),this.P="",this.B={},this.locateFile=t&&t.locateFile||me,"object"==typeof window)var e=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if("undefined"==typeof location)throw Error("solutions can only be loaded on a web page or in a web worker");e=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.S=e,t.options)for(var n=(e=s(Object.keys(t.options))).next();!n.done;n=e.next()){n=n.value;var r=t.options[n].default;void 0!==r&&(this.j[n]="function"==typeof r?r():r)}}function ve(t,e){var n,r;return T((function(i){return e in t.F?i.return(t.F[e]):(n=t.locateFile(e,""),r=fetch(n).then((function(t){return t.arrayBuffer()})),t.F[e]=r,i.return(r))}))}function we(t,e){for(var n=e.name||"$",r=[].concat(u(e.wants)),i=new t.h.StringList,o=s(e.wants),a=o.next();!a.done;a=o.next())i.push_back(a.value);o=t.h.PacketListener.implement({onResults:function(i){for(var o={},a=0;a<e.wants.length;++a)o[r[a]]=i.get(a);var u=t.listeners[n];u&&(t.C=function(t,e,n){var r,i,o,a,u,l,h,c,d,f,p,g,m,x;return T((function(v){switch(v.g){case 1:if(!n)return v.return(e);for(r={},i=0,o=s(Object.keys(n)),a=o.next();!a.done;a=o.next())u=a.value,"string"!=typeof(l=n[u])&&"texture"===l.type&&void 0!==e[l.stream]&&++i;1<i&&(t.G=!1),h=s(Object.keys(n)),a=h.next();case 2:if(a.done){v.g=4;break}if(c=a.value,"string"==typeof(d=n[c]))return m=r,x=c,y(v,function(t,e,n){var r;return T((function(i){return"number"==typeof n||n instanceof Uint8Array||n instanceof t.h.Uint8BlobList?i.return(n):n instanceof t.h.Texture2dDataOut?((r=t.s[e])||(r=new de(t.h,t.D),t.s[e]=r),i.return(fe(r,n,t.G))):i.return(void 0)}))}(t,c,e[d]),14);if(f=e[d.stream],"detection_list"===d.type){if(f){for(var w=f.getRectList(),b=f.getLandmarksList(),C=f.getClassificationsList(),E=[],S=0;S<w.size();++S){var R=Bt(w.get(S),oe,se);R={T:{Y:Rt(R,1),Z:Rt(R,2),height:Rt(R,3),width:Rt(R,4),rotation:Rt(R,5,0),W:$t(R,6)},O:ce(b.get(S)),M:le(Bt(C.get(S),Xt,Kt))},E.push(R)}w=E}else w=[];r[c]=w,v.g=7;break}if("proto_list"===d.type){if(f){for(w=Array(f.size()),b=0;b<f.size();b++)w[b]=f.get(b);f.delete()}else w=[];r[c]=w,v.g=7;break}if(void 0===f){v.g=3;break}if("float_list"===d.type){r[c]=f,v.g=7;break}if("proto"===d.type){r[c]=f,v.g=7;break}if("texture"!==d.type)throw Error("Unknown output config type: '"+d.type+"'");return(p=t.s[c])||(p=new de(t.h,t.D),t.s[c]=p),y(v,fe(p,f,t.G),13);case 13:g=v.h,r[c]=g;case 7:d.transform&&r[c]&&(r[c]=d.transform(r[c])),v.g=3;break;case 14:m[x]=v.h;case 3:a=h.next(),v.g=2;break;case 4:return v.return(r)}}))}(t,o,e.outs).then((function(n){n=u(n);for(var i=0;i<e.wants.length;++i){var a=o[r[i]];"object"==typeof a&&a.hasOwnProperty&&a.hasOwnProperty("delete")&&a.delete()}n&&(t.C=n)})))}}),t.i.attachMultiListener(i,o),i.delete()}function be(t){switch(void 0===t&&(t=0),t){case 1:return"pose_landmark_full.tflite";case 2:return"pose_landmark_heavy.tflite";default:return"pose_landmark_lite.tflite"}}function Ce(t){var e=this;t=t||{},this.g=new ye({locateFile:t.locateFile,files:function(t){return[{url:"pose_solution_packed_assets_loader.js"},{simd:!1,url:"pose_solution_wasm_bin.js"},{simd:!0,url:"pose_solution_simd_wasm_bin.js"},{data:!0,url:be(t.modelComplexity)}]},graph:{url:"pose_web.binarypb"},listeners:[{wants:["pose_landmarks","world_landmarks","segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:ce},poseWorldLandmarks:{type:"proto",stream:"world_landmarks",transform:ce},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(t){var n,r,i;return T((function(o){return 1==o.g?(n=be(t),r="third_party/mediapipe/modules/pose_landmark/"+n,y(o,ve(e.g,n),2)):(i=o.h,e.g.overrideFile(r,i),o.return(!0))}))}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}}}})}(t=ye.prototype).close=function(){return this.i&&this.i.delete(),Promise.resolve()},t.reset=function(){var t=this;return T((function(e){t.i&&(t.i.reset(),t.m={},t.s={}),e.g=0}))},t.setOptions=function(t,e){var n=this;if(e=e||this.g.options){for(var r=[],i=[],o={},a=s(Object.keys(t)),u=a.next();!u.done;o={K:o.K,L:o.L},u=a.next()){var l=u.value;l in this.j&&this.j[l]===t[l]||(this.j[l]=t[l],void 0!==(u=e[l])&&(u.onChange&&(o.K=u.onChange,o.L=t[l],r.push(function(t){return function(){return T((function(e){if(1==e.g)return y(e,t.K(t.L),2);!0===e.h&&(n.o=!0),e.g=0}))}}(o))),u.graphOptionXref&&(l={valueNumber:1===u.type?t[l]:0,valueBoolean:0===u.type&&t[l],valueString:2===u.type?t[l]:""},u=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),u.graphOptionXref),l),i.push(u))))}0===r.length&&0===i.length||(this.o=!0,this.A=(void 0===this.A?[]:this.A).concat(i),this.v=(void 0===this.v?[]:this.v).concat(r))}},t.initialize=function(){var t=this;return T((function(e){return 1==e.g?y(e,function(t){var e,n,r,i,o,a,s,l,h,c,d;return T((function(f){switch(f.g){case 1:return t.R?(e=void 0===t.g.files?[]:"function"==typeof t.g.files?t.g.files(t.j):t.g.files,y(f,T((function(t){switch(t.g){case 1:return t.m=2,y(t,WebAssembly.instantiate(ge),4);case 4:t.g=3,t.m=0;break;case 2:return t.m=0,t.j=null,t.return(!1);case 3:return t.return(!0)}})),2)):f.return();case 2:if(n=f.h,"object"==typeof window)return xe("createMediapipeSolutionsWasm",{locateFile:t.locateFile}),xe("createMediapipeSolutionsPackedAssets",{locateFile:t.locateFile}),a=e.filter((function(t){return void 0!==t.data})),s=e.filter((function(t){return void 0===t.data})),l=Promise.all(a.map((function(e){var n=ve(t,e.url);if(void 0!==e.path){var r=e.path;n=n.then((function(e){return t.overrideFile(r,e),Promise.resolve(e)}))}return n}))),h=Promise.all(s.map((function(e){return void 0===e.simd||e.simd&&n||!e.simd&&!n?function(t){var e=document.createElement("script");return e.setAttribute("src",t),e.setAttribute("crossorigin","anonymous"),new Promise((function(t){e.addEventListener("load",(function(){t()}),!1),e.addEventListener("error",(function(){t()}),!1),document.body.appendChild(e)}))}(t.locateFile(e.url,t.S)):Promise.resolve()}))).then((function(){var e,n,r;return T((function(i){if(1==i.g)return e=window.createMediapipeSolutionsWasm,n=window.createMediapipeSolutionsPackedAssets,r=t,y(i,e(n),2);r.h=i.h,i.g=0}))})),c=T((function(e){return t.g.graph&&t.g.graph.url?e=y(e,ve(t,t.g.graph.url),0):(e.g=0,e=void 0),e})),y(f,Promise.all([h,l,c]),7);if("function"!=typeof importScripts)throw Error("solutions can only be loaded on a web page or in a web worker");return r=e.filter((function(t){return void 0===t.simd||t.simd&&n||!t.simd&&!n})).map((function(e){return t.locateFile(e.url,t.S)})),importScripts.apply(null,u(r)),i=t,y(f,createMediapipeSolutionsWasm(Module),6);case 6:i.h=f.h,t.l=new OffscreenCanvas(1,1),t.h.canvas=t.l,o=t.h.GL.createContext(t.l,{antialias:!1,alpha:!1,ba:"undefined"!=typeof WebGL2RenderingContext?2:1}),t.h.GL.makeContextCurrent(o),f.g=4;break;case 7:if(t.l=document.createElement("canvas"),!(d=t.l.getContext("webgl2",{}))&&!(d=t.l.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),f.return();t.D=d,t.h.canvas=t.l,t.h.createContext(t.l,!0,!0,{});case 4:t.i=new t.h.SolutionWasm,t.R=!1,f.g=0}}))}(t),2):3!=e.g?y(e,function(t){var e,n,r,i,o,a,u,l;return T((function(h){if(1==h.g)return t.g.graph&&t.g.graph.url&&t.P===t.g.graph.url?h.return():(t.o=!0,t.g.graph&&t.g.graph.url?(t.P=t.g.graph.url,y(h,ve(t,t.g.graph.url),3)):void(h.g=2));for(2!=h.g&&(e=h.h,t.i.loadGraph(e)),n=s(Object.keys(t.B)),r=n.next();!r.done;r=n.next())i=r.value,t.i.overrideFile(i,t.B[i]);if(t.B={},t.g.listeners)for(o=s(t.g.listeners),a=o.next();!a.done;a=o.next())u=a.value,we(t,u);l=t.j,t.j={},t.setOptions(l),h.g=0}))}(t),3):y(e,function(t){var e,n,r,i,o,a;return T((function(u){switch(u.g){case 1:if(!t.o)return u.return();if(!t.v){u.g=2;break}e=s(t.v),n=e.next();case 3:if(n.done){u.g=5;break}return y(u,(0,n.value)(),4);case 4:n=e.next(),u.g=3;break;case 5:t.v=void 0;case 2:if(t.A){for(r=new t.h.GraphOptionChangeRequestList,i=s(t.A),o=i.next();!o.done;o=i.next())a=o.value,r.push_back(a);t.i.changeOptions(r),r.delete(),t.A=void 0}t.o=!1,u.g=0}}))}(t),0)}))},t.overrideFile=function(t,e){this.i?this.i.overrideFile(t,e):this.B[t]=e},t.clearOverriddenFiles=function(){this.B={},this.i&&this.i.clearOverriddenFiles()},t.send=function(t,e){var n,r,i,o,a,u,l,h,c,d=this;return T((function(f){switch(f.g){case 1:return d.g.inputs?(n=1e3*(null==e?performance.now():e),y(f,d.C,2)):f.return();case 2:return y(f,d.initialize(),3);case 3:for(r=new d.h.PacketDataList,i=s(Object.keys(t)),o=i.next();!o.done;o=i.next())if(a=o.value,u=d.g.inputs[a]){t:{var p=t[a];switch(u.type){case"video":var g=d.m[u.stream];if(g||(g=new de(d.h,d.D),d.m[u.stream]=g),0===g.l&&(g.l=g.h.createTexture()),"undefined"!=typeof HTMLVideoElement&&p instanceof HTMLVideoElement)var m=p.videoWidth,x=p.videoHeight;else"undefined"!=typeof HTMLImageElement&&p instanceof HTMLImageElement?(m=p.naturalWidth,x=p.naturalHeight):(m=p.width,x=p.height);x={glName:g.l,width:m,height:x},(m=g.g).canvas.width=x.width,m.canvas.height=x.height,m.activeTexture(m.TEXTURE0),g.h.bindTexture2d(g.l),m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,p),g.h.bindTexture2d(0),g=x;break t;case"detections":for((g=d.m[u.stream])||(g=new pe(d.h),d.m[u.stream]=g),g.data||(g.data=new g.g.DetectionListData),g.data.reset(p.length),x=0;x<p.length;++x){m=p[x];var v=g.data,w=v.setBoundingBox,b=x,C=m.T,T=new oe;if(It(T,1,C.Y),It(T,2,C.Z),It(T,3,C.height),It(T,4,C.width),It(T,5,C.rotation),It(T,6,C.W),C=Lt(T,ae),w.call(v,b,C),m.O)for(v=0;v<m.O.length;++v){var E=!!(T=m.O[v]).visibility;b=(w=g.data).addNormalizedLandmark,C=x,T=Object.assign(Object.assign({},T),{visibility:E?T.visibility:0}),It(E=new Zt,1,T.x),It(E,2,T.y),It(E,3,T.z),T.visibility&&It(E,4,T.visibility),T=Lt(E,Jt),b.call(w,C,T)}if(m.M)for(v=0;v<m.M.length;++v)b=(w=g.data).addClassification,C=x,T=m.M[v],It(E=new jt,2,T.X),T.index&&It(E,1,T.index),T.label&&It(E,3,T.label),T.displayName&&It(E,4,T.displayName),T=Lt(E,zt),b.call(w,C,T)}g=g.data;break t;default:g={}}}switch(l=g,h=u.stream,u.type){case"video":r.pushTexture2d(Object.assign(Object.assign({},l),{stream:h,timestamp:n}));break;case"detections":(c=l).stream=h,c.timestamp=n,r.pushDetectionList(c);break;default:throw Error("Unknown input config type: '"+u.type+"'")}}return d.i.send(r),y(f,d.C,4);case 4:r.delete(),f.g=0}}))},t.onResults=function(t,e){this.listeners[e||"$"]=t},R("Solution",ye),R("OptionType",{BOOL:0,NUMBER:1,$:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(t=Ce.prototype).reset=function(){this.g.reset()},t.close=function(){return this.g.close(),Promise.resolve()},t.onResults=function(t){this.g.onResults(t)},t.initialize=function(){var t=this;return T((function(e){return y(e,t.g.initialize(),0)}))},t.send=function(t,e){var n=this;return T((function(r){return y(r,n.g.send(t,e),0)}))},t.setOptions=function(t){this.g.setOptions(t)},R("Pose",Ce),R("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),R("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),R("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),R("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),R("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),R("VERSION","0.5.1635988162")}).call(this)},96064:(t,e,n)=>{"use strict";n.d(e,{cH:()=>Se,oV:()=>It});var r=n(20264),i=n(88478),o=n(38985),a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(t,e){function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var u=function(){return(u=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function l(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function h(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function c(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}var d=["nose","left_eye","right_eye","left_ear","right_ear","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle"],f=["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"],p={left:[1,2,3,7,9,11,13,15,17,19,21,23,25,27,29,31],right:[4,5,6,8,10,12,14,16,18,20,22,24,26,28,30,32],middle:[0]},g={left:[1,3,5,7,9,11,13,15],right:[2,4,6,8,10,12,14,16],middle:[0]},m=[[0,1],[0,2],[1,3],[2,4],[5,6],[5,7],[5,11],[6,8],[6,12],[7,9],[8,10],[11,12],[11,13],[12,14],[13,15],[14,16]],x=[[0,1],[0,4],[1,2],[2,3],[3,7],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[11,23],[12,14],[14,16],[12,24],[13,15],[15,17],[16,18],[16,20],[15,17],[15,19],[15,21],[16,22],[17,19],[18,20],[23,25],[23,24],[24,26],[25,27],[26,28],[27,29],[28,30],[27,31],[28,32],[29,31],[30,32]];function y(t){return t instanceof SVGAnimatedLength?t.baseVal.value:t}function v(t){return l(this,void 0,void 0,(function(){var e,n;return h(this,(function(r){switch(r.label){case 0:return e=document.createElement("canvas"),t instanceof i.esB?[4,i.Xhn.toPixels(t,e)]:[3,2];case 1:return r.sent(),[3,3];case 2:e.width=y(t.width),e.height=y(t.height),n=e.getContext("2d"),t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0),r.label=3;case 3:return[2,e]}}))}))}function w(t){return l(this,void 0,void 0,(function(){var e,n,r,o,a,s;return h(this,(function(u){switch(u.label){case 0:return t instanceof i.esB?(e=t.shape.slice(0,2),n=e[0],r=e[1],o=ImageData.bind,[4,i.Xhn.toPixels(t)]):[3,2];case 1:return[2,new(o.apply(ImageData,[void 0,u.sent(),r,n]))];case 2:return a=document.createElement("canvas"),s=a.getContext("2d"),a.width=y(t.width),a.height=y(t.height),s.drawImage(t,0,0),[2,s.getImageData(0,0,a.width,a.height)]}}))}))}function b(t){return l(this,void 0,void 0,(function(){var e,n;return h(this,(function(r){switch(r.label){case 0:return t instanceof SVGImageElement||t instanceof OffscreenCanvas?[4,v(t)]:[3,2];case 1:return n=r.sent(),[3,3];case 2:n=t,r.label=3;case 3:return e=n,[2,i.Xhn.fromPixels(e,4)]}}))}))}function C(t){if(t<0||t>=256)throw new Error("Mask value must be in range [0, 255] but got "+t);if(!Number.isInteger(t))throw new Error("Mask value must be an integer but got "+t)}var T={runtime:"mediapipe",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,modelType:"full"},E=function(){function t(t){this.mask=t}return t.prototype.toCanvasImageSource=function(){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this.mask]}))}))},t.prototype.toImageData=function(){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,w(this.mask)]}))}))},t.prototype.toTensor=function(){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,b(this.mask)]}))}))},t.prototype.getUnderlyingType=function(){return"canvasimagesource"},t}();function S(t){return C(t),"person"}var R=function(){function t(t){var e,n=this;switch(this.width=0,this.height=0,this.selfieMode=!1,this.poseSolution=new r.Pose({locateFile:function(e,n){return t.solutionPath?t.solutionPath.replace(/\/+$/,"")+"/"+e:n+"/"+e}}),t.modelType){case"lite":e=0;break;case"heavy":e=2;break;default:e=1}this.poseSolution.setOptions({modelComplexity:e,smoothLandmarks:t.enableSmoothing,enableSegmentation:t.enableSegmentation,smoothSegmentation:t.smoothSegmentation,selfieMode:this.selfieMode}),this.poseSolution.onResults((function(t){if(n.height=t.image.height,n.width=t.image.width,null==t.poseLandmarks)n.poses=[];else{var e=n.translateOutput(t.poseLandmarks,t.poseWorldLandmarks);t.segmentationMask&&(e.segmentation={maskValueToLabel:S,mask:new E(t.segmentationMask)}),n.poses=[e]}}))}return t.prototype.translateOutput=function(t,e){var n=this,r={keypoints:t.map((function(t,e){return{x:t.x*n.width,y:t.y*n.height,z:t.z,score:t.visibility,name:f[e]}}))};return null!=e&&(r.keypoints3D=e.map((function(t,e){return{x:t.x,y:t.y,z:t.z,score:t.visibility,name:f[e]}}))),r},t.prototype.estimatePoses=function(t,e,n){return l(this,void 0,void 0,(function(){var r,o;return h(this,(function(a){switch(a.label){case 0:return e&&e.flipHorizontal&&e.flipHorizontal!==this.selfieMode&&(this.selfieMode=e.flipHorizontal,this.poseSolution.setOptions({selfieMode:this.selfieMode})),t instanceof i.esB?(o=ImageData.bind,[4,i.Xhn.toPixels(t)]):[3,2];case 1:return r=new(o.apply(ImageData,[void 0,a.sent(),t.shape[1],t.shape[0]])),[3,3];case 2:r=t,a.label=3;case 3:return t=r,[4,this.poseSolution.send({image:t},n)];case 4:return a.sent(),[2,this.poses]}}))}))},t.prototype.dispose=function(){this.poseSolution.close()},t.prototype.reset=function(){this.poseSolution.reset()},t.prototype.initialize=function(){return this.poseSolution.initialize()},t}();function I(t){return l(this,void 0,void 0,(function(){var e,n;return h(this,(function(r){switch(r.label){case 0:return e=function(t){if(null==t)return u({},T);var e=u({},t);return e.runtime="mediapipe",null==e.enableSegmentation&&(e.enableSegmentation=T.enableSegmentation),null==e.enableSmoothing&&(e.enableSmoothing=T.enableSmoothing),null==e.smoothSegmentation&&(e.smoothSegmentation=T.smoothSegmentation),null==e.modelType&&(e.modelType=T.modelType),e}(t),[4,(n=new R(e)).initialize()];case 1:return r.sent(),[2,n]}}))}))}function O(t){return t instanceof i.esB?{height:t.shape[0],width:t.shape[1]}:{height:t.height,width:t.width}}function _(t){return t-2*Math.PI*Math.floor((t+Math.PI)/(2*Math.PI))}function A(t){return t instanceof i.esB?t:i.Xhn.fromPixels(t)}function $(t,e,n){return D(n,"inputResolution"),[1/n.width*t[0][0]*e.width,1/n.height*t[0][1]*e.width,t[0][3]*e.width,1/n.width*t[1][0]*e.height,1/n.height*t[1][1]*e.height,t[1][3]*e.height,0,0]}function D(t,e){i.D5U.assert(0!==t.width,(function(){return e+" width cannot be 0."})),i.D5U.assert(0!==t.height,(function(){return e+" height cannot be 0."}))}function k(t,e,n){var r=n.rotationVectorStartKeypointIndex,i=n.rotationVectorEndKeypointIndex,o=t.locationData,a=o.relativeKeypoints[r].x*e.width,s=o.relativeKeypoints[r].y*e.height,u=o.relativeKeypoints[i].x*e.width,l=o.relativeKeypoints[i].y*e.height,h=2*Math.sqrt((u-a)*(u-a)+(l-s)*(l-s)),c=function(t,e,n){var r,i=t.locationData,o=n.rotationVectorStartKeypointIndex,a=n.rotationVectorEndKeypointIndex;r=n.rotationVectorTargetAngle?n.rotationVectorTargetAngle:Math.PI*n.rotationVectorTargetAngleDegree/180;var s=i.relativeKeypoints[o].x*e.width,u=i.relativeKeypoints[o].y*e.height,l=i.relativeKeypoints[a].x*e.width,h=i.relativeKeypoints[a].y*e.height;return _(r-Math.atan2(-(h-u),l-s))}(t,e,n);return{xCenter:a/e.width,yCenter:s/e.height,width:h/e.width,height:h/e.height,rotation:c}}function F(t){if(16!==t.length)throw new Error("Array length must be 16 but got "+t.length);return[[t[0],t[1],t[2],t[3]],[t[4],t[5],t[6],t[7]],[t[8],t[9],t[10],t[11]],[t[12],t[13],t[14],t[15]]]}function P(t,e,n,r,i,o,a){return t[e][i]*(t[n][o]*t[r][a]-t[n][a]*t[r][o])}function L(t,e,n){var r=(e+1)%4,i=(e+2)%4,o=(e+3)%4,a=(n+1)%4,s=(n+2)%4,u=(n+3)%4;return P(t,r,i,o,a,s,u)+P(t,i,o,r,a,s,u)+P(t,o,r,i,a,s,u)}function B(t,e,n){void 0===n&&(n={ignoreRotation:!1});for(var r=[],i=0,o=t;i<o.length;i++){var a=o[i],s=a.x-.5,l=a.y-.5,h=n.ignoreRotation?0:e.rotation,c=Math.cos(h)*s-Math.sin(h)*l,d=Math.sin(h)*s+Math.cos(h)*l;c=c*e.width+e.xCenter,d=d*e.height+e.yCenter;var f=a.z*e.width,p=u({},a);p.x=c,p.y=d,p.z=f,r.push(p)}return r}function M(t,e){var n=function(t,e,n,r){var i=(r-n)/255;return{scale:i,offset:n-0*i}}(0,0,e[0],e[1]);return(0,i.lub)((function(){return(0,i.IHx)((0,i.dC7)(t,n.scale),n.offset)}))}function N(t,e,n){var r,o,a,s,u,l,h,c,d,f,p,g,m=e.outputTensorSize,x=e.keepAspectRatio,y=e.borderMode,v=e.outputTensorFloatRange,w=O(t),b=function(t,e){return e?{xCenter:e.xCenter*t.width,yCenter:e.yCenter*t.height,width:e.width*t.width,height:e.height*t.height,rotation:e.rotation}:{xCenter:.5*t.width,yCenter:.5*t.height,width:t.width,height:t.height,rotation:0}}(w,n),C=function(t,e,n){if(void 0===n&&(n=!1),!n)return{top:0,left:0,right:0,bottom:0};var r=e.height,i=e.width;D(e,"targetSize"),D(t,"roi");var o,a,s=r/i,u=t.height/t.width,l=0,h=0;return s>u?(o=t.width,a=t.width*s,h=(1-u/s)/2):(o=t.height/s,a=t.height,l=(1-s/u)/2),t.width=o,t.height=a,{top:h,left:l,right:l,bottom:h}}(b,m,x),T=(r=b,o=w.width,a=w.height,s=r.width,u=r.height,l=Math.cos(r.rotation),h=Math.sin(r.rotation),c=r.xCenter,d=r.yCenter,f=1/o,p=1/a,(g=new Array(16))[0]=s*l*1*f,g[1]=-u*h*f,g[2]=0,g[3]=(-.5*s*l*1+.5*u*h+c)*f,g[4]=s*h*1*p,g[5]=u*l*p,g[6]=0,g[7]=(-.5*u*l-.5*s*h*1+d)*p,g[8]=0,g[9]=0,g[10]=s*f,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,F(g));return{imageTensor:(0,i.lub)((function(){var e=A(t),n=(0,i.odF)($(T,w,m),[1,8]),r="zero"===y?"constant":"nearest",o=i.BHj.transform((0,i.dt4)((0,i.pju)(e,"float32")),n,"bilinear",r,0,[m.height,m.width]);return null!=v?M(o,v):o})),padding:C,transformationMatrix:T}}function U(t,e,n,r){return 1===r?.5*(t+e):t+(e-t)*n/(r-1)}function W(t){return null!=t&&null!=t.currentTime}function G(t){for(var e={locationData:{relativeKeypoints:[]}},n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,a=0;a<t.length;++a){var s=t[a];n=Math.min(n,s.x),r=Math.max(r,s.x),i=Math.min(i,s.y),o=Math.max(o,s.y),e.locationData.relativeKeypoints.push({x:s.x,y:s.y})}return e.locationData.relativeBoundingBox={xMin:n,yMin:i,xMax:r,yMax:o,width:r-n,height:o-i},e}function V(t,e,n,r){return l(this,void 0,void 0,(function(){var r,o,a,s,u;return h(this,(function(l){switch(l.label){case 0:return t.sort((function(t,e){return Math.max.apply(Math,e.score)-Math.max.apply(Math,t.score)})),r=(0,i.odF)(t.map((function(t){return[t.locationData.relativeBoundingBox.yMin,t.locationData.relativeBoundingBox.xMin,t.locationData.relativeBoundingBox.yMax,t.locationData.relativeBoundingBox.xMax]}))),o=(0,i.RRF)(t.map((function(t){return t.score[0]}))),[4,i.BHj.nonMaxSuppressionAsync(r,o,e,n)];case 1:return[4,(a=l.sent()).array()];case 2:return s=l.sent(),u=t.filter((function(t,e){return s.indexOf(e)>-1})),(0,i.B90)([r,o,a]),[2,u]}}))}))}function j(t,e){return t.map((function(t){var n=u(u({},t),{x:t.x*e.width,y:t.y*e.height});return null!=t.z&&(n.z=t.z*e.width),n}))}function z(t,e,n){return l(this,void 0,void 0,(function(){var r,o,a,s,l,c,d,f,p,g,m,x,y,v,w,b,C,T,E,S,R,I,O,_;return h(this,(function(h){switch(h.label){case 0:if(r=(0,i.L9e)(e,[0]),o=r.shape,a=o[0],s=o[1],l=o[2],t.length!==l)throw new Error("Expected heatmap to have same number of channels as the number of landmarks. But got landmarks length: "+t.length+", heatmap length: "+l);return c=[],[4,r.buffer()];case 1:for(d=h.sent(),f=0;f<t.length;f++)if(p=t[f],g=u({},p),c.push(g),m=Math.trunc(g.x*s),x=Math.trunc(g.y*a),!(m<0||m>=s||x<0||m>=a)){for(y=Math.trunc((n.kernelSize-1)/2),v=Math.max(0,m-y),w=Math.min(s,m+y+1),b=Math.max(0,x-y),C=Math.min(a,x+y+1),T=0,E=0,S=0,R=0,I=b;I<C;++I)for(O=v;O<w;++O)_=d.get(I,O,f),T+=_,R=Math.max(R,_),E+=O*_,S+=I*_;R>=n.minConfidenceToRefine&&T>0&&(g.x=E/s/T,g.y=S/a/T)}return r.dispose(),[2,c]}}))}))}function H(t,e){var n=e.left,r=e.top,i=e.left+e.right,o=e.top+e.bottom;return t.map((function(t){return u(u({},t),{x:(t.x-n)/(1-i),y:(t.y-r)/(1-o),z:t.z/(1-i)})}))}function X(t,e,n){return l(this,void 0,void 0,(function(){var r,o,a,s,u;return h(this,(function(l){switch(l.label){case 0:return r=t[0],o=t[1],a=function(t,e,n){return(0,i.lub)((function(){var r,o,a,s;n.reverseOutputOrder?(o=(0,i.L9e)((0,i.tPi)(t,[0,n.boxCoordOffset+0],[-1,1])),r=(0,i.L9e)((0,i.tPi)(t,[0,n.boxCoordOffset+1],[-1,1])),s=(0,i.L9e)((0,i.tPi)(t,[0,n.boxCoordOffset+2],[-1,1])),a=(0,i.L9e)((0,i.tPi)(t,[0,n.boxCoordOffset+3],[-1,1]))):(r=(0,i.L9e)((0,i.tPi)(t,[0,n.boxCoordOffset+0],[-1,1])),o=(0,i.L9e)((0,i.tPi)(t,[0,n.boxCoordOffset+1],[-1,1])),a=(0,i.L9e)((0,i.tPi)(t,[0,n.boxCoordOffset+2],[-1,1])),s=(0,i.L9e)((0,i.tPi)(t,[0,n.boxCoordOffset+3],[-1,1]))),o=(0,i.IHx)((0,i.dC7)((0,i.hiC)(o,n.xScale),e.w),e.x),r=(0,i.IHx)((0,i.dC7)((0,i.hiC)(r,n.yScale),e.h),e.y),n.applyExponentialOnBoxSize?(a=(0,i.dC7)((0,i.Qqt)((0,i.hiC)(a,n.hScale)),e.h),s=(0,i.dC7)((0,i.Qqt)((0,i.hiC)(s,n.wScale)),e.w)):(a=(0,i.dC7)((0,i.hiC)(a,n.hScale),e.h),s=(0,i.dC7)((0,i.hiC)(s,n.wScale),e.h));var u=(0,i.luU)(r,(0,i.hiC)(a,2)),l=(0,i.luU)(o,(0,i.hiC)(s,2)),h=(0,i.IHx)(r,(0,i.hiC)(a,2)),c=(0,i.IHx)(o,(0,i.hiC)(s,2)),d=(0,i.zoF)([(0,i.XLQ)(u,[n.numBoxes,1]),(0,i.XLQ)(l,[n.numBoxes,1]),(0,i.XLQ)(h,[n.numBoxes,1]),(0,i.XLQ)(c,[n.numBoxes,1])],1);if(n.numKeypoints)for(var f=0;f<n.numKeypoints;++f){var p=n.keypointCoordOffset+f*n.numValuesPerKeypoint,g=void 0,m=void 0;n.reverseOutputOrder?(g=(0,i.L9e)((0,i.tPi)(t,[0,p],[-1,1])),m=(0,i.L9e)((0,i.tPi)(t,[0,p+1],[-1,1]))):(m=(0,i.L9e)((0,i.tPi)(t,[0,p],[-1,1])),g=(0,i.L9e)((0,i.tPi)(t,[0,p+1],[-1,1])));var x=(0,i.IHx)((0,i.dC7)((0,i.hiC)(g,n.xScale),e.w),e.x),y=(0,i.IHx)((0,i.dC7)((0,i.hiC)(m,n.yScale),e.h),e.y);d=(0,i.zoF)([d,(0,i.XLQ)(x,[n.numBoxes,1]),(0,i.XLQ)(y,[n.numBoxes,1])],1)}return d}))}(o,e,n),s=(0,i.lub)((function(){var t=r;return n.sigmoidScore?(null!=n.scoreClippingThresh&&(t=(0,i.iUl)(r,-n.scoreClippingThresh,n.scoreClippingThresh)),t=(0,i.XD2)(t)):t})),[4,K(a,s,n)];case 1:return u=l.sent(),(0,i.B90)([a,s]),[2,u]}}))}))}function K(t,e,n){return l(this,void 0,void 0,(function(){var r,i,o,a,s,u,l,c,d,f,p,g;return h(this,(function(h){switch(h.label){case 0:return r=[],[4,t.data()];case 1:return i=h.sent(),[4,e.data()];case 2:for(o=h.sent(),a=0;a<n.numBoxes;++a)if(!(null!=n.minScoreThresh&&o[a]<n.minScoreThresh||(s=a*n.numCoords,u=Y(i[s+0],i[s+1],i[s+2],i[s+3],o[a],n.flipVertically,a),(l=u.locationData.relativeBoundingBox).width<0||l.height<0))){if(n.numKeypoints>0)for((c=u.locationData).relativeKeypoints=[],d=n.numKeypoints*n.numValuesPerKeypoint,f=0;f<d;f+=n.numValuesPerKeypoint)p=s+n.keypointCoordOffset+f,g={x:i[p+0],y:n.flipVertically?1-i[p+1]:i[p+1]},c.relativeKeypoints.push(g);r.push(u)}return[2,r]}}))}))}function Y(t,e,n,r,i,o,a){return{score:[i],ind:a,locationData:{relativeBoundingBox:{xMin:e,yMin:o?1-n:t,xMax:r,yMax:o?1-t:n,width:r-e,height:n-t}}}}function q(t,e){return"none"===t?e:function(t){return 1/(1+Math.exp(-t))}(e)}function Q(t,e,n,r){return l(this,void 0,void 0,(function(){var i,o,a,s,u,l,c,d;return h(this,(function(h){switch(h.label){case 0:return n=n||e.flipHorizontally||!1,r=r||e.flipVertically||!1,i=t.size,o=i/e.numLandmarks,[4,t.data()];case 1:for(a=h.sent(),s=[],u=0;u<e.numLandmarks;++u)l=u*o,(d={x:0,y:0}).x=n?e.inputImageWidth-a[l]:a[l],o>1&&(d.y=r?e.inputImageHeight-a[l+1]:a[l+1]),o>2&&(d.z=a[l+2]),o>3&&(d.score=q(e.visibilityActivation,a[l+3])),s.push(d);for(c=0;c<s.length;++c)(d=s[c]).x=d.x/e.inputImageWidth,d.y=d.y/e.inputImageHeight,d.z=d.z/e.inputImageWidth/(e.normalizeZ||1);return[2,s]}}))}))}function Z(t,e,n){var r=t.width,i=t.height,o=t.rotation;if(null==n.rotation&&null==n.rotationDegree||(o=function(t,e){return null!=e.rotation?t+=e.rotation:null!=e.rotationDegree&&(t+=Math.PI*e.rotationDegree/180),_(t)}(o,n)),0===o)t.xCenter=t.xCenter+r*n.shiftX,t.yCenter=t.yCenter+i*n.shiftY;else{var a=(e.width*r*n.shiftX*Math.cos(o)-e.height*i*n.shiftY*Math.sin(o))/e.width,s=(e.width*r*n.shiftX*Math.sin(o)+e.height*i*n.shiftY*Math.cos(o))/e.height;t.xCenter=t.xCenter+a,t.yCenter=t.yCenter+s}if(n.squareLong){var u=Math.max(r*e.width,i*e.height);r=u/e.width,i=u/e.height}else if(n.squareShort){var l=Math.min(r*e.width,i*e.height);r=l/e.width,i=l/e.height}return t.width=r*n.scaleX,t.height=i*n.scaleY,t}var J=function(){function t(t){this.alpha=t,this.initialized=!1}return t.prototype.apply=function(t,e){var n;return this.initialized?n=null==e?this.storedValue+this.alpha*(t-this.storedValue):this.storedValue+this.alpha*e*Math.asinh((t-this.storedValue)/e):(n=t,this.initialized=!0),this.rawValue=t,this.storedValue=n,n},t.prototype.applyWithAlpha=function(t,e,n){return this.alpha=e,this.apply(t,n)},t.prototype.hasLastRawValue=function(){return this.initialized},t.prototype.lastRawValue=function(){return this.rawValue},t.prototype.reset=function(){this.initialized=!1},t}(),tt=function(){function t(t){this.frequency=t.frequency,this.minCutOff=t.minCutOff,this.beta=t.beta,this.thresholdCutOff=t.thresholdCutOff,this.thresholdBeta=t.thresholdBeta,this.derivateCutOff=t.derivateCutOff,this.x=new J(this.getAlpha(this.minCutOff)),this.dx=new J(this.getAlpha(this.derivateCutOff)),this.lastTimestamp=0}return t.prototype.apply=function(t,e,n){if(null==t)return t;var r=Math.trunc(e);if(this.lastTimestamp>=r)return t;0!==this.lastTimestamp&&0!==r&&(this.frequency=1/(1e-6*(r-this.lastTimestamp))),this.lastTimestamp=r;var i=this.x.hasLastRawValue()?(t-this.x.lastRawValue())*n*this.frequency:0,o=this.dx.applyWithAlpha(i,this.getAlpha(this.derivateCutOff)),a=this.minCutOff+this.beta*Math.abs(o),s=null!=this.thresholdCutOff?this.thresholdCutOff+this.thresholdBeta*Math.abs(o):null;return this.x.applyWithAlpha(t,this.getAlpha(a),s)},t.prototype.getAlpha=function(t){return 1/(1+this.frequency/(2*Math.PI*t))},t}(),et=function(){function t(t){this.config=t}return t.prototype.apply=function(t,e,n){var r=this;if(null==t)return this.reset(),null;this.initializeFiltersIfEmpty(t);var i=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return c(t);i=1/n}return t.map((function(t,n){var o=u(u({},t),{x:r.xFilters[n].apply(t.x,e,i),y:r.yFilters[n].apply(t.y,e,i)});return null!=t.z&&(o.z=r.zFilters[n].apply(t.z,e,i)),o}))},t.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},t.prototype.initializeFiltersIfEmpty=function(t){var e=this;null!=this.xFilters&&this.xFilters.length===t.length||(this.xFilters=t.map((function(t){return new tt(e.config)})),this.yFilters=t.map((function(t){return new tt(e.config)})),this.zFilters=t.map((function(t){return new tt(e.config)})))},t}(),nt=function(){function t(t){this.config=t,this.window=[],this.lowPassFilter=new J(1),this.lastValue=0,this.lastValueScale=1,this.lastTimestamp=-1}return t.prototype.apply=function(t,e,n){if(null==t)return t;var r,i=Math.trunc(e);if(this.lastTimestamp>=i)return t;if(-1===this.lastTimestamp)r=1;else{for(var o=t*n-this.lastValue*this.lastValueScale,a=i-this.lastTimestamp,s=o,u=a,l=(1+this.window.length)*(1e6/30),h=0,c=this.window;h<c.length;h++){var d=c[h];if(u+d.duration>l)break;s+=d.distance,u+=d.duration}var f=s/(1e-6*u);r=1-1/(1+this.config.velocityScale*Math.abs(f)),this.window.unshift({distance:o,duration:a}),this.window.length>this.config.windowSize&&this.window.pop()}return this.lastValue=t,this.lastValueScale=n,this.lastTimestamp=i,this.lowPassFilter.applyWithAlpha(t,r)},t}(),rt=function(){function t(t){this.config=t}return t.prototype.apply=function(t,e,n){var r=this;if(null==t)return this.reset(),null;var i=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return c(t);i=1/n}return this.initializeFiltersIfEmpty(t),t.map((function(t,n){var o=u(u({},t),{x:r.xFilters[n].apply(t.x,e,i),y:r.yFilters[n].apply(t.y,e,i)});return null!=t.z&&(o.z=r.zFilters[n].apply(t.z,e,i)),o}))},t.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},t.prototype.initializeFiltersIfEmpty=function(t){var e=this;null!=this.xFilters&&this.xFilters.length===t.length||(this.xFilters=t.map((function(t){return new nt(e.config)})),this.yFilters=t.map((function(t){return new nt(e.config)})),this.zFilters=t.map((function(t){return new nt(e.config)})))},t}(),it=function(){function t(t){if(null!=t.velocityFilter)this.keypointsFilter=new rt(t.velocityFilter);else{if(null==t.oneEuroFilter)throw new Error("Either configure velocityFilter or oneEuroFilter, but got "+t+".");this.keypointsFilter=new et(t.oneEuroFilter)}}return t.prototype.apply=function(t,e,n,r,i){if(void 0===r&&(r=!1),null==t)return this.keypointsFilter.reset(),null;var o=null!=i?function(t,e){return(t.width*e.width+t.height*e.height)/2}(i,n):1,a=r?j(t,n):t,s=this.keypointsFilter.apply(a,e,o);return r?function(t,e){return t.map((function(t){var n=u(u({},t),{x:t.x/e.width,y:t.y/e.height});return null!=t.z&&(t.z=t.z/e.width),n}))}(s,n):s},t}(),ot=function(){function t(t){this.alpha=t.alpha}return t.prototype.apply=function(t){var e=this;if(null==t)return this.visibilityFilters=null,null;null!=this.visibilityFilters&&this.visibilityFilters.length===t.length||(this.visibilityFilters=t.map((function(t){return new J(e.alpha)})));for(var n=[],r=0;r<t.length;++r){var i=t[r],o=u({},i);o.score=this.visibilityFilters[r].apply(i.score),n.push(o)}return n},t}(),at={reduceBoxesInLowestlayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:5,minScale:.1484375,maxScale:.75,inputSizeHeight:224,inputSizeWidth:224,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,32,32,32],aspectRatios:[1],fixedAnchorSize:!0},st={runtime:"tfjs",modelType:"full",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/detector/1",landmarkModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"},ut={maxPoses:1,flipHorizontal:!1},lt={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2254,numCoords:12,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:4,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:224,yScale:224,hScale:224,wScale:224,minScoreThresh:.5},ht={shiftX:0,shiftY:0,scaleX:1.25,scaleY:1.25,squareLong:!0},ct={outputTensorSize:{width:224,height:224},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},dt={outputTensorSize:{width:256,height:256},keepAspectRatio:!0,outputTensorFloatRange:[0,1],borderMode:"zero"},ft={numLandmarks:39,inputImageWidth:256,inputImageHeight:256,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},pt={numLandmarks:39,inputImageWidth:1,inputImageHeight:1,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},gt={kernelSize:7,minConfidenceToRefine:.5},mt={alpha:.1},xt={oneEuroFilter:{frequency:30,minCutOff:.05,beta:80,derivateCutOff:1,minAllowedObjectScale:1e-6}},yt={oneEuroFilter:{frequency:30,minCutOff:.01,beta:10,derivateCutOff:1,minAllowedObjectScale:1e-6}},vt={oneEuroFilter:{frequency:30,minCutOff:.1,beta:40,derivateCutOff:1,minAllowedObjectScale:1e-6,disableValueScaling:!0}},wt={activation:"none"},bt={combineWithPreviousRatio:.7},Ct=function(){function t(t){this.mask=t}return t.prototype.toCanvasImageSource=function(){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,v(this.mask)]}))}))},t.prototype.toImageData=function(){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,w(this.mask)]}))}))},t.prototype.toTensor=function(){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this.mask]}))}))},t.prototype.getUnderlyingType=function(){return"tensor"},t}();function Tt(t){return C(t),"person"}var Et=function(){function t(t,e,n,r,o,a){this.detectorModel=t,this.landmarkModel=e,this.enableSmoothing=n,this.enableSegmentation=r,this.smoothSegmentation=o,this.modelType=a,this.regionOfInterest=null,this.prevFilteredSegmentationMask=null,this.anchors=function(t){null==t.reduceBoxesInLowestLayer&&(t.reduceBoxesInLowestLayer=!1),null==t.interpolatedScaleAspectRatio&&(t.interpolatedScaleAspectRatio=1),null==t.fixedAnchorSize&&(t.fixedAnchorSize=!1);for(var e=[],n=0;n<t.numLayers;){for(var r=[],i=[],o=[],a=[],s=n;s<t.strides.length&&t.strides[s]===t.strides[n];){var u=U(t.minScale,t.maxScale,s,t.strides.length);if(0===s&&t.reduceBoxesInLowestLayer)o.push(1),o.push(2),o.push(.5),a.push(.1),a.push(u),a.push(u);else{for(var l=0;l<t.aspectRatios.length;++l)o.push(t.aspectRatios[l]),a.push(u);if(t.interpolatedScaleAspectRatio>0){var h=s===t.strides.length-1?1:U(t.minScale,t.maxScale,s+1,t.strides.length);a.push(Math.sqrt(u*h)),o.push(t.interpolatedScaleAspectRatio)}}s++}for(var c=0;c<o.length;++c){var d=Math.sqrt(o[c]);r.push(a[c]/d),i.push(a[c]*d)}var f=0,p=0;if(t.featureMapHeight.length>0)f=t.featureMapHeight[n],p=t.featureMapWidth[n];else{var g=t.strides[n];f=Math.ceil(t.inputSizeHeight/g),p=Math.ceil(t.inputSizeWidth/g)}for(var m=0;m<f;++m)for(var x=0;x<p;++x)for(var y=0;y<r.length;++y){var v={xCenter:(x+t.anchorOffsetX)/p,yCenter:(m+t.anchorOffsetY)/f,width:0,height:0};t.fixedAnchorSize?(v.width=1,v.height=1):(v.width=i[y],v.height=r[y]),e.push(v)}n=s}return e}(at);var s=(0,i.RRF)(this.anchors.map((function(t){return t.width}))),u=(0,i.RRF)(this.anchors.map((function(t){return t.height}))),l=(0,i.RRF)(this.anchors.map((function(t){return t.xCenter}))),h=(0,i.RRF)(this.anchors.map((function(t){return t.yCenter})));this.anchorTensor={x:l,y:h,w:s,h:u},this.prevFilteredSegmentationMask=this.enableSegmentation?(0,i.odF)([],[0,0]):null}return t.prototype.estimatePoses=function(t,e,n){return l(this,void 0,void 0,(function(){var r,o,a,s,l,c,d,p,g,m,x,y,v,w,b,C,T,E,S,R,I,_,$;return h(this,(function(h){switch(h.label){case 0:return r=function(t){var e;if(null==(e=null==t?ut:u({},t)).maxPoses&&(e.maxPoses=1),e.maxPoses<=0)throw new Error("Invalid maxPoses "+e.maxPoses+". Should be > 0.");if(e.maxPoses>1)throw new Error("Multi-pose detection is not implemented yet. Please set maxPoses to 1.");return e}(e),null==t?(this.reset(),[2,[]]):(this.maxPoses=r.maxPoses,this.timestamp=null!=n?1e3*n:W(t)?1e6*t.currentTime:null,o=O(t),a=(0,i.lub)((function(){return(0,i.pju)(A(t),"float32")})),null!=(s=this.regionOfInterest)?[3,2]:[4,this.detectPose(a)]);case 1:if(0===(l=h.sent()).length)return this.reset(),a.dispose(),[2,[]];c=l[0],s=this.poseDetectionToRoi(c,o),h.label=2;case 2:return[4,this.poseLandmarksByRoi(s,a)];case 3:return d=h.sent(),a.dispose(),null==d?(this.reset(),[2,[]]):(p=d.landmarks,g=d.auxiliaryLandmarks,m=d.poseScore,x=d.worldLandmarks,y=d.segmentationMask,v=this.poseLandmarkFiltering(p,g,x,o),w=v.actualLandmarksFiltered,b=v.auxiliaryLandmarksFiltered,C=v.actualWorldLandmarksFiltered,T=this.poseLandmarksToRoi(b,o),this.regionOfInterest=T,E=this.smoothSegmentation&&null!=y?this.poseSegmentationFiltering(y):y,null!=(S=null!=w?j(w,o):null)&&S.forEach((function(t,e){t.name=f[e]})),null!=(R=C)&&R.forEach((function(t,e){t.name=f[e]})),I={score:m,keypoints:S,keypoints3D:R},null!==E&&(_=(0,i.lub)((function(){var t=(0,i.dt4)(E,2),e=(0,i.vku)(t,[[0,0],[0,0],[0,1]]);return(0,i.VdP)(e,[[0,0],[0,0],[0,2]],"symmetric")})),this.smoothSegmentation||(0,i.B90)(E),$={maskValueToLabel:Tt,mask:new Ct(_)},I.segmentation=$),[2,[I]])}}))}))},t.prototype.poseSegmentationFiltering=function(t){var e=this.prevFilteredSegmentationMask;return 0===e.size?this.prevFilteredSegmentationMask=t:(this.prevFilteredSegmentationMask=function(t,e,n){return"webgl"===(0,i.N_N)()?function(t,e,n){var r=n.combineWithPreviousRatio.toFixed(2),o={variableNames:["prevMask","newMask"],outputShape:t.shape,userCode:"\n  void main() {\n      ivec2 coords = getOutputCoords();\n      int height = coords[0];\n      int width = coords[1];\n\n      float prevMaskValue = getPrevMask(height, width);\n      float newMaskValue = getNewMask(height, width);\n\n      /*\n      * Assume p := newMaskValue\n      * H(p) := 1 + (p * log(p) + (1-p) * log(1-p)) / log(2)\n      * uncertainty alpha(p) =\n      *   Clamp(1 - (1 - H(p)) * (1 - H(p)), 0, 1) [squaring the\n      * uncertainty]\n      *\n      * The following polynomial approximates uncertainty alpha as a\n      * function of (p + 0.5):\n      */\n      const float c1 = 5.68842;\n      const float c2 = -0.748699;\n      const float c3 = -57.8051;\n      const float c4 = 291.309;\n      const float c5 = -624.717;\n      float t = newMaskValue - 0.5;\n      float x = t * t;\n\n      float uncertainty =\n        1.0 - min(1.0, x * (c1 + x * (c2 + x * (c3 + x * (c4 + x * c5)))));\n\n      float outputValue = newMaskValue + (prevMaskValue - newMaskValue) *\n                             (uncertainty * "+r+");\n\n      setOutput(outputValue);\n    }\n"},a=(0,i.y3$)();return(0,i.lub)((function(){var n=a.compileAndRun(o,[t,e]);return(0,i.SRH)().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}))}(t,e,n):(0,i.lub)((function(){var r=(0,i.luU)(e,.5),o=(0,i.h62)(r),a=(0,i.luU)(1,(0,i.LTh)(1,(0,i.dC7)(o,(0,i.IHx)(5.68842,(0,i.dC7)(o,(0,i.IHx)(-.748699,(0,i.dC7)(o,(0,i.IHx)(-57.8051,(0,i.dC7)(o,(0,i.IHx)(291.309,(0,i.dC7)(o,-624.717)))))))))));return(0,i.IHx)(e,(0,i.dC7)((0,i.luU)(t,e),(0,i.dC7)(a,n.combineWithPreviousRatio)))}))}(e,t,bt),(0,i.B90)(t)),(0,i.B90)(e),this.prevFilteredSegmentationMask},t.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),(0,i.B90)([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h,this.prevFilteredSegmentationMask])},t.prototype.reset=function(){this.regionOfInterest=null,this.enableSegmentation&&((0,i.B90)(this.prevFilteredSegmentationMask),this.prevFilteredSegmentationMask=(0,i.odF)([],[0,0])),this.visibilitySmoothingFilterActual=null,this.visibilitySmoothingFilterAuxiliary=null,this.landmarksSmoothingFilterActual=null,this.landmarksSmoothingFilterAuxiliary=null},t.prototype.detectPose=function(t){return l(this,void 0,void 0,(function(){var e,n,r,o,a,s,u,l,c,d;return h(this,(function(h){switch(h.label){case 0:return e=N(t,ct),n=e.imageTensor,r=e.padding,o=this.detectorModel.predict(n),a=function(t){return(0,i.lub)((function(){var e=function(t){return(0,i.lub)((function(){return[(0,i.tPi)(t,[0,0,0],[1,-1,1]),(0,i.tPi)(t,[0,0,1],[1,-1,-1])]}))}(t),n=e[0],r=e[1];return{boxes:(0,i.L9e)(r),logits:(0,i.L9e)(n)}}))}(o),s=a.boxes,[4,X([u=a.logits,s],this.anchorTensor,lt)];case 1:return 0===(l=h.sent()).length?((0,i.B90)([n,o,u,s]),[2,l]):[4,V(l,this.maxPoses,.3)];case 2:return c=h.sent(),d=function(t,e){void 0===t&&(t=[]);for(var n=e.left,r=e.top,i=e.left+e.right,o=e.top+e.bottom,a=0;a<t.length;a++){var s=t[a],u=s.locationData.relativeBoundingBox,l=(u.xMin-n)/(1-i),h=(u.yMin-r)/(1-o),c=u.width/(1-i),d=u.height/(1-o);u.xMin=l,u.yMin=h,u.width=c,u.height=d,u.xMax=l+c,u.yMax=h+d;var f=s.locationData.relativeKeypoints;f&&f.forEach((function(t){var e=(t.x-n)/(1-i),a=(t.y-r)/(1-o);t.x=e,t.y=a}))}return t}(c,r),(0,i.B90)([n,o,u,s]),[2,d]}}))}))},t.prototype.poseDetectionToRoi=function(t,e){return Z(k(t,e,{rotationVectorEndKeypointIndex:1,rotationVectorStartKeypointIndex:0,rotationVectorTargetAngleDegree:90}),e,ht)},t.prototype.poseLandmarksByRoi=function(t,e){return l(this,void 0,void 0,(function(){var n,r,o,a,s,l,c,d,f,p,g,m,x,y;return h(this,(function(h){switch(h.label){case 0:if(n=O(e),r=N(e,dt,t),o=r.imageTensor,a=r.padding,s=r.transformationMatrix,"lite"!==this.modelType&&"full"!==this.modelType&&"heavy"!==this.modelType)throw new Error("Model type must be one of lite, full or heavy,but got "+this.modelType);return l=["ld_3d","output_poseflag","activation_heatmap","world_3d"],this.enableSegmentation&&l.push("activation_segmentation"),c=this.landmarkModel.execute(o,l),[4,this.tensorsToPoseLandmarksAndSegmentation(c)];case 1:return null==(d=h.sent())?((0,i.B90)(c),(0,i.B90)(o),[2,null]):(f=d.landmarks,p=d.auxiliaryLandmarks,g=d.poseScore,m=d.worldLandmarks,x=d.segmentationMask,[4,this.poseLandmarksAndSegmentationInverseProjection(n,t,a,s,f,p,m,x)]);case 2:return y=h.sent(),(0,i.B90)(c),(0,i.B90)(o),[2,u({poseScore:g},y)]}}))}))},t.prototype.poseLandmarksAndSegmentationInverseProjection=function(t,e,n,r,o,a,s,c){return l(this,void 0,void 0,(function(){var l,d,f,p,g,m;return h(this,(function(h){return l=H(o,n),d=H(a,n),f=B(l,e),p=B(d,e),g=function(t,e){for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r],a=o.x,s=o.y,l=e.rotation,h=Math.cos(l)*a-Math.sin(l)*s,c=Math.sin(l)*a+Math.cos(l)*s,d=u({},o);d.x=h,d.y=c,n.push(d)}return n}(s,e),m=null,this.enableSegmentation&&(m=(0,i.lub)((function(){var e=c.shape,n=e[0],o=e[1],a=function(t){var e=F(new Array(16).fill(0));e[0][0]=L(t,0,0),e[1][0]=-L(t,0,1),e[2][0]=L(t,0,2),e[3][0]=-L(t,0,3),e[0][2]=L(t,2,0),e[1][2]=-L(t,2,1),e[2][2]=L(t,2,2),e[3][2]=-L(t,2,3),e[0][1]=-L(t,1,0),e[1][1]=L(t,1,1),e[2][1]=-L(t,1,2),e[3][1]=L(t,1,3),e[0][3]=-L(t,3,0),e[1][3]=L(t,3,1),e[2][3]=-L(t,3,2),e[3][3]=L(t,3,3);for(var n=t[0][0]*e[0][0]+t[1][0]*e[0][1]+t[2][0]*e[0][2]+t[3][0]*e[0][3],r=0;r<e.length;r++)for(var i=0;i<e.length;i++)e[r][i]/=n;return e}(r),s=(0,i.odF)($(a,{width:o,height:n},t),[1,8]),u=[1,n,o,1];return(0,i.L9e)(i.BHj.transform((0,i.XLQ)(c,u),s,"bilinear","constant",0,[t.height,t.width]),[0,3])})),(0,i.B90)(c)),[2,{landmarks:f,auxiliaryLandmarks:p,worldLandmarks:g,segmentationMask:m}]}))}))},t.prototype.tensorsToPoseLandmarksAndSegmentation=function(t){return l(this,void 0,void 0,(function(){var e,n,r,o,a,s,l,c,d,f,p,g,m;return h(this,(function(h){switch(h.label){case 0:return e=t[0],n=t[1],r=t[2],o=t[3],a=this.enableSegmentation?t[4]:null,[4,n.data()];case 1:return(s=h.sent()[0])<.5?[2,null]:[4,Q(e,ft)];case 2:return[4,z(h.sent(),r,gt)];case 3:return l=h.sent(),c=l.slice(0,33),d=l.slice(33,35),[4,Q(o,pt)];case 4:return f=h.sent(),p=f.slice(0,33),g=function(t,e,n){void 0===n&&(n=!0);for(var r=[],i=0;i<t.length;i++){var o=u({},e[i]);n&&(o.score=t[i].score),r.push(o)}return r}(c,p,!0),m=this.enableSegmentation?function(t,e,n){return(0,i.lub)((function(){var n=(0,i.L9e)(t,[0]),r=n.shape[2];if(1===r){var o=n;switch(e.activation){case"none":break;case"sigmoid":o=(0,i.XD2)(o);break;case"softmax":throw new Error("Softmax activation requires two channels.");default:throw new Error("Activation not supported ("+e.activation+")")}var a=o;return(0,i.L9e)(a,[2])}throw new Error("Unsupported number of tensor channels "+r)}))}(a,wt):null,[2,{landmarks:c,auxiliaryLandmarks:d,poseScore:s,worldLandmarks:g,segmentationMask:m}]}}))}))},t.prototype.poseLandmarksToRoi=function(t,e){return Z(k(G(t),e,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:1,rotationVectorTargetAngleDegree:90}),e,ht)},t.prototype.poseLandmarkFiltering=function(t,e,n,r){var i,o,a;if(null!=this.timestamp&&this.enableSmoothing){var s=k(G(e),r,{rotationVectorEndKeypointIndex:0,rotationVectorStartKeypointIndex:1,rotationVectorTargetAngleDegree:90});null==this.visibilitySmoothingFilterActual&&(this.visibilitySmoothingFilterActual=new ot(mt)),i=this.visibilitySmoothingFilterActual.apply(t),null==this.visibilitySmoothingFilterAuxiliary&&(this.visibilitySmoothingFilterAuxiliary=new ot(mt)),o=this.visibilitySmoothingFilterAuxiliary.apply(e),a=this.visibilitySmoothingFilterActual.apply(n),null==this.landmarksSmoothingFilterActual&&(this.landmarksSmoothingFilterActual=new it(xt)),i=this.landmarksSmoothingFilterActual.apply(i,this.timestamp,r,!0,s),null==this.landmarksSmoothingFilterAuxiliary&&(this.landmarksSmoothingFilterAuxiliary=new it(yt)),o=this.landmarksSmoothingFilterAuxiliary.apply(o,this.timestamp,r,!0,s),null==this.worldLandmarksSmoothingFilterActual&&(this.worldLandmarksSmoothingFilterActual=new it(vt)),a=this.worldLandmarksSmoothingFilterActual.apply(n,this.timestamp)}else i=t,o=e,a=n;return{actualLandmarksFiltered:i,auxiliaryLandmarksFiltered:o,actualWorldLandmarksFiltered:a}},t}();function St(t){return l(this,void 0,void 0,(function(){var e,n,r,i,a,s;return h(this,(function(l){switch(l.label){case 0:return e=function(t){var e=u({},null==t?st:t);if(null==e.enableSmoothing&&(e.enableSmoothing=st.enableSmoothing),null==e.enableSegmentation&&(e.enableSegmentation=st.enableSegmentation),null==e.smoothSegmentation&&(e.smoothSegmentation=st.smoothSegmentation),null==e.modelType&&(e.modelType=st.modelType),null==e.detectorModelUrl&&(e.detectorModelUrl=st.detectorModelUrl),null==e.landmarkModelUrl)switch(e.modelType){case"lite":e.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/lite/2";break;case"heavy":e.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/heavy/2";break;default:e.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"}return e}(t),n="string"==typeof e.detectorModelUrl&&e.detectorModelUrl.indexOf("https://tfhub.dev")>-1,r="string"==typeof e.landmarkModelUrl&&e.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([(0,o.YL)(e.detectorModelUrl,{fromTFHub:n}),(0,o.YL)(e.landmarkModelUrl,{fromTFHub:r})])];case 1:return i=l.sent(),a=i[0],s=i[1],[2,new Et(a,s,e.enableSmoothing,e.enableSegmentation,e.smoothSegmentation,e.modelType)]}}))}))}var Rt,It,Ot,_t=function(){function t(t){!function(t){if(t.maxTracks<1)throw new Error("Must specify 'maxTracks' to be at least 1, but encountered "+t.maxTracks);if(t.maxAge<=0)throw new Error("Must specify 'maxAge' to be positive, but encountered "+t.maxAge);if(void 0!==t.keypointTrackerParams){if(t.keypointTrackerParams.keypointConfidenceThreshold<0||t.keypointTrackerParams.keypointConfidenceThreshold>1)throw new Error("Must specify 'keypointConfidenceThreshold' to be in the range [0, 1], but encountered "+t.keypointTrackerParams.keypointConfidenceThreshold);if(t.keypointTrackerParams.minNumberOfKeypoints<1)throw new Error("Must specify 'minNumberOfKeypoints' to be at least 1, but encountered "+t.keypointTrackerParams.minNumberOfKeypoints);for(var e=0,n=t.keypointTrackerParams.keypointFalloff;e<n.length;e++){var r=n[e];if(r<=0)throw new Error("Must specify each keypoint falloff parameterto be positive but encountered "+r)}}}(t),this.tracks=[],this.maxTracks=t.maxTracks,this.maxAge=1e3*t.maxAge,this.minSimilarity=t.minSimilarity,this.nextID=1}return t.prototype.apply=function(t,e){this.filterOldTracks(e);var n=this.computeSimilarity(t);return this.assignTracks(t,n,e),this.updateTracks(e),t},t.prototype.getTracks=function(){return this.tracks.slice()},t.prototype.getTrackIDs=function(){return new Set(this.tracks.map((function(t){return t.id})))},t.prototype.filterOldTracks=function(t){var e=this;this.tracks=this.tracks.filter((function(n){return t-n.lastTimestamp<=e.maxAge}))},t.prototype.assignTracks=function(t,e,n){for(var r=Array.from(Array(e[0].length).keys()),i=[],o=0,a=Array.from(Array(t.length).keys());o<a.length;o++){var s=a[o];if(0!==r.length){for(var u=-1,l=-1,h=0,c=r;h<c.length;h++){var d=c[h],f=e[s][d];f>=this.minSimilarity&&f>l&&(u=d,l=f)}if(u>=0){var p=this.tracks[u];p=Object.assign(p,this.createTrack(t[s],n,p.id)),t[s].id=p.id;var g=r.indexOf(u);r.splice(g,1)}else i.push(s)}else i.push(s)}for(var m=0,x=i;m<x.length;m++){s=x[m];var y=this.createTrack(t[s],n);this.tracks.push(y),t[s].id=y.id}},t.prototype.updateTracks=function(t){this.tracks.sort((function(t,e){return e.lastTimestamp-t.lastTimestamp})),this.tracks=this.tracks.slice(0,this.maxTracks)},t.prototype.createTrack=function(t,e,n){var r={id:n||this.nextTrackID(),lastTimestamp:e,keypoints:c(t.keypoints).map((function(t){return u({},t)}))};return void 0!==t.box&&(r.box=u({},t.box)),r},t.prototype.nextTrackID=function(){var t=this.nextID;return this.nextID+=1,t},t.prototype.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.tracks=this.tracks.filter((function(e){return!t.includes(e.id)}))},t.prototype.reset=function(){this.tracks=[]},t}(),At=function(t){function e(e){return t.call(this,e)||this}return s(e,t),e.prototype.computeSimilarity=function(t){var e=this;return 0===t.length||0===this.tracks.length?[[]]:t.map((function(t){return e.tracks.map((function(n){return e.iou(t,n)}))}))},e.prototype.iou=function(t,e){var n=Math.max(t.box.xMin,e.box.xMin),r=Math.max(t.box.yMin,e.box.yMin),i=Math.min(t.box.xMax,e.box.xMax),o=Math.min(t.box.yMax,e.box.yMax);if(n>=i||r>=o)return 0;var a=(i-n)*(o-r);return a/(t.box.width*t.box.height+e.box.width*e.box.height-a)},e}(_t),$t=function(t){function e(e){var n=t.call(this,e)||this;return n.keypointThreshold=e.keypointTrackerParams.keypointConfidenceThreshold,n.keypointFalloff=e.keypointTrackerParams.keypointFalloff,n.minNumKeyoints=e.keypointTrackerParams.minNumberOfKeypoints,n}return s(e,t),e.prototype.computeSimilarity=function(t){if(0===t.length||0===this.tracks.length)return[[]];for(var e=[],n=0,r=t;n<r.length;n++){for(var i=r[n],o=[],a=0,s=this.tracks;a<s.length;a++){var u=s[a];o.push(this.oks(i,u))}e.push(o)}return e},e.prototype.oks=function(t,e){for(var n=this.area(e.keypoints)+1e-6,r=0,i=0,o=0;o<t.keypoints.length;++o){var a=t.keypoints[o],s=e.keypoints[o];if(!(a.score<this.keypointThreshold||s.score<this.keypointThreshold)){i+=1;var u=Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2),l=2*this.keypointFalloff[o];r+=Math.exp(-1*u/(2*n*Math.pow(l,2)))}}return i<this.minNumKeyoints?0:r/i},e.prototype.area=function(t){var e=this,n=t.filter((function(t){return t.score>e.keypointThreshold})),r=Math.min.apply(Math,c([1],n.map((function(t){return t.x})))),i=Math.max.apply(Math,c([0],n.map((function(t){return t.x})))),o=Math.min.apply(Math,c([1],n.map((function(t){return t.y}))));return(i-r)*(Math.max.apply(Math,c([0],n.map((function(t){return t.y}))))-o)},e}(_t);function Dt(t){switch(t){case It.BlazePose:return f.reduce((function(t,e,n){return t[e]=n,t}),{});case It.PoseNet:case It.MoveNet:return d.reduce((function(t,e,n){return t[e]=n,t}),{});default:throw new Error("Model "+t+" is not supported.")}}(Ot=Rt||(Rt={})).Keypoint="keypoint",Ot.BoundingBox="boundingBox",function(t){t.MoveNet="MoveNet",t.BlazePose="BlazePose",t.PoseNet="PoseNet"}(It||(It={})),Object.freeze({__proto__:null,getKeypointIndexBySide:function(t){switch(t){case It.BlazePose:return p;case It.PoseNet:case It.MoveNet:return g;default:throw new Error("Model "+t+" is not supported.")}},getAdjacentPairs:function(t){switch(t){case It.BlazePose:return x;case It.PoseNet:case It.MoveNet:return m;default:throw new Error("Model "+t+" is not supported.")}},getKeypointIndexByName:Dt});var kt=["SinglePose.Lightning","SinglePose.Thunder","MultiPose.Lightning"],Ft={modelType:"SinglePose.Lightning",enableSmoothing:!0},Pt={},Lt={frequency:30,minCutOff:2.5,beta:300,derivateCutOff:2.5,thresholdCutOff:.5,thresholdBeta:5,disableValueScaling:!0},Bt={maxTracks:18,maxAge:1e3,minSimilarity:.2,keypointTrackerParams:{keypointConfidenceThreshold:.3,keypointFalloff:[.026,.025,.025,.035,.035,.079,.079,.072,.072,.062,.062,.107,.107,.087,.087,.089,.089],minNumberOfKeypoints:4}},Mt={maxTracks:18,maxAge:1e3,minSimilarity:.15,trackerParams:{}};function Nt(t,e){var n,r,i,o;return t?e.width>e.height?(n=1,r=e.height/e.width,i=0,o=(e.width/2-e.height/2)/e.width):(n=e.width/e.height,r=1,i=(e.height/2-e.width/2)/e.height,o=0):e.width>e.height?(n=e.width/e.height,r=1,i=(e.height/2-e.width/2)/e.height,o=0):(n=1,r=e.height/e.width,i=0,o=(e.width/2-e.height/2)/e.width),{yMin:i,xMin:o,yMax:i+n,xMax:o+r,height:n,width:r}}function Ut(t,e){var n={maxTracks:t.maxTracks,maxAge:t.maxAge,minSimilarity:t.minSimilarity};return null!=e.maxTracks&&(n.maxTracks=e.maxTracks),null!=e.maxAge&&(n.maxAge=e.maxAge),null!=e.minSimilarity&&(n.minSimilarity=e.minSimilarity),n}var Wt=function(){function t(t,e){this.moveNetModel=t,this.modelInputResolution={height:0,width:0},this.keypointIndexByName=Dt(It.MoveNet),"SinglePose.Lightning"===e.modelType?(this.modelInputResolution.width=192,this.modelInputResolution.height=192):"SinglePose.Thunder"===e.modelType&&(this.modelInputResolution.width=256,this.modelInputResolution.height=256),this.multiPoseModel="MultiPose.Lightning"===e.modelType,this.multiPoseModel||(this.keypointFilter=new et(Lt),this.cropRegionFilterYMin=new J(.9),this.cropRegionFilterXMin=new J(.9),this.cropRegionFilterYMax=new J(.9),this.cropRegionFilterXMax=new J(.9)),this.enableSmoothing=e.enableSmoothing,e.minPoseScore?this.minPoseScore=e.minPoseScore:this.minPoseScore=.25,e.multiPoseMaxDimension?this.multiPoseMaxDimension=e.multiPoseMaxDimension:this.multiPoseMaxDimension=256,this.enableTracking=e.enableTracking,this.multiPoseModel&&this.enableTracking&&(e.trackerType===Rt.Keypoint?this.tracker=new $t(e.trackerConfig):e.trackerType===Rt.BoundingBox&&(this.tracker=new At(e.trackerConfig)),this.enableSmoothing&&(this.keypointFilterMap=new Map))}return t.prototype.runSinglePersonPoseModel=function(t){return l(this,void 0,void 0,(function(){var e,n,r,o,a;return h(this,(function(s){switch(s.label){case 0:if(4!==(e=this.moveNetModel.execute(t)).shape.length||1!==e.shape[0]||1!==e.shape[1]||17!==e.shape[2]||3!==e.shape[3])throw e.dispose(),new Error("Unexpected output shape from model: ["+e.shape+"]");return"webgpu"===(0,i.N_N)()?[3,1]:(n=e.dataSync(),[3,3]);case 1:return[4,e.data()];case 2:n=s.sent(),s.label=3;case 3:for(e.dispose(),r={keypoints:[],score:0},o=0,a=0;a<17;++a)r.keypoints[a]={y:n[3*a],x:n[3*a+1],score:n[3*a+2]},r.keypoints[a].score>.2&&(++o,r.score+=r.keypoints[a].score);return o>0&&(r.score/=o),[2,r]}}))}))},t.prototype.runMultiPersonPoseModel=function(t){return l(this,void 0,void 0,(function(){var e,n,r,o,a,s,u,l;return h(this,(function(h){switch(h.label){case 0:if(3!==(e=this.moveNetModel.execute(t)).shape.length||1!==e.shape[0]||56!==e.shape[2])throw e.dispose(),new Error("Unexpected output shape from model: ["+e.shape+"]");return"webgpu"===(0,i.N_N)()?[3,1]:(n=e.dataSync(),[3,3]);case 1:return[4,e.data()];case 2:n=h.sent(),h.label=3;case 3:for(e.dispose(),r=[],o=n.length/56,a=0;a<o;++a)for(r[a]={keypoints:[]},s=56*a+51,r[a].box={yMin:n[s],xMin:n[s+1],yMax:n[s+2],xMax:n[s+3],width:n[s+3]-n[s+1],height:n[s+2]-n[s]},u=56*a+55,r[a].score=n[u],r[a].keypoints=[],l=0;l<17;++l)r[a].keypoints[l]={y:n[56*a+3*l],x:n[56*a+3*l+1],score:n[56*a+3*l+2]};return[2,r]}}))}))},t.prototype.estimatePoses=function(t,e,n){return void 0===e&&(e=Pt),l(this,void 0,void 0,(function(){var r,o,a,s,l,c;return h(this,(function(h){switch(h.label){case 0:return e=function(t){return null==t?Pt:u({},t)}(e),null==t?(this.reset(),[2,[]]):(null==n?W(t)&&(n=1e6*t.currentTime):n*=1e3,r=A(t),o=O(r),a=(0,i.dt4)(r,0),t instanceof i.esB||r.dispose(),s=[],this.multiPoseModel?[3,2]:[4,this.estimateSinglePose(a,o,n)]);case 1:return s=h.sent(),[3,4];case 2:return[4,this.estimateMultiplePoses(a,o,n)];case 3:s=h.sent(),h.label=4;case 4:for(l=0;l<s.length;++l)for(c=0;c<s[l].keypoints.length;++c)s[l].keypoints[c].name=d[c],s[l].keypoints[c].y*=o.height,s[l].keypoints[c].x*=o.width;return[2,s]}}))}))},t.prototype.estimateSinglePose=function(t,e,n){return l(this,void 0,void 0,(function(){var r,o,a,s,u=this;return h(this,(function(l){switch(l.label){case 0:return this.cropRegion||(this.cropRegion=Nt(null==this.cropRegion,e)),r=(0,i.lub)((function(){var e=(0,i.odF)([[u.cropRegion.yMin,u.cropRegion.xMin,u.cropRegion.yMax,u.cropRegion.xMax]]),n=(0,i.lls)([1],"int32"),r=[u.modelInputResolution.height,u.modelInputResolution.width];return(0,i.pju)(i.BHj.cropAndResize(t,e,n,r,"bilinear",0),"int32")})),t.dispose(),[4,this.runSinglePersonPoseModel(r)];case 1:if(o=l.sent(),r.dispose(),o.score<this.minPoseScore)return this.reset(),[2,[]];for(a=0;a<o.keypoints.length;++a)o.keypoints[a].y=this.cropRegion.yMin+o.keypoints[a].y*this.cropRegion.height,o.keypoints[a].x=this.cropRegion.xMin+o.keypoints[a].x*this.cropRegion.width;return null!=n&&this.enableSmoothing&&(o.keypoints=this.keypointFilter.apply(o.keypoints,n,1)),s=function(t,e,n,r){for(var i={},o=0,a=d;o<a.length;o++){var s=a[o];i[s]=[e[n[s]].y*r.height,e[n[s]].x*r.width]}if(function(t,e){return(t[e.left_hip].score>.2||t[e.right_hip].score>.2)&&(t[e.left_shoulder].score>.2||t[e.right_shoulder].score>.2)}(e,n)){var u=(i.left_hip[0]+i.right_hip[0])/2,l=(i.left_hip[1]+i.right_hip[1])/2,h=function(t,e,n,r,i){for(var o=["left_shoulder","right_shoulder","left_hip","right_hip"],a=0,s=0,u=0;u<o.length;u++)(f=Math.abs(r-n[o[u]][0]))>a&&(a=f),(p=Math.abs(i-n[o[u]][1]))>s&&(s=p);for(var l=0,h=0,c=0,d=Object.keys(n);c<d.length;c++){var f,p,g=d[c];t[e[g]].score<.2||((f=Math.abs(r-n[g][0]))>l&&(l=f),(p=Math.abs(i-n[g][1]))>h&&(h=p))}return[a,s,l,h]}(e,n,i,u,l),c=h[0],f=h[1],p=h[2],g=h[3],m=Math.max(1.9*f,1.9*c,1.2*p,1.2*g),x=[u-(m=Math.min(m,Math.max(l,r.width-l,u,r.height-u))),l-m];if(m>Math.max(r.width,r.height)/2)return Nt(null==t,r);var y=2*m;return{yMin:x[0]/r.height,xMin:x[1]/r.width,yMax:(x[0]+y)/r.height,xMax:(x[1]+y)/r.width,height:(x[0]+y)/r.height-x[0]/r.height,width:(x[1]+y)/r.width-x[1]/r.width}}return Nt(null==t,r)}(this.cropRegion,o.keypoints,this.keypointIndexByName,e),this.cropRegion=this.filterCropRegion(s),[2,[o]]}}))}))},t.prototype.estimateMultiplePoses=function(t,e,n){return l(this,void 0,void 0,(function(){var r,o,a,s,u,l,c,d,f,p,g,m=this;return h(this,(function(h){switch(h.label){case 0:return e.width>e.height?(o=this.multiPoseMaxDimension,a=Math.round(this.multiPoseMaxDimension*e.height/e.width),r=i.BHj.resizeBilinear(t,[a,o]),u=o,l=32*Math.ceil(a/32),s=(0,i.vku)(r,[[0,0],[0,l-a],[0,0],[0,0]])):(o=Math.round(this.multiPoseMaxDimension*e.width/e.height),a=this.multiPoseMaxDimension,r=i.BHj.resizeBilinear(t,[a,o]),u=32*Math.ceil(o/32),l=a,s=(0,i.vku)(r,[[0,0],[0,0],[0,u-o],[0,0]])),r.dispose(),t.dispose(),c=(0,i.pju)(s,"int32"),s.dispose(),[4,this.runMultiPersonPoseModel(c)];case 1:for(d=h.sent(),c.dispose(),d=d.filter((function(t){return t.score>=m.minPoseScore})),p=0;p<d.length;++p)for(f=0;f<d[p].keypoints.length;++f)d[p].keypoints[f].y*=l/a,d[p].keypoints[f].x*=u/o;if(this.enableTracking&&(this.tracker.apply(d,n),this.enableSmoothing)){for(p=0;p<d.length;++p)this.keypointFilterMap.has(d[p].id)||this.keypointFilterMap.set(d[p].id,new et(Lt)),d[p].keypoints=this.keypointFilterMap.get(d[p].id).apply(d[p].keypoints,n,1);g=this.tracker.getTrackIDs(),this.keypointFilterMap.forEach((function(t,e){g.has(e)||m.keypointFilterMap.delete(e)}))}return[2,d]}}))}))},t.prototype.filterCropRegion=function(t){if(t){var e=this.cropRegionFilterYMin.apply(t.yMin),n=this.cropRegionFilterXMin.apply(t.xMin),r=this.cropRegionFilterYMax.apply(t.yMax),i=this.cropRegionFilterXMax.apply(t.xMax);return{yMin:e,xMin:n,yMax:r,xMax:i,height:r-e,width:i-n}}return this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset(),null},t.prototype.dispose=function(){this.moveNetModel.dispose()},t.prototype.reset=function(){this.cropRegion=null,this.resetFilters()},t.prototype.resetFilters=function(){this.keypointFilter.reset(),this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset()},t}();function Gt(t){return void 0===t&&(t=Ft),l(this,void 0,void 0,(function(){var e,n,r,a;return h(this,(function(s){switch(s.label){case 0:return e=function(t){var e,n=null==t?Ft:u({},t);if(null==n.modelType)n.modelType="SinglePose.Lightning";else if(kt.indexOf(n.modelType)<0)throw new Error("Invalid architecture "+n.modelType+". Should be one of "+kt);if(null==n.enableSmoothing&&(n.enableSmoothing=!0),null!=n.minPoseScore&&(n.minPoseScore<0||n.minPoseScore>1))throw new Error("minPoseScore should be between 0.0 and 1.0");if(null!=n.multiPoseMaxDimension&&(n.multiPoseMaxDimension%32!=0||n.multiPoseMaxDimension<32))throw new Error("multiPoseMaxDimension must be a multiple of 32 and higher than 0");if("MultiPose.Lightning"===n.modelType&&null==n.enableTracking&&(n.enableTracking=!0),"MultiPose.Lightning"===n.modelType&&!0===n.enableTracking)if(null==n.trackerType&&(n.trackerType=Rt.BoundingBox),n.trackerType===Rt.Keypoint)null!=n.trackerConfig?n.trackerConfig=function(t){var e=Ut(Bt,t);return e.keypointTrackerParams=u({},Bt.keypointTrackerParams),null!=t.keypointTrackerParams&&(null!=t.keypointTrackerParams.keypointConfidenceThreshold&&(e.keypointTrackerParams.keypointConfidenceThreshold=t.keypointTrackerParams.keypointConfidenceThreshold),null!=t.keypointTrackerParams.keypointFalloff&&(e.keypointTrackerParams.keypointFalloff=t.keypointTrackerParams.keypointFalloff),null!=t.keypointTrackerParams.minNumberOfKeypoints&&(e.keypointTrackerParams.minNumberOfKeypoints=t.keypointTrackerParams.minNumberOfKeypoints)),e}(n.trackerConfig):n.trackerConfig=Bt;else{if(n.trackerType!==Rt.BoundingBox)throw new Error("Tracker type not supported by MoveNet");null!=n.trackerConfig?n.trackerConfig=(e=n.trackerConfig,Ut(Mt,e)):n.trackerConfig=Mt}return n}(t),r=!0,e.modelUrl?(r="string"==typeof e.modelUrl&&e.modelUrl.indexOf("https://tfhub.dev")>-1,[4,(0,o.YL)(e.modelUrl,{fromTFHub:r})]):[3,2];case 1:return n=s.sent(),[3,4];case 2:return a=void 0,"SinglePose.Lightning"===e.modelType?a="https://tfhub.dev/google/tfjs-model/movenet/singlepose/lightning/4":"SinglePose.Thunder"===e.modelType?a="https://tfhub.dev/google/tfjs-model/movenet/singlepose/thunder/4":"MultiPose.Lightning"===e.modelType&&(a="https://tfhub.dev/google/tfjs-model/movenet/multipose/lightning/1"),[4,(0,o.YL)(a,{fromTFHub:r})];case 3:n=s.sent(),s.label=4;case 4:return"webgl"===(0,i.N_N)()&&(0,i.OBj)().set("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",0),[2,new Wt(n,e)]}}))}))}var Vt={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:{height:257,width:257}},jt=["MobileNetV1","ResNet50"],zt={MobileNetV1:[8,16],ResNet50:[16]},Ht=[8,16,32],Xt={MobileNetV1:[.5,.75,1],ResNet50:[1]},Kt=[1,2,4],Yt={maxPoses:1,flipHorizontal:!1},qt={maxPoses:5,flipHorizontal:!1,scoreThreshold:.5,nmsRadius:20},Qt=[-123.15,-115.9,-103.06];function Zt(t){return Math.floor(t/2)}var Jt=function(){function t(t,e){this.priorityQueue=new Array(t),this.numberOfElements=-1,this.getElementValue=e}return t.prototype.enqueue=function(t){this.priorityQueue[++this.numberOfElements]=t,this.swim(this.numberOfElements)},t.prototype.dequeue=function(){var t=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,t},t.prototype.empty=function(){return-1===this.numberOfElements},t.prototype.size=function(){return this.numberOfElements+1},t.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},t.prototype.max=function(){return this.priorityQueue[0]},t.prototype.swim=function(t){for(;t>0&&this.less(Zt(t),t);)this.exchange(t,Zt(t)),t=Zt(t)},t.prototype.sink=function(t){for(;2*t<=this.numberOfElements;){var e=2*t;if(e<this.numberOfElements&&this.less(e,e+1)&&e++,!this.less(t,e))break;this.exchange(t,e),t=e}},t.prototype.getValueAt=function(t){return this.getElementValue(this.priorityQueue[t])},t.prototype.less=function(t,e){return this.getValueAt(t)<this.getValueAt(e)},t.prototype.exchange=function(t,e){var n=this.priorityQueue[t];this.priorityQueue[t]=this.priorityQueue[e],this.priorityQueue[e]=n},t}();function te(t,e,n,r,i,o){for(var a=o.shape,s=a[0],u=a[1],l=!0,h=Math.max(n-i,0),c=Math.min(n+i+1,s),d=h;d<c;++d){for(var f=Math.max(r-i,0),p=Math.min(r+i+1,u),g=f;g<p;++g)if(o.get(d,g,t)>e){l=!1;break}if(!l)break}return l}function ee(t){return l(this,void 0,void 0,(function(){return h(this,(function(e){return[2,Promise.all(t.map((function(t){return t.buffer()})))]}))}))}function ne(t,e,n,r){return{y:r.get(t,e,n),x:r.get(t,e,n+17)}}function re(t,e,n){var r=ne(t.heatmapY,t.heatmapX,t.id,n),i=r.y,o=r.x;return{x:t.heatmapX*e+o,y:t.heatmapY*e+i}}function ie(t,e,n,r){var i=n.x,o=n.y;return t.some((function(t){var n,a,s,u,l=t.keypoints;return n=o,a=i,(s=l[r].y-n)*s+(u=l[r].x-a)*u<=e}))}var oe=d.reduce((function(t,e,n){return t[e]=n,t}),{}),ae=[["nose","left_eye"],["left_eye","left_ear"],["nose","right_eye"],["right_eye","right_ear"],["nose","left_shoulder"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["nose","right_shoulder"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"]].map((function(t){var e=t[0],n=t[1];return[oe[e],oe[n]]})),se=ae.map((function(t){return t[1]})),ue=ae.map((function(t){return t[0]}));function le(t,e,n){return t<e?e:t>n?n:t}function he(t,e,n,r){return{y:le(Math.round(t.y/e),0,n-1),x:le(Math.round(t.x/e),0,r-1)}}function ce(t,e){return{x:t.x+e.x,y:t.y+e.y}}function de(t,e,n,r,i,o,a,s){void 0===s&&(s=2);for(var u=r.shape,l=u[0],h=u[1],c={y:e.y,x:e.x},f=ce(c,function(t,e,n){var r=n.shape[2]/2;return{y:n.get(e.y,e.x,t),x:n.get(e.y,e.x,r+t)}}(t,he(c,o,l,h),a)),p=0;p<s;p++){var g=he(f,o,l,h),m=ne(g.y,g.x,n,i);f=ce({x:g.x*o,y:g.y*o},{x:m.x,y:m.y})}var x=he(f,o,l,h),y=r.get(x.y,x.x,n);return{y:f.y,x:f.x,name:d[n],score:y}}function fe(t,e,n,r,i,o){var a=e.shape[2],s=se.length,u=new Array(a),l=t.part,h=t.score,c=re(l,r,n);u[l.id]={score:h,name:d[l.id],y:c.y,x:c.x};for(var f=s-1;f>=0;--f){var p=se[f],g=ue[f];u[p]&&!u[g]&&(u[g]=de(f,u[p],g,e,n,r,o))}for(f=0;f<s;++f)p=ue[f],g=se[f],u[p]&&!u[g]&&(u[g]=de(f,u[p],g,e,n,r,i));return u}function pe(t,e,n){return n.reduce((function(n,r,i){var o=r.y,a=r.x,s=r.score;return ie(t,e,{y:o,x:a},i)||(n+=s),n}),0)/n.length}function ge(t,e,n,r,i,o,a,s){return void 0===a&&(a=.5),void 0===s&&(s=20),l(this,void 0,void 0,(function(){var u,l,c,d,f,p,g,m,x,y,v,w;return h(this,(function(h){switch(h.label){case 0:return[4,ee([t,e,n,r])];case 1:for(u=h.sent(),l=u[0],c=u[1],d=u[2],f=u[3],p=[],g=function(t,e,n){for(var r=n.shape,i=r[0],o=r[1],a=r[2],s=new Jt(i*o*a,(function(t){return t.score})),u=0;u<i;++u)for(var l=0;l<o;++l)for(var h=0;h<a;++h){var c=n.get(u,l,h);c<t||te(h,c,u,l,1,n)&&s.enqueue({score:c,part:{heatmapY:u,heatmapX:l,id:h}})}return s}(a,0,l),m=s*s;p.length<o&&!g.empty();)x=g.dequeue(),y=re(x.part,i,c),ie(p,m,y,x.part.id)||(v=fe(x,l,c,i,d,f),w=pe(p,m,v),p.push({keypoints:v,score:w}));return[2,p]}}))}))}function me(t,e,n){return(0,i.lub)((function(){var r=function(t,e){for(var n=[],r=0;r<d.length;r++){var o=xe(t.get(r,0).valueOf(),t.get(r,1).valueOf(),r,e),a=o.x,s=o.y;n.push(s),n.push(a)}return(0,i.odF)(n,[d.length,2])}(t,n);return(0,i.IHx)((0,i.pju)((0,i.dC7)(t.toTensor(),(0,i.iD$)(e,"int32")),"float32"),r)}))}function xe(t,e,n,r){return{y:r.get(t,e,n),x:r.get(t,e,n+d.length)}}function ye(t,e,n){return l(this,void 0,void 0,(function(){var r,o,a,s,u,l,c,f,p,g;return h(this,(function(h){switch(h.label){case 0:return r=0,o=function(t){var e=t.shape,n=e[0],r=e[1],o=e[2];return(0,i.lub)((function(){var e,a,s=(0,i.XLQ)(t,[n*r,o]),u=(0,i.NqF)(s,0),l=(0,i.dt4)((0,i.hiC)(u,(0,i.iD$)(r,"int32")),1),h=(0,i.dt4)((e=u,a=r,(0,i.lub)((function(){var t=(0,i.hiC)(e,(0,i.iD$)(a,"int32"));return(0,i.luU)(e,(0,i.dC7)(t,(0,i.iD$)(a,"int32")))}))),1);return(0,i.zoF)([l,h],1)}))}(t),[4,Promise.all([t.buffer(),e.buffer(),o.buffer()])];case 1:return a=h.sent(),s=a[0],u=a[1],l=a[2],[4,(c=me(l,n,u)).buffer()];case 2:return f=h.sent(),p=Array.from(function(t,e){for(var n=e.shape[0],r=new Float32Array(n),i=0;i<n;i++){var o=e.get(i,0),a=e.get(i,1);r[i]=t.get(o,a,i)}return r}(s,l)),g=p.map((function(t,e){return r+=t,{y:f.get(e,0),x:f.get(e,1),score:t,name:d[e]}})),o.dispose(),c.dispose(),[2,{keypoints:g,score:r/g.length}]}}))}))}function ve(t,e){return(t-1)%e==0}var we="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",be="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/";function Ce(t,e){return function(t,e){return(t-1)%e==0}(t,e)?t:Math.floor(t/e)*e+1}var Te=function(){function t(t,e){this.posenetModel=t;var n=this.posenetModel.inputs[0].shape;i.D5U.assert(-1===n[1]&&-1===n[2],(function(){return"Input shape ["+n[1]+", "+n[2]+"] must both be equal to or -1"}));var r,o,a=(r=e.inputResolution,o=e.outputStride,{height:Ce(r.height,o),width:Ce(r.width,o)});!function(t){i.D5U.assert(Ht.indexOf(t)>=0,(function(){return"outputStride of "+t+" is invalid. It must be either 8 or 16."}))}(e.outputStride),function(t,e){i.D5U.assert(ve(t.height,e),(function(){return"height of "+t.height+" is invalid for output stride "+e+"."})),i.D5U.assert(ve(t.width,e),(function(){return"width of "+t.width+" is invalid for output stride "+e+"."}))}(a,e.outputStride),this.inputResolution=a,this.outputStride=e.outputStride,this.architecture=e.architecture}return t.prototype.estimatePoses=function(t,e){return void 0===e&&(e=Yt),l(this,void 0,void 0,(function(){var n,r,o,a,s,l,c,d,f,p,g,m,x,y,v;return h(this,(function(h){switch(h.label){case 0:return n=function(t){var e=t;if(null==e.maxPoses&&(e.maxPoses=1),e.maxPoses<=0)throw new Error("Invalid maxPoses "+e.maxPoses+". Should be > 0.");if(e.maxPoses>1){if((e=u(u({},qt),e)).scoreThreshold<0||e.scoreThreshold>1)throw new Error("Invalid scoreThreshold "+e.scoreThreshold+". Should be in range [0.0, 1.0]");if(e.nmsRadius<=0)throw new Error("Invalid nmsRadius "+e.nmsRadius+".")}return e}(e),null==t?[2,[]]:(this.maxPoses=n.maxPoses,r=N(t,{outputTensorSize:this.inputResolution,keepAspectRatio:!0,borderMode:"replicate"}),o=r.imageTensor,a=r.padding,s="ResNet50"===this.architecture?(0,i.IHx)(o,Qt):M(o,[-1,1]),l=this.posenetModel.predict(s),"ResNet50"===this.architecture?(c=(0,i.L9e)(l[2],[0]),d=(0,i.L9e)(l[3],[0]),f=(0,i.L9e)(l[0],[0]),p=(0,i.L9e)(l[1],[0])):(c=(0,i.L9e)(l[0],[0]),d=(0,i.L9e)(l[1],[0]),f=(0,i.L9e)(l[2],[0]),p=(0,i.L9e)(l[3],[0])),g=(0,i.XD2)(d),1!==this.maxPoses?[3,2]:[4,ye(g,c,this.outputStride)]);case 1:return x=h.sent(),m=[x],[3,4];case 2:return[4,ge(g,c,f,p,this.outputStride,this.maxPoses,n.scoreThreshold,n.nmsRadius)];case 3:m=h.sent(),h.label=4;case 4:return y=O(t),v=function(t,e,n,r){var i=e.height,o=e.width,a=i/(n.height*(1-r.top-r.bottom)),s=o/(n.width*(1-r.left-r.right)),u=-r.top*n.height,l=-r.left*n.width;if(1===s&&1===a&&0===u&&0===l)return t;for(var h=0,c=t;h<c.length;h++)for(var d=0,f=c[h].keypoints;d<f.length;d++){var p=f[d];p.x=(p.x+l)*s,p.y=(p.y+u)*a}return t}(m,y,this.inputResolution,a),n.flipHorizontal&&(v=function(t,e){for(var n=0,r=t;n<r.length;n++)for(var i=0,o=r[n].keypoints;i<o.length;i++){var a=o[i];a.x=e.width-1-a.x}return t}(v,y)),o.dispose(),s.dispose(),(0,i.B90)(l),c.dispose(),d.dispose(),f.dispose(),p.dispose(),g.dispose(),[2,v]}}))}))},t.prototype.dispose=function(){this.posenetModel.dispose()},t.prototype.reset=function(){},t}();function Ee(t){return void 0===t&&(t=Vt),l(this,void 0,void 0,(function(){var e,n,r,i,a;return h(this,(function(s){switch(s.label){case 0:return"ResNet50"!==(e=function(t){var e=t||Vt;if(null==e.architecture&&(e.architecture="MobileNetV1"),jt.indexOf(e.architecture)<0)throw new Error("Invalid architecture "+e.architecture+". Should be one of "+jt);if(null==e.inputResolution&&(e.inputResolution={height:257,width:257}),null==e.outputStride&&(e.outputStride=16),zt[e.architecture].indexOf(e.outputStride)<0)throw new Error("Invalid outputStride "+e.outputStride+". Should be one of "+zt[e.architecture]+" for architecture "+e.architecture+".");if(null==e.multiplier&&(e.multiplier=1),Xt[e.architecture].indexOf(e.multiplier)<0)throw new Error("Invalid multiplier "+e.multiplier+". Should be one of "+Xt[e.architecture]+" for architecture "+e.architecture+".");if(null==e.quantBytes&&(e.quantBytes=4),Kt.indexOf(e.quantBytes)<0)throw new Error("Invalid quantBytes "+e.quantBytes+". Should be one of "+Kt+" for architecture "+e.architecture+".");if("MobileNetV1"===e.architecture&&32===e.outputStride&&1!==e.multiplier)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return e}(t)).architecture?[3,2]:(u=e.outputStride,l=e.quantBytes,h="model-stride"+u+".json",n=4===l?be+"float/"+h:be+"quant"+l+"/"+h,[4,(0,o.YL)(e.modelUrl||n)]);case 1:return r=s.sent(),[2,new Te(r,e)];case 2:return i=function(t,e,n){var r={1:"100",.75:"075",.5:"050"},i="model-stride"+t+".json";return 4===n?we+"float/"+r[e]+"/"+i:we+"quant"+n+"/"+r[e]+"/"+i}(e.outputStride,e.multiplier,e.quantBytes),[4,(0,o.YL)(e.modelUrl||i)];case 3:return a=s.sent(),[2,new Te(a,e)]}var u,l,h}))}))}function Se(t,e){return l(this,void 0,void 0,(function(){var n,r;return h(this,(function(i){switch(t){case It.PoseNet:return[2,Ee(e)];case It.BlazePose:if(r=void 0,null!=(n=e)){if("tfjs"===n.runtime)return[2,St(e)];if("mediapipe"===n.runtime)return[2,I(e)];r=n.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+r);case It.MoveNet:return[2,Gt(e)];default:throw new Error(t+" is not a supported model name.")}}))}))}},1221:(t,e,n)=>{"use strict";n.r(e),n.d(e,{addImpl:()=>p,bincountImpl:()=>m,bincountReduceImpl:()=>x,castImpl:()=>h,ceilImpl:()=>b,concatImpl:()=>C,equalImpl:()=>T,expImpl:()=>E,expm1Impl:()=>S,floorImpl:()=>R,gatherNdImpl:()=>I,gatherV2Impl:()=>O,greaterEqualImpl:()=>A,greaterImpl:()=>_,lessEqualImpl:()=>D,lessImpl:()=>$,linSpaceImpl:()=>k,logImpl:()=>F,maxImpl:()=>P,maximumImpl:()=>L,minimumImpl:()=>B,multiplyImpl:()=>M,negImpl:()=>U,notEqualImpl:()=>W,prodImpl:()=>V,raggedGatherImpl:()=>z,raggedRangeImpl:()=>H,raggedTensorToTensorImpl:()=>Q,rangeImpl:()=>Z,rsqrtImpl:()=>J,scatterImpl:()=>tt,sigmoidImpl:()=>et,simpleAbsImpl:()=>o,sliceImpl:()=>nt,sparseFillEmptyRowsImpl:()=>rt,sparseReshapeImpl:()=>it,sparseSegmentReductionImpl:()=>ot,sqrtImpl:()=>at,squaredDifferenceImpl:()=>st,stridedSliceImpl:()=>ut,stringNGramsImpl:()=>ht,stringSplitImpl:()=>dt,stringToHashBucketFastImpl:()=>ft,subImpl:()=>pt,tileImpl:()=>mt,topKImpl:()=>vt,transposeImpl:()=>G,uniqueImpl:()=>wt});var r=n(88478);function i(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>{null!=t&&r.D5U.assert("complex64"!==t.dtype,(()=>`${e} does not support complex64 tensors in the CPU backend.`))}))}function o(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}function a(t){return(e,n,i,o,a)=>{const s=r.Wap.assertAndGetBroadcastShape(e,n),u=s.length,l=r.D5U.computeStrides(s),h=r.D5U.sizeFromShape(s),c=r.D5U.getTypedArrayFromDType(a,h),d=e.length,f=n.length,p=r.D5U.computeStrides(e),g=r.D5U.computeStrides(n),m=r.Wap.getBroadcastDims(e,s),x=r.Wap.getBroadcastDims(n,s);if(m.length+x.length===0)for(let e=0;e<c.length;++e)c[e]=t(i[e%i.length],o[e%o.length]);else for(let e=0;e<c.length;++e){const n=r.D5U.indexToLoc(e,u,l),a=n.slice(-d);m.forEach((t=>a[t]=0));const s=r.D5U.locToIndex(a,d,p),h=n.slice(-f);x.forEach((t=>h[t]=0));const y=r.D5U.locToIndex(h,f,g);c[e]=t(i[s],o[y])}return[c,s]}}function s(t){const{inputs:e,backend:n}=t,{real:r,imag:i}=e,o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",o),imag:n.makeTensorInfo(i.shape,"float32",a)},s}function u(t,e,n="float32"){if("complex64"===n)return s({inputs:{real:u(t,e,"float32"),imag:u(t,e,"float32")},backend:t});const i=r.D5U.makeZerosTypedArray(r.D5U.sizeFromShape(e),n);return t.makeTensorInfo(e,n,i)}function l(t){const{inputs:e,backend:n}=t,{x:r}=e;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function h(t,e,n,i){if("int32"===i)return[e,"int32",Int32Array.from(t)];if("bool"===i){const i=r.D5U.toTypedArray([0],n),[o,s]=a(((t,e)=>t!==e?1:0))(e,[],t,i,"bool");return[s,"bool",o]}throw new Error(`Error in Cast: failed to cast ${n} to ${i}`)}function c(t){const{inputs:e,backend:n,attrs:i}=t,{x:o}=e,{dtype:a}=i;if("complex64"===a){if("complex64"===o.dtype)return l({inputs:{x:o},backend:n});const t=u(n,o.shape,o.dtype),e=c({inputs:{x:o},backend:n,attrs:{dtype:"float32"}}),r=s({inputs:{real:e,imag:t},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),r}if("complex64"===o.dtype){const t=function(t){const{inputs:e,backend:n}=t,{input:r}=e,i=n.data.get(r.dataId).complexTensorInfos.real,o=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,o)}({inputs:{input:o},backend:n}),e=c({inputs:{x:t},backend:n,attrs:{dtype:a}});return n.disposeIntermediateTensorInfo(t),e}if(!r.D5U.hasEncodingLoss(o.dtype,a)){const t=l({inputs:{x:o},backend:n});return{dataId:t.dataId,shape:t.shape,dtype:a}}const d=n.data.get(o.dataId).values,[f,p,g]=h(d,o.shape,o.dtype,a);return n.makeTensorInfo(f,p,g)}function d(t,e,n,o){return null==n?({inputs:n,backend:a})=>{const{a:s,b:u}=n,l=a;i([s,u],t);const h=l.data.get(s.dataId).values,c=l.data.get(u.dataId).values,d="string"===s.dtype?r.Wap.fromUint8ToStringArray(h):h,f="string"===s.dtype?r.Wap.fromUint8ToStringArray(c):c,p=o||s.dtype,[g,m]=e(s.shape,u.shape,d,f,p);return l.makeTensorInfo(m,p,g)}:({inputs:t,backend:r})=>{const{a:i,b:a}=t,u=r;if("complex64"===i.dtype||"complex64"===a.dtype){const t=c({inputs:{x:i},backend:u,attrs:{dtype:"complex64"}}),e=u.data.get(t.dataId),r=e.complexTensorInfos.real,o=e.complexTensorInfos.imag,l=u.data.get(r.dataId).values,h=u.data.get(o.dataId).values,d=c({inputs:{x:a},backend:u,attrs:{dtype:"complex64"}}),f=u.data.get(d.dataId),p=f.complexTensorInfos.real,g=f.complexTensorInfos.imag,m=u.data.get(p.dataId).values,x=u.data.get(g.dataId).values,[y,v,w]=n(i.shape,a.shape,l,h,m,x),b=u.makeTensorInfo(w,"float32",y),C=u.makeTensorInfo(w,"float32",v),T=s({inputs:{real:b,imag:C},backend:u});return u.disposeIntermediateTensorInfo(t),u.disposeIntermediateTensorInfo(d),u.disposeIntermediateTensorInfo(b),u.disposeIntermediateTensorInfo(C),T}{const t=u.data.get(i.dataId).values,n=u.data.get(a.dataId).values,r=o||i.dtype,[s,l]=e(i.shape,a.shape,t,n,r);return u.makeTensorInfo(l,r,s)}}}function f(t){return(e,n,i,o,a,s)=>{const u=r.Wap.assertAndGetBroadcastShape(e,n),l=r.D5U.sizeFromShape(u),h=u.length,c=r.D5U.computeStrides(u),d=r.D5U.getTypedArrayFromDType("float32",l),f=r.D5U.getTypedArrayFromDType("float32",l),p=r.Wap.getBroadcastDims(e,u),g=r.Wap.getBroadcastDims(n,u),m=r.Wap.mergeRealAndImagArrays(i,o),x=r.Wap.mergeRealAndImagArrays(a,s),y=e.length,v=r.D5U.computeStrides(e),w=n.length,b=r.D5U.computeStrides(n);if(p.length+g.length===0)for(let e=0;e<d.length;e++){const n=e%m.length,r=e%x.length,i=t(m[2*n],m[2*n+1],x[2*r],x[2*r+1]);d[e]=i.real,f[e]=i.imag}else for(let e=0;e<d.length;e++){const n=r.D5U.indexToLoc(e,h,c),i=n.slice(-y);p.forEach((t=>i[t]=0));const o=r.D5U.locToIndex(i,y,v),a=n.slice(-w);g.forEach((t=>a[t]=0));const s=r.D5U.locToIndex(a,w,b),u=t(m[2*o],m[2*o+1],x[2*s],x[2*s+1]);d[e]=u.real,f[e]=u.imag}return[d,f,u]}}r.SYM,r.Zz9,r.iJz,r.xJR,r.RFZ;const p=a(((t,e)=>t+e)),g=f(((t,e,n,r)=>({real:t+n,imag:e+r})));function m(t,e,n,i,o){const a=r.D5U.sizeFromShape(i),s=r.D5U.makeZerosTypedArray(o,n);for(let n=0;n<t.length;n++){const r=t[n];if(r<0)throw new Error("Input x must be non-negative!");r>=o||(s[r]+=a>0?e[n]:1)}return s}function x(t,e,n,i=!1){const o=t.shape[0],a=t.shape[1],s=(0,r.f3b)([o,n],e.dtype);for(let r=0;r<o;r++)for(let o=0;o<a;o++){const a=t.get(r,o);if(a<0)throw new Error("Input x must be non-negative!");a>=n||(i?s.set(1,r,a):e.size>0?s.set(s.get(r,a)+e.get(r,o),r,a):s.set(s.get(r,a)+1,r,a))}return s}function y(t){return(e,n,i)=>{const o=r.D5U.getTypedArrayFromDType(n,e.length);for(let n=0;n<e.length;++n)o[n]=t(e[n],i);return o}}function v(t,e,n){return({inputs:o,attrs:a,backend:s})=>{const{x:u}=o;if(i(u,t),"string"===u.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const l=s,h=l.data.get(u.dataId).values,c=r.D5U.sizeFromShape(u.shape),d=n||u.dtype,f=r.D5U.getArrayFromDType(d,c);for(let t=0;t<c;++t)f[t]=e(h[t],a);return l.makeTensorInfo(u.shape,d,f)}}function w(t,e,n){return({inputs:r,attrs:o,backend:a})=>{const{x:s}=r;if(i(s,t),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const u=a,l=u.data.get(s.dataId).values,h=n||s.dtype,c=e(l,h,o);return u.makeTensorInfo(s.shape,h,c)}}d(r.mm_,p,g),r.mm_;const b=y((t=>Math.ceil(t)));function C(t,e,n,i){const o=r.D5U.getArrayFromDType(n,r.D5U.sizeFromShape(e));if(i&&"string"!==n){let e=0;t.forEach((t=>{const n=r.D5U.sizeFromShape(t.shape);o.set(t.vals,e),e+=n}))}else{let i=0;t.forEach((t=>{const a="string"===n?r.Wap.fromUint8ToStringArray(t.vals):t.vals;let s=0;for(let n=0;n<t.shape[0];++n){const r=n*e[1]+i;for(let e=0;e<t.shape[1];++e)o[r+e]=a[s++]}i+=t.shape[1]}))}return o}w(r.gJX,b),r.gJX;const T=a(((t,e)=>t===e?1:0)),E=(d(r.hdR,T,null,"bool"),r.hdR,y((t=>Math.exp(t)))),S=(w(r.NEP,E,"float32"),r.NEP,y((t=>Math.expm1(t)))),R=(w(r.Y0y,S),r.Y0y,y((t=>Math.floor(t))));function I(t,e,n,i,o,a,s,u,l){const h=(0,r.f3b)([i,a],n);for(let n=0;n<i;n++){const r=[];let i=0;for(let e=0;e<o;e++){const a=t[n*o+e];i+=a*s[e],r.push(a)}if(i<0||i>=l/a)throw new Error(`Invalid indices: ${r} does not index into ${u}`);for(let t=0;t<a;t++)h.values[n*a+t]=e.get(...e.indexToLoc(i*a+t))}return h}function O(t,e,n){const i=(0,r.f3b)(n,t.dtype);for(let n=0;n<i.size;++n){const r=i.indexToLoc(n).slice(),o=r[0],a=r[2],s=e.locToIndex([o,a]);r[2]=e.values[s];const u=t.locToIndex(r);0<=u&&u<t.values.length&&(i.values[n]=t.values[u])}return i}w(r.OR,R),r.OR;const _=a(((t,e)=>t>e?1:0)),A=(d(r.iZT,_,null,"bool"),r.iZT,a(((t,e)=>t>=e?1:0))),$=(d(r.Acj,A,null,"bool"),r.Acj,a(((t,e)=>t<e?1:0))),D=(d(r.vtC,$,null,"bool"),r.vtC,a(((t,e)=>t<=e?1:0)));function k(t,e,n){const i=(e-t)/(n-1),o=r.D5U.makeZerosTypedArray(n,"float32");o[0]=t;for(let t=1;t<o.length;t++)o[t]=o[t-1]+i;return o}d(r.CAk,D,null,"bool"),r.CAk;const F=y((t=>Math.log(t)));function P(t,e,n,i){const o=r.D5U.getTypedArrayFromDType(i,r.D5U.sizeFromShape(n));for(let n=0;n<o.length;++n){const r=n*e;let i=t[r];for(let n=0;n<e;++n){const e=t[r+n];(Number.isNaN(e)||e>i)&&(i=e)}o[n]=i}return o}w(r.ZbH,F),r.ZbH;const L=a(((t,e)=>Math.max(t,e))),B=(d(r.BMI,L),r.BMI,a(((t,e)=>Math.min(t,e)))),M=(d(r.q8u,B),r.q8u,a(((t,e)=>t*e))),N=f(((t,e,n,r)=>({real:t*n-e*r,imag:t*r+e*n})));function U(t,e,n){const i=r.D5U.createScalarValue(-1,n);return M([],e,i,t,n)}d(r.wYn,M,N),r.wYn,r.kuV;const W=a(((t,e)=>t!==e?1:0));function G(t,e,n,i,o){const a=e.length,s=r.D5U.sizeFromShape(e),u=r.D5U.computeStrides(e),l=r.D5U.computeStrides(o),h=r.D5U.getTypedArrayFromDType(n,r.D5U.sizeFromShape(o));for(let e=0;e<s;++e){const n=r.D5U.indexToLoc(e,a,u),o=new Array(n.length);for(let t=0;t<o.length;t++)o[t]=n[i[t]];h[r.D5U.locToIndex(o,a,l)]=t[e]}return h}function V(t,e,n,i){const[o,a]=r.Wap.computeOutAndReduceShapes(t,i),s=(0,r.x8V)(e,"int32"),u=r.D5U.makeZerosTypedArray(r.D5U.sizeFromShape(o),s),l=r.D5U.sizeFromShape(a);for(let t=0;t<u.length;++t){const e=t*l;let r=1;for(let t=0;t<l;++t)r*=n[e+t];u[t]=r}return{outVals:u,outShape:o,outDtype:s}}function j(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let r=e;r<t.length;r++)n[e-1]*=t[r];return n}function z(t,e,n,i,o,a,s,u){if(0===t.length)throw new Error("paramsNestedSplits must be non empty");if(0===e[0].length)throw new Error("Split tensors must not be scalars");if(function(t,e,n){t.forEach(((t,i)=>{if(t<0||t>=n){const o=r.D5U.indexToLoc(i,e.length,r.D5U.computeStrides(e)).join(",");throw new Error(`indices[${o}] = ${t} is not in [0, ${n})`)}}))}(a,s,e[0][0]-1),0===i.length)throw new Error("params.rank must be nonzero");const l=i[0],{outSplits:h,valueSlices:c,numValues:d}=function(t,e,n,r){const i=[];let o=0;const a=e.length-1+n.length,s=new Array(a).fill(null).map((()=>[0]));!function(t,e){for(let n=0;n<t.length;++n){const r=t[n],i=n===t.length-1?e:t[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>i)throw new Error("Ragged splits must not point past values");for(let t=1;t<r.length;++t)if(r[t-1]>r[t])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);let u=1;for(let t=0;t<e.length-1;++t){u*=e[t];const n=e[t+1];for(let e=1;e<u+1;++e)s[t].push(e*n)}for(let r=0;r<t.length;++r){let a=t[r],u=t[r]+1;for(let t=0;t<n.length;++t){const r=n[t],i=t+e.length-1;if(i>=0){const t=s[i],e=t[t.length-1]-r[a];for(let t=a;t<u;++t)s[i].push(r[t+1]+e)}a=r[a],u=r[u]}u!==a&&(i.push([a,u]),o+=u-a)}return{outSplits:s,valueSlices:i,numValues:o}}(a,s,t,l),f=function(t){const e=[];for(let n=0;n<t.length;++n){const i=t[n].length,o=r.D5U.getArrayFromDType("int32",i);e.push(o),t[n].forEach(((t,e)=>o[e]=t))}return e}(h),p=function(t,e,n,i,o){const a=e.slice();a[0]=o;const s=r.D5U.getArrayFromDType(n,r.D5U.sizeFromShape(a)),u=t.length;return function(t,e,n,r,i,o){const a=j(e,2)[1],s=j(o,2)[1];let u=0;for(const e of n)for(let n=e[0];n<e[1];++n){for(let e=0;e<r;++e)i[u*s+e]=t[n*a+e];++u}}(t,e,i,0===u?0:u/e[0],s,a),[s,a]}(n,i,o,c,d);return[f,p[0],p[1]]}d(r.yQU,W,null,"bool"),r.yQU,r.G3Y,r.DlI;function H(t,e,n,i,o,a,s){if(e.length>1)throw new Error("starts must be a scalar or vector");if(o.length>1)throw new Error("limits must be a scalar or vector");if(s.length>1)throw new Error("deltas must be a scalar or vector");const u=0===e.length,l=0===o.length,h=0===s.length,c=[];u||c.push(e[0]),l||c.push(o[0]),h||c.push(s[0]);for(let t=1;t<c.length;++t)if(c[t]!==c[t-1])throw new Error("starts, limits, and deltas must have the same shape");const d=0===c.length?1:c[0],f=r.D5U.getArrayFromDType("int32",d+1);f[0]=0;for(let e=0;e<d;++e){const n=u?t[0]:t[e],r=l?i[0]:i[e],o=h?a[0]:a[e];if(0===o)throw new Error("Requires delta != 0");let s;if(o>0&&r<n||o<0&&r>n)s=0;else if(s=Math.ceil(Math.abs((r-n)/o)),s>2147483647)throw new Error("Requires ((limit - start) / delta) <= 2147483647");f[e+1]=f[e]+s}const p=f[d],g=r.D5U.getArrayFromDType(n,p);let m=0;for(let e=0;e<d;++e){const n=f[e+1]-f[e];let r=u?t[0]:t[e];const i=h?a[0]:a[e];for(let t=0;t<n;++t)g[m++]=r,r+=i}return[f,g]}var X=r.Wap.RowPartitionType;class K{constructor(t,e,n,i,o,a,s,u,l,h){this.shape=t,this.shapeShape=e,this.values=n,this.valuesShape=i,this.valuesDType=o,this.defaultValue=a,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=r.Wap.getRowPartitionTypesHelper(h),this.raggedRank=r.Wap.getRaggedRank(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===X.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===X.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){const e=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case X.VALUE_ROWIDS:return K.getMaxWidthValueRowID(e);case X.ROW_SPLITS:return K.getMaxWidthRowSplit(e);default:throw new Error(`Cannot handle partition type ${X[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){const e=t.length;if(0===e||1===e)return 0;let n=0;for(let r=0;r<e-1;++r){const e=t[r+1]-t[r];e>n&&(n=e)}return n}static getMaxWidthValueRowID(t){const e=t.length;if(0===e)return 0;let n=0,r=t[0],i=0;for(let o=1;o<e;++o){const e=t[o];e!==r&&(r=e,i=Math.max(o-n,i),n=o)}return Math.max(e-n,i)}tensorShapeFromTensor(t,e,n=!0){if(0===e.length){if(-1===t[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return q(t,n)}calculateOutputSize(t){const e=this.valuesShape,n=this.defaultValueShape;r.Wap.validateDefaultValueShape(n,e);const i=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=r.Wap.combineRaggedTensorToTensorShapes(this.raggedRank,i,e);o[0]<0&&(o[0]=t);for(let t=1;t<=this.raggedRank;++t)o[t]<0&&(o[t]=this.getMaxWidth(t));return o}calculateFirstParentOutputIndex(t,e,n){const i=Math.min(t,n),o=[];let a=0;for(let t=0;t<i;++t,a+=e)o.push(a);for(let e=i;e<t;++e)o.push(-1);return r.D5U.assert(o.length===t,(()=>"Final length of result must be equal to firstDimension.")),o}calculateOutputIndexRowSplit(t,e,n,r){const i=t.length,o=[];for(let a=0;a<i-1;++a){const i=t[a+1]-t[a];let s=Math.min(r,i),u=e[a];-1===u&&(s=0);for(let t=0;t<s;++t)o.push(u),u+=n;for(let t=0;t<i-s;++t)o.push(-1)}if(i>0&&o.length!==t[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(t,e,n,r){const i=t.length,o=[];if(0===i)return[];let a=0,s=t[0];if(s>=e.length)throw new Error(`Got currentValueRowId=${s}, which is not less than ${e.length}`);let u=e[s];o.push(u);for(let l=1;l<i;++l){const i=t[l];if(i===s)u>=0&&(++a,a<r?u+=n:u=-1);else{if(a=0,s=i,i>=e.length)throw new Error(`Got nextValueRowId=${i} which is not less than ${e.length}`);u=e[i]}o.push(u)}if(o.length!==t.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(t,e,n,r){const i=this.getRowPartitionTensor(t),o=this.getRowPartitionTypeByDimension(t);switch(o){case X.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,e,n,r);case X.ROW_SPLITS:if(i.length-1>e.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${e.length}`);return this.calculateOutputIndexRowSplit(i,e,n,r);default:throw new Error(`Unsupported partition type: ${X[o]}`)}}getFirstDimensionSize(){const t=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");const e=this.rowPartitionTypes[0];switch(e){case X.FIRST_DIM_SIZE:return t[0];case X.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case X.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${X[e]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),e=this.calculateOutputSize(t),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(let t=n.length-2;t>=0;--t)n[t]=n[t+1]*e[t+1];const i=q(e,!1),o=r.D5U.getArrayFromDType(this.valuesDType,r.D5U.sizeFromShape(i));if(n[0]*e[0]>0){let r=this.calculateFirstParentOutputIndex(t,n[0],e[0]);for(let t=1;t<=this.raggedRank;++t)r=this.calculateOutputIndex(t-1,r,n[t],e[t]);this.setOutput(this.raggedRank,r,o,i)}return[i,o]}setOutput(t,e,n,i){if(0===n.length)return;const o=this.values,a=n;let s=i.slice();s=s.slice(t+1);const u=r.D5U.sizeFromShape(s),l=e.length;let h=this.defaultValue;if(h.length!==u&&1!==h.length){const t=this.defaultValueShape;(0,r.lub)((()=>{const e=(0,r.XLQ)(h,t),n=(0,r.UFq)(e,s);h=n.dataSync()}))}let c=0,d=0,f=0;for(let t=0;t<=l;++t){let r=t<l?e[t]:-1;if(r!==f){if(d<f){const t=o.subarray(c*u);Y(a.subarray(d*u),t,(f-d)*u)}if(t>=l){const t=n.length;r=Math.floor(t/u)}if(r>f)if(1===this.defaultValue.length)a.subarray(f*u,r*u).fill(this.defaultValue[0]),f=r;else for(;r>f;)Y(a.slice(f*u),h,u),++f;r<0?(c=t+1,d=f):(c=t,d=f,f=d+1)}else++f}}}function Y(t,e,n){for(let r=0;r<n;r++)t[r]=e[r]}function q(t,e){const n=[];for(let r of t){if(r<0){if(!e)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function Q(t,e,n,r,i,o,a,s,u,l){return new K(t,e,n,r,i,o,a,s,u,l).compute()}function Z(t,e,n,i){if(t===e||t<e&&n<0||e<t&&n>1)return r.D5U.makeZerosTypedArray(0,i);const o=Math.abs(Math.ceil((e-t)/n)),a=r.D5U.makeZerosTypedArray(o,i);e<t&&1===n&&(n=-1),a[0]=t;for(let t=1;t<a.length;t++)a[t]=a[t-1]+n;return a}const J=y((t=>1/Math.sqrt(t)));function tt(t,e,n,i,o,a,s,u,l,h){const c=[i/o,o],d=t.values,f=e.values;if(0===i)return(0,r.f3b)(n,e.dtype);const p=(0,r.f3b)(c,e.dtype);"string"==typeof l||"number"==typeof l?p.values.fill(l):"boolean"==typeof l&&p.values.fill(+l);for(let t=0;t<a;t++){const r=[];let a=0;for(let e=0;e<s;e++){const n=d[t*s+e];r.push(n),a+=n*u[e]}if(a<0||a>=i/o)throw new Error(`Invalid indices: ${r} does not index into ${n}`);for(let n=0;n<o;n++)h?p.values[a*o+n]+=f[t*o+n]:p.values[a*o+n]=0===e.rank?f[0]:f[t*o+n]}return p}w(r.bV0,J),r.bV0;const et=y((t=>1/(1+Math.exp(-t))));function nt(t,e,n,i,o){const a=r.kuN.isSliceContinous(i,e,n),s=r.D5U.sizeFromShape(n),u=r.D5U.computeStrides(i);if(a){const n=r.kuN.computeFlatOffset(e,u);return"string"===o?t.slice(n,n+s):t.subarray(n,n+s)}const l="string"===o?r.Wap.fromUint8ToStringArray(t):t,h=(0,r.f3b)(i,o,l),c=(0,r.f3b)(n,o);for(let t=0;t<c.size;++t){const n=c.indexToLoc(t),r=n.map(((t,n)=>t+e[n]));c.set(h.get(...r),...n)}return"string"===o?r.Wap.fromStringArrayToUint8(c.values):c.values}function rt(t,e,n,i,o,a,s){const u=e[0],l=a[0],h=new Array(l),c=new Array(u),d=e[1];if(0===l){if(0!==u)throw new Error(r.Wap.getSparseFillEmptyRowsIndicesDenseShapeMismatch(u));return[r.D5U.getArrayFromDType(n,0),[0,d],r.D5U.getArrayFromDType(o,0),h,c]}let f=!0,p=0;const g=new Array(l).fill(0);for(let e=0;e<u;++e){const n=t[e*d];if(n<0)throw new Error(r.Wap.getSparseFillEmptyRowsNegativeIndexErrorMessage(e,n));if(n>=l)throw new Error(r.Wap.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(e,n,l));++g[n],f=f&&n>=p,p=n}let m=!0;for(let t=0;t<l;++t){const e=0===g[t];h[t]=e,m=m&&!e,g[t]=Math.max(g[t],1),t>0&&(g[t]+=g[t-1])}if(m&&f){const e=t,n=i;for(let t=0;t<u;++t)c[t]=t;return[e,[u,d],n,h,c]}{const e=g[l-1],a=r.D5U.getArrayFromDType(n,e*d),f=r.D5U.getArrayFromDType(o,e),p=new Array(l).fill(0);for(let e=0;e<u;++e){const n=t[e*d],r=p[n],o=(0===n?0:g[n-1])+r;p[n]++;for(let n=0;n<d;++n)a[o*d+n]=t[e*d+n];f[o]=i[e],c[e]=o}for(let t=0;t<l;++t)if(0===p[t]){const e=0===t?0:g[t-1];a[e*d+0]=t;for(let t=1;t<d;++t)a[e*d+t]=0;f[e]=s}return[a,[e,d],f,h,c]}}function it(t,e,n,i,o){const a=r.D5U.sizeFromShape(i),s=e[0],u=o.length,l=[];let h=1,c=-1;for(let t=0;t<u;++t){const e=o[t];if(-1===e){if(-1!==c)throw new Error(r.Wap.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(c,t));c=t,l.push(1)}else{if(e<0)throw new Error(r.Wap.getSparseReshapeNegativeOutputDimErrorMessage(t,e));h*=e,l.push(e)}}if(-1!==c){if(h<=0)throw new Error(r.Wap.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());const t=Math.trunc(a/h);if(h*t!==a)throw new Error(r.Wap.getSparseReshapeInputOutputMultipleErrorMessage(i,l));l[c]=t}if(r.D5U.sizeFromShape(l)!==a)throw new Error(r.Wap.getSparseReshapeInputOutputMismatchErrorMessage(i,l));const d=i.length,f=[];if(d>0){f[d-1]=1;for(let t=d-2;t>=0;--t)f[t]=f[t+1]*i[t+1]}const p=[];if(u>0){p[u-1]=1;for(let t=u-2;t>=0;--t)p[t]=p[t+1]*l[t+1]}const g=r.D5U.getArrayFromDType(n,s*u);for(let e=0;e<s;++e){let n=0;for(let r=0;r<d;++r)n+=t[e*d+r]*f[r];for(let t=0;t<u;++t)g[e*u+t]=Math.trunc(n/p[t]),n%=p[t]}return[g,[s,u],l]}function ot(t,e,n,i,o,a=!1,s=0){const u=i.length,l=[e[0],t.length/e[0]],h=l[1],c=u>0?o[u-1]+1:0;if(c<0)throw new Error(r.Wap.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());const d=e.slice();d[0]=c;const f=d.reduce(((t,e)=>t*e),1),p=r.D5U.getArrayFromDType(n,f);if(0===u)return c>0&&p.fill(s),[p,d];if(c<=0)throw new Error(r.Wap.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let g=0,m=1,x=0,y=o[g];for(;;){let e=0;if(m<u){if(e=o[m],y===e){++m;continue}if(y>=e)throw new Error(r.Wap.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=c)throw new Error(r.Wap.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,c));y>x&&p.fill(s,x*h,y*h);for(let e=g;e<m;++e){const n=i[e];if(n<0||n>=l[0])throw new Error(r.Wap.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(e,i[e],l[0]));for(let e=0;e<h;e++)p[y*h+e]+=t[n*h+e]}if(a)for(let t=0;t<h;t++)p[y*h+t]/=m-g;if(g=m,++m,x=y+1,y=e,m>u)break}return x<c&&p.fill(s,x*h,c*h),[p,d]}v(r.a5O,(t=>1/(1+Math.exp(-t)))),r.a5O,r.p2w;const at=y((t=>Math.sqrt(t))),st=(v(r.FKq,(t=>Math.sqrt(t))),r.FKq,a(((t,e)=>{const n=t-e;return n*n})));function ut(t,e,n,i){const o=(0,r.f3b)(t,e.dtype);for(let t=0;t<o.size;t++){const r=o.indexToLoc(t),a=new Array(r.length);for(let t=0;t<a.length;t++)a[t]=r[t]*n[t]+i[t];o.set(e.get(...a),...r)}return o}d(r._tC,st),r._tC;class lt{constructor(t,e,n,i,o,a){this.separator=r.D5U.encodeString(t),this.nGramWidths=e,this.leftPad=r.D5U.encodeString(n),this.rightPad=r.D5U.encodeString(i),this.padWidth=o,this.preserveShort=a}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,e){const n=this.getPadWidth(e);return Math.max(0,t+2*n-e+1)}createNGrams(t,e,n,r,i,o){for(let a=0;a<i;++a){const s=this.getPadWidth(o),u=Math.max(0,s-a),l=Math.max(0,s-(i-(a+1))),h=o-(u+l),c=e+(u>0?0:a-s);let d=0;d+=u*this.leftPad.length;for(let e=0;e<h;++e)d+=t[c+e].length;d+=l*this.rightPad.length,d+=(u+l+h-1)*this.separator.length,n[r+a]=new Uint8Array(d);const f=n[r+a];let p=0;const g=t=>t.forEach((t=>f[p++]=t));for(let t=0;t<u;++t)g(this.leftPad),g(this.separator);for(let e=0;e<h-1;++e)g(t[c+e]),g(this.separator);if(h>0){g(t[c+h-1]);for(let t=0;t<l;++t)g(this.separator),g(this.rightPad)}else{for(let t=0;t<l-1;++t)g(this.rightPad),g(this.separator);g(this.rightPad)}}}compute(t,e){const n=t.length,i=e.length;if(i>0){let t=e[0];if(0!==t)throw new Error(`First split value must be 0, got ${t}`);for(let r=1;r<i;++r){let i=e[r]>=t;if(i=i&&e[r]<=n,!i)throw new Error(`Invalid split value ${e[r]}, must be in [${t}, ${n}]`);t=e[r]}if(t!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${t}`)}const o=i-1,a=r.D5U.getArrayFromDType("int32",i);if(0===n||0===i){const t=new Array(n);for(let t=0;t<=o;++t)a[t]=0;return[t,a]}a[0]=0;for(let t=1;t<=o;++t){const n=e[t]-e[t-1];let r=0;this.nGramWidths.forEach((t=>{r+=this.getNumNGrams(n,t)})),this.preserveShort&&n>0&&0===r&&(r=1),a[t]=a[t-1]+r}const s=new Array(a[o]);for(let n=0;n<o;++n){const r=e[n];let i=a[n];if(this.nGramWidths.forEach((o=>{const a=e[n+1]-e[n],u=this.getNumNGrams(a,o);this.createNGrams(t,r,s,i,u,o),i+=u})),this.preserveShort&&i===a[n]){const o=e[n+1]-e[n];if(0===o)continue;const a=o+2*this.padWidth,u=1;this.createNGrams(t,r,s,i,u,a)}}return[s,a]}}function ht(t,e,n,r,i,o,a,s){return new lt(n,r,i,o,a,s).compute(t,e)}function ct(t,e,n,r){if(!t.length)return;if(0===e.length){for(let e=0;e<t.length;++e)r.push(t.subarray(e,e+1));return}if(1===e.length){const i=e[0];let o=t.indexOf(i);for(;-1!==o;){const e=t.subarray(0,o);n&&0===e.length||r.push(e),o=(t=t.subarray(o+1)).indexOf(i)}return void(n&&0===t.length||r.push(t))}let i=0;for(let o=0;o<t.length+1;o++)if(o===t.length||-1!==e.indexOf(t[o])){const e=t.subarray(i,o);n&&0===e.length||r.push(e),i=o+1}}function dt(t,e,n){const i=t.length,o=[];let a=0,s=0;const u=new Array(i);for(let r=0;r<i;++r){const i=o.length;ct(t[r],e,n,o);const l=o.length-i;u[r]=l,a+=l,s=Math.max(s,l)}const l=r.D5U.getArrayFromDType("int32",2*a),h=new Array(a),c=[i,s];let d=0;for(let t=0;t<i;++t)for(let e=0;e<u[t];++e)l[2*d]=t,l[2*d+1]=e,h[d]=o[d],++d;return[l,h,c]}function ft(t,e){const n=r.D5U.getArrayFromDType("int32",t.length);for(let i=0;i<t.length;++i)n[i]=r.D5U.fingerPrint64(t[i]).modulo(e).getLowBitsUnsigned();return n}const pt=a(((t,e)=>t-e)),gt=f(((t,e,n,r)=>({real:t-n,imag:e-r})));function mt(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const i=(0,r.f3b)(n,t.dtype);for(let e=0;e<i.values.length;++e){const n=i.indexToLoc(e),r=new Array(t.rank);for(let e=0;e<r.length;e++)r[e]=n[e]%t.shape[e];const o=t.locToIndex(r);i.values[e]=t.values[o]}return i}d(r.Tr8,pt,gt),r.Tr8;const xt=(t,e)=>{const n=e.value-t.value;return 0===n?t.index-e.index:n};function yt(t,e,n=0,i=t.length-1){for(;i>n;){if(i-n>600){const r=i-n+1,o=e-n+1,a=Math.log(r),s=.5*Math.exp(2*a/3),u=.5*Math.sqrt(a*s*(r-s)/r)*Math.sign(o-r/2);yt(t,e,Math.max(n,Math.floor(e-o*s/r+u)),Math.min(i,Math.floor(e+(r-o)*s/r+u)))}const o=t[e];let a=n,s=i;for(r.D5U.swap(t,n,e),xt(t[i],o)>0&&r.D5U.swap(t,n,i);a<s;){for(r.D5U.swap(t,a,s),a++,s--;xt(t[a],o)<0;)a+=1;for(;xt(t[s],o)>0;)s-=1}0===xt(t[n],o)?r.D5U.swap(t,n,s):(s+=1,r.D5U.swap(t,s,i)),s<=e&&(n=s+1),e<=s&&(i=s-1)}}function vt(t,e,n,i,o){const a=e[e.length-1],[s,u]=[t.length/a,a],l=r.D5U.getTypedArrayFromDType(n,s*i),h=r.D5U.getTypedArrayFromDType("int32",s*i);for(let e=0;e<s;e++){const n=e*u,r=t.subarray(n,n+u);let a=new Array(r.length);r.forEach(((t,e)=>a[e]={value:t,index:e})),i<a.length&&(yt(a,i),a=a.slice(0,i)),o&&a.sort(xt);const s=e*i,c=l.subarray(s,s+i),d=h.subarray(s,s+i);for(let t=0;t<i;t++)c[t]=a[t].value,d[t]=a[t].index}const c=e.slice();return c[c.length-1]=i,[(0,r.f3b)(c,n,l),(0,r.f3b)(c,"int32",h)]}function wt(t,e,n,i){const o=r.D5U.parseAxisParam(e,n)[0],a=[1,n[0],1];for(let t=0;t<o;t++)a[0]*=n[t];a[1]=n[o];for(let t=o+1;t<n.length;t++)a[2]*=n[t];const s={},u=new Int32Array(n[o]),l=new r.YDk(a,i,t),h=[],c=1===a[0]&&1===a[2];for(let e=0;e<n[o];e++){let n;if(c)n=t[e].toString();else{const t=[];for(let n=0;n<a[0];n++)for(let r=0;r<a[2];r++)t.push(l.get(n,e,r));n=t.join(",")}if(void 0!==s[n])u[e]=s[n];else{const t=Object.keys(s).length;s[n]=t,u[e]=t,h.push(e)}}const d=a.slice();d[1]=Object.keys(s).length;const f=new r.YDk(d,i);h.forEach(((t,e)=>{for(let n=0;n<a[0];n++)for(let r=0;r<a[2];r++)f.set(l.get(n,t,r),n,e,r)}));const p=n.slice();return p[o]=d[1],{outputValues:f.values,outputShape:p,indices:u}}},56392:(t,e,n)=>{"use strict";n.d(e,{p:()=>r});class r{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`float v${t} = get${t}AtOutCoords();`)}));const r=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${r};\n        setOutput(result);\n      }\n    `}}},47340:(t,e,n)=>{"use strict";n.d(e,{a:()=>r});class r{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`vec4 v${t} = get${t}AtOutCoords();`)}));const r=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${r};\n        setOutput(result);\n      }\n    `}}},48009:(t,e,n)=>{"use strict";n.d(e,{d:()=>r});class r{constructor(t,e,n){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=t;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a="max"===e?">":"<",s=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${r};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${r}; i++) {\n          int inIdx = ${s};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${a} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}},40673:(t,e,n)=>{"use strict";n.d(e,{t:()=>a});var r=n(88478),i=n(21034),o=n(55156);class a{constructor(t,e,n,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,r.D5U.assert(t.length>2,(()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`));const s=t[t.length-1],u=Math.ceil(s/e);this.outputShape=t.slice(0,-1),u>1&&this.outputShape.push(u),a||this.variableNames.push("bestIndicesA");const l=this.outputShape,h=l.length,c=(0,o.kW)(h),d=(0,i.Ky)("coords",h);let f,p;if(1===u){p=h+1;const t=(0,o.kW)(p);f=`\n        ${t} sourceLocR = ${t}(${d.join()}, 0);\n        ++${d[h-1]};\n        ${t} sourceLocG = ${t}(${d.join()}, 0);\n        ++${d[h-2]};\n        ${t} sourceLocA = ${t}(${d.join()}, 0);\n        --${d[h-1]};\n        ${t} sourceLocB = ${t}(${d.join()}, 0);\n        --${d[h-2]};`}else p=h,f=`\n        ${c} sourceLocR = coords;\n        ++${d[h-1]};\n        ${c} sourceLocG = coords;\n        ++${d[h-2]};\n        ${c} sourceLocA = coords;\n        --${d[h-1]};\n        ${c} sourceLocB = coords;\n        --${d[h-2]};`;const g=["x","y","z","w","u","v"].slice(0,p),m="."+g[p-1],x=g.map((t=>"int "+t)),y=(0,i.Ky)("sourceLocR",p-1).concat("inIdx.r"),v=(0,i.Ky)("sourceLocG",p-1).concat("inIdx.g"),w=(0,i.Ky)("sourceLocB",p-1).concat("inIdx.b"),b=(0,i.Ky)("sourceLocA",p-1).concat("inIdx.a"),C="max"===n?"greaterThan":"lessThan",T=a?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${v.join()}),\n                             getBestIndicesAChannel(${w.join()}),\n                             getBestIndicesAChannel(${b.join()})));`,E=`vec4(\n            getAChannel(${y.join()}),\n            hasNextCol ? getAChannel(${v.join()}) : 0.,\n            hasNextRow ? getAChannel(${w.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,S=a?"":`\n      float getBestIndicesAChannel(${x.join()}) {\n        return getChannel(getBestIndicesA(${g.join()}),\n                                          vec2(${g.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${x.join()}) {\n        return getChannel(getA(${g.join()}),\n                               vec2(${g.slice(-2).join()}));\n      }\n      ${S}\n      void main() {\n        ${c} coords = getOutputCoords();\n        bool hasNextCol = ${d[h-1]} < ${l[h-1]-1};\n        bool hasNextRow = ${d[h-2]} < ${l[h-2]-1};\n        ${f}\n        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},\n          sourceLocB${m}, sourceLocA${m}) * ${e};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${E};\n\n        for (int i = 0; i < ${e}; i++) {\n          inIdx = srcIdx;\n          ${T}\n          vec4 candidate = ${E};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${C}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}},692:(t,e,n)=>{"use strict";n.d(e,{o:()=>r,z:()=>i});class r{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,a=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,l=s-1-t.padInfo.top,h=u-1-t.padInfo.left,c=1/(e*n);this.userCode=`\n      const ivec2 pads = ivec2(${l}, ${h});\n      const float avgMultiplier = float(${c});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${s};\n            wR += ${o}) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${u};\n            wC+= ${a}) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class i{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,h=t.effectiveFilterDepth,c=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=h-1-t.padInfo.front,p=c-1-t.padInfo.top,g=d-1-t.padInfo.left,m=1/(e*n*r);this.userCode=`\n      const ivec3 pads = ivec3(${f}, ${p}, ${g});\n      const float avgMultiplier = float(${m});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${h};\n            wD += ${s}) {\n          float dyD = float(dyDCorner + wD) / ${i}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${c};\n              wR += ${u}) {\n            float dyR = float(dyRCorner + wR) / ${o}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${d};\n                wC += ${l}) {\n              float dyC = float(dyCCorner + wC) / ${a}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}},29476:(t,e,n)=>{"use strict";n.d(e,{w:()=>i});var r=n(88478);class i{constructor(t,e,n,i,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],r.Wap.assertAndGetBroadcastShape(t,e),r.Wap.assertAndGetBroadcastShape(t,n);let s="0.0";null!=i&&(r.Wap.assertAndGetBroadcastShape(t,i),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let u="1.0";null!=o&&(r.Wap.assertAndGetBroadcastShape(t,o),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${s};\n        float scale = ${u};\n        float inv = scale * inversesqrt(variance + float(${a}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}},87373:(t,e,n)=>{"use strict";n.d(e,{x:()=>i});var r=n(88478);class i{constructor(t,e,n,i,o,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],r.Wap.assertAndGetBroadcastShape(t,e),r.Wap.assertAndGetBroadcastShape(t,n);let s="vec4(0.0)";null!=i&&(r.Wap.assertAndGetBroadcastShape(t,i),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let u="vec4(1.0)";null!=o&&(r.Wap.assertAndGetBroadcastShape(t,o),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        vec4 offset = ${s};\n        vec4 scale = ${u};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${a}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}},21480:(t,e,n)=>{"use strict";n.d(e,{S:()=>o,x:()=>i});var r=n(88478);const i={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class o{constructor(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=r.Wap.assertAndGetBroadcastShape(e,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${t}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}},84039:(t,e,n)=>{"use strict";n.d(e,{D1:()=>o,t6:()=>a});var r=n(88478),i=n(16697);const o="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n";class a{constructor(t,e,n){this.variableNames=["A","B"],this.outputShape=r.Wap.assertAndGetBroadcastShape(e,n),this.enableShapeUniforms=(0,i.C9)(this.outputShape.length),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${t}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}},14488:(t,e,n)=>{"use strict";n.d(e,{E2:()=>u,my:()=>s});var r=n(88478),i=n(16697),o=n(21034),a=n(55156);const s="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n";class u{constructor(t,e,n,s=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.Wap.assertAndGetBroadcastShape(e,n);const u=this.outputShape.length;this.enableShapeUniforms=(0,i.C9)(u);let l="";if(s)if(0===u||1===r.D5U.sizeFromShape(this.outputShape))l="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(l=`\n          ${(0,a.kW)(u)} coords = getOutputCoords();\n        `,1===u)this.enableShapeUniforms?l+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":l+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const t=(0,o.Ky)("coords",u);this.enableShapeUniforms?l+=`\n            bool nextRowOutOfBounds =\n              (${t[u-2]} + 1) >= outShape[${u} - 2];\n            bool nextColOutOfBounds =\n              (${t[u-1]} + 1) >= outShape[${u} - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `:l+=`\n            bool nextRowOutOfBounds =\n              (${t[u-2]} + 1) >= ${this.outputShape[u-2]};\n            bool nextColOutOfBounds =\n              (${t[u-1]} + 1) >= ${this.outputShape[u-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${t}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${l}\n\n        setOutput(result);\n      }\n    `}}},90740:(t,e,n)=>{"use strict";n.d(e,{jl:()=>s,nd:()=>a});var r=n(88478);const i={},o={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function a(t,e){i[t]=e}function s(t,e){if(!(t in i)||null!=e){const n=function(t,e){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==e?function(t){if("undefined"!=typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t):e;return n.addEventListener("webglcontextlost",(e=>{e.preventDefault(),delete i[t]}),!1),(0,r.OBj)().getBool("SOFTWARE_WEBGL_ENABLED")&&(o.failIfMajorPerformanceCaveat=!1),1===t?n.getContext("webgl",o)||n.getContext("experimental-webgl",o):n.getContext("webgl2",o)}(t,e);if(null===n)return console.log("Could not get context for WebGL version",t),null;i[t]=n}const n=i[t];return null==n||n.isContextLost()?(delete i[t],s(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),i[t])}},90150:(t,e,n)=>{"use strict";n.d(e,{v:()=>r});class r{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}},96521:(t,e,n)=>{"use strict";n.d(e,{V:()=>r});class r{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}},82314:(t,e,n)=>{"use strict";n.d(e,{V:()=>r});class r{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}},47494:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(88478);class i{constructor(t){this.outputShape=[],this.outputShape=r.Wap.computeOutShape(t,1),this.variableNames=t.map(((t,e)=>`T${e}`));const e=new Array(t.length-1);e[0]=t[0][1];for(let n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];const n=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let t=1;t<e.length;t++){const r=e[t-1];n.push(`else if (yC < ${e[t]}) setOutput(getT${t}(yR, yC-${r}));`)}const i=e.length,o=e[e.length-1];n.push(`else setOutput(getT${i}(yR, yC-${o}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}},47625:(t,e,n)=>{"use strict";n.d(e,{R:()=>a});var r=n(88478),i=n(21034),o=n(55156);class a{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=r.Wap.computeOutShape(t,e);const n=this.outputShape,a=n.length,u=(0,o.kW)(a),l=(0,i.Ky)("coords",a),h=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map(((t,e)=>`T${e}`));const c=new Array(t.length-1);c[0]=t[0][e];for(let n=1;n<c.length;n++)c[n]=c[n-1]+t[n][e];const d=h[e],f=h.slice(-2),p=h.join();let g=`if (${d} < ${c[0]}) {\n        return getChannel(\n            getT0(${p}), vec2(${f.join()}));\n        }`;for(let t=1;t<c.length;t++){const e=c[t-1];g+=`\n        if (${d} < ${c[t]}  && ${d} >= ${c[t-1]}) {\n          return getChannel(\n            getT${t}(${s(h,d,e)}),\n            vec2(${s(f,d,e)}));\n        }`}const m=c.length,x=c[c.length-1];g+=`\n        return getChannel(\n          getT${m}(${s(h,d,x)}),\n          vec2(${s(f,d,x)}));`,this.userCode=`\n      float getValue(${h.map((t=>"int "+t))}) {\n        ${g}\n      }\n\n      void main() {\n        ${u} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${l}), 0., 0., 0.);\n\n        ${l[a-1]} = ${l[a-1]} + 1;\n        if (${l[a-1]} < ${n[a-1]}) {\n          result.g = getValue(${l});\n        }\n\n        ${l[a-2]} = ${l[a-2]} + 1;\n        if (${l[a-2]} < ${n[a-2]}) {\n          result.a = getValue(${l});\n        }\n\n        ${l[a-1]} = ${l[a-1]} - 1;\n        if (${l[a-2]} < ${n[a-2]} &&\n            ${l[a-1]} < ${n[a-1]}) {\n          result.b = getValue(${l});\n        }\n        setOutput(result);\n      }\n    `}}function s(t,e,n){const r=t.indexOf(e);return t.map(((t,e)=>e===r?`${t} - ${n}`:t)).join()}},90301:(t,e,n)=>{"use strict";n.d(e,{FF:()=>o,Ng:()=>r,P2:()=>i,cc:()=>a});class r{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${r};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${i};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              if (${o}) {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class i{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,a=e-1-t.padInfo.top,s=n-1-t.padInfo.left,u=o?1:2,l=o?2:3,h=o?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${a}, ${s});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${h}];\n\n        ivec2 dyCorner = ivec2(coords[${u}], coords[${l}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n\n              if (${o}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class o{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,a=t.padInfo.left;this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yF = 0; yF < ${t.outDepth}; yF++) {\n            int xF = wF + yF * ${e} - ${i};\n\n            if (xF < 0 || xF >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${t.outHeight}; yR++) {\n              int xR = wR + yR * ${n} - ${o};\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${t.outWidth}; yC++) {\n                int xC = wC + yC * ${r} - ${a};\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class a{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,s=e-1-t.padInfo.front,u=n-1-t.padInfo.top,l=r-1-t.padInfo.left;this.userCode=`\n      const ivec3 pads = ivec3(${s}, ${u}, ${l});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${e}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${i}.0;\n\n          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${e} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${o}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${r}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${a}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${r} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}},37428:(t,e,n)=>{"use strict";n.d(e,{g:()=>i,u:()=>r});class r{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${o} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${r};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${i};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class i{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,a=n-1-t.padInfo.left,s=t.outChannels/t.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${o}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${s}; dm++) {\n              int d2 = d1 * ${s} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}},18954:(t,e,n)=>{"use strict";n.d(e,{I:()=>r,S:()=>i});class r{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const o=t.padInfo.top,a=t.padInfo.left,s=t.strideHeight,u=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,c=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),p=t.inChannels%4,g="channelsLast"===t.dataFormat,m=g?1:2,x=g?2:3,y=g?3:1;let v="",w="";n&&(v=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,w="result = activation(result);");const b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${v}\n\n      const ivec2 strides = ivec2(${s}, ${u});\n      const ivec2 pads = ivec2(${o}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${y}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${m}], coords[${x}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${c}; wR++) {\n          int xR = xRCorner + wR * ${l};\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${d}; wC++) {\n            int xC = xCCorner + wC * ${h};\n\n            if (xC < 0 || xC >= ${t.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${f}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${g}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===p}) {\n\n              if (${g}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${f}) *\n                    getW(wR, wC, ${f}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${f}, xR, xC) *\n                    getW(wR, wC, ${f}, d2);\n              }\n\n            } else if (${2===p}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${f}, d2),\n                getW(wR, wC, ${f} + 1, d2)\n              );\n\n              if (${g}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${f}),\n                  getX(batch, xR, xC, ${f} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${f}, xR, xC),\n                  getX(batch, ${f} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===p}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${f}, d2),\n                getW(wR, wC, ${f} + 1, d2),\n                getW(wR, wC, ${f} + 2, d2)\n              );\n\n              if (${g}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${f}),\n                  getX(batch, xR, xC, ${f} + 1),\n                  getX(batch, xR, xC, ${f} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${f}, xR, xC),\n                  getX(batch, ${f} + 1, xR, xC),\n                  getX(batch, ${f} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${b}\n        ${w}\n        setOutput(result);\n      }\n    `}}class i{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,h=t.filterDepth,c=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),p=t.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${i}, ${o}, ${a});\n      const ivec3 pads = ivec3(${e}, ${n}, ${r});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${h}; wF++) {\n          int xF = xFCorner + wF * ${s};\n\n          if (xF < 0 || xF >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${c}; wR++) {\n            int xR = xRCorner + wR * ${u};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${d}; wC++) {\n              int xC = xCCorner + wC * ${l};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${f}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===p}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${f}) *\n                  getW(wF, wR, wC, ${f}, d2);\n              } else if (${2===p}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${f}),\n                  getX(batch, xF, xR, xC, ${f} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${f}, d2),\n                  getW(wF, wR, wC, ${f} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===p}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${f}),\n                  getX(batch, xF, xR, xC, ${f} + 1),\n                  getX(batch, xF, xR, xC, ${f} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${f}, d2),\n                  getW(wF, wR, wC, ${f} + 1, d2),\n                  getW(wF, wR, wC, ${f} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}},64364:(t,e,n)=>{"use strict";n.d(e,{J:()=>i});var r=n(16697);class i{constructor(t,e=!1,n=null,i=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=(0,r.C9)(this.outputShape.length);const a=t.filterHeight,s=t.filterWidth,u=t.outChannels/t.inChannels;let l="",h="";n&&(l=i?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:o?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,h="result = activation(result);");const c=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${l}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${u};\n        int q = d2 - d1 * ${u};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${a}; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${s}; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${c}\n        ${h}\n        setOutput(result);\n      }\n    `}}},92734:(t,e,n)=>{"use strict";n.d(e,{i:()=>o});var r=n(88478),i=n(16697);class o{constructor(t,e=!1,n=null,o=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=(0,i.C9)(this.outputShape.length);const s=t.padInfo.left,u=t.strideWidth,l=t.dilationWidth,h=t.filterHeight,c=t.filterWidth,d=c;let f="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;";for(let t=0;t<c;t++)f+=`\n           vec4 xTexelC${2*t};\n           int xTexelC${2*t}Ready;\n           vec4 xTexelC${2*t+1};\n           int xTexelC${2*t+1}Ready;\n           vec4 xC${t};`;f+=`\n     for (int r = 0; r < ${h}; r++) {\n      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {\n       `;for(let t=0;t<c;t++)f+=`\n           xTexelC${2*t} = vec4(0.0);\n           xTexelC${2*t}Ready = 0;\n           xTexelC${2*t+1} = vec4(0.0);\n           xTexelC${2*t+1}Ready = 0;\n           xC${t} = vec4(0.0);`;f+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(let e=0;e<(d+1)/2;e++){const n=2*e;if(f+=`\n           xC = xCCorner + ${n*l};\n           `,1===u){if(n<c&&(s%2==1?(f+=`\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n               `,f+=1===l&&n>0?`\n                 xC${n} = vec4(xTexelC${n-2}.zw, xTexelC${n}.xy);\n                 `:`\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC${n} = vec4(previous.zw, xTexelC${n}.xy);\n                   } else {\n                     xC${n} = vec4(0.0, 0.0, xTexelC${n}.xy);\n                   }\n                   `):f+=`\n                 if (xC >= 0 && xC < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 xC${n} = xTexelC${n};\n                 `,n+1<c)){const t=s%2==0?r.D5U.nearestLargerEven(l):l;l%2==0&&s%2==1||l%2!=0&&s%2!=1?(f+=`\n                   xCOffset = xC + imod(pads[1], 2) + ${t};\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                     xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC${n+1}.zw = vec2(0.0);\n                     }\n                     xTexelC${n+1}Ready = 1;\n                   }\n                   `,f+=l>1?`\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC${n+1} = vec4(previous.zw, xTexelC${n+1}.xy);\n                     } else {\n                      xC${n+1} = vec4(0.0, 0.0, xTexelC${n+1}.xy);\n                     }\n                     `:`\n                     xC${n+1} = vec4(xTexelC${n}.zw, xTexelC${n+1}.xy);\n                     `):f+=1===t?`\n                     xC${n+1} = xTexelC${n};\n                     `:`\n                     xCOffset = xC + ${t};\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                       xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC${n+1}.zw = vec2(0.0);\n                       }\n                       xTexelC${n+1}Ready = 1;\n                     }\n\n                     xC${n+1} = xTexelC${n+1};\n                     `}}else n<c&&(s%2==1?(f+=`\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${n+1}Ready == 0) {\n                   xTexelC${n+1} = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC${n+1}.zw = vec2(0.0);\n                   }\n                   xTexelC${n+1}Ready = 1;\n                 }\n\n                 xC${n} = vec4(xTexelC${n}.zw, xTexelC${n+1}.zw);\n               `,n+1<c&&(f+=`\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC${n+1} = vec4(xTexelC${n+1}.xy, final.xy);\n                 `)):(f+=`\n                 if(xC >= 0 && xC < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                   xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n+1}.zw = vec2(0.);\n                   }\n                   xTexelC${n+1}Ready = 1;\n                 }\n\n                 xC${n} = vec4(\n                   xTexelC${n}.xy, xTexelC${n+1}.xy);\n               `,n+1<c&&(f+=`\n                   xC${n+1} = vec4(xTexelC${n}.zw, xTexelC${n+1}.zw);\n                 `)));n<c&&(f+=`\n             wTexel = getW(r, ${n}, d1, d2);\n             dotProd += xC${n}.xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ${t.inChannels}) {\n               dotProd += xC${n}.yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           `,n+1<c&&(f+=`\n               wTexel = getW(r, ${n+1}, d1, d2);\n               dotProd += xC${n+1}.xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ${t.inChannels}) {\n                 dotProd += xC${n+1}.yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             `))}f+="\n     }\n   ",f+="\n     }\n   ",f+="\n     }\n   ";let p="",g="";n&&(p=o?`vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ${n}\n         }`:a?`vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ${n}\n         }`:`vec4 activation(vec4 x) {\n           ${n}\n         }`,g="result = activation(result);");const m=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n       ${p}\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ${f}\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ${m}\n         ${g}\n         setOutput(result);\n       }\n     `}}},31177:(t,e,n)=>{"use strict";n.d(e,{f:()=>o});var r=n(88478),i=n(16697);class o{constructor(t,e=!1,n=null,o=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=(0,i.C9)(this.outputShape.length);const s=t.outChannels/t.inChannels,u=t.padInfo.left,l=t.strideWidth,h=t.dilationWidth,c=t.filterHeight,d=t.filterWidth,f=d;let p="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let t=0;t<d;t++)p+=`\n          vec4 xTexelC${2*t};\n          int xTexelC${2*t}Ready;\n          vec4 xTexelC${2*t+1};\n          int xTexelC${2*t+1}Ready;\n          vec4 xC${t};`;p+=`\n    for (int r = 0; r < ${c}; r++) {\n      `;for(let t=0;t<d;t++)p+=`\n          xTexelC${2*t} = vec4(0.0);\n          xTexelC${2*t}Ready = 0;\n          xTexelC${2*t+1} = vec4(0.0);\n          xTexelC${2*t+1}Ready = 0;\n          xC${t} = vec4(0.0);`;p+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let t=0;t<(f+1)/2;t++){const e=2*t;if(p+=`\n          xC = xCCorner + ${e*h};\n          `,1===l){if(e<d&&(u%2==1?(p+=`\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n              `,p+=1===h&&e>0?`\n                xC${e} = vec4(xTexelC${e-2}.zw, xTexelC${e}.xy);\n                `:`\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC${e} = vec4(previous.zw, xTexelC${e}.xy);\n                  } else {\n                    xC${e} = vec4(0.0, 0.0, xTexelC${e}.xy);\n                  }\n                  `):p+=`\n                if (xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                xC${e} = xTexelC${e};\n                `,e+1<d)){const t=u%2==0?r.D5U.nearestLargerEven(h):h;h%2==0&&u%2==1||h%2!=0&&u%2!=1?(p+=`\n                  xCOffset = xC + imod(pads[1], 2) + ${t};\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                    xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC${e+1}.zw = vec2(0.0);\n                    }\n                    xTexelC${e+1}Ready = 1;\n                  }\n                  `,p+=h>1?`\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC${e+1} = vec4(previous.zw, xTexelC${e+1}.xy);\n                    } else {\n                     xC${e+1} = vec4(0.0, 0.0, xTexelC${e+1}.xy);\n                    }\n                    `:`\n                    xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.xy);\n                    `):p+=1===t?`\n                    xC${e+1} = xTexelC${e};\n                    `:`\n                    xCOffset = xC + ${t};\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                      xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC${e+1}.zw = vec2(0.0);\n                      }\n                      xTexelC${e+1}Ready = 1;\n                    }\n\n                    xC${e+1} = xTexelC${e+1};\n                    `}}else e<d&&(u%2==1?(p+=`\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${e+1}Ready == 0) {\n                  xTexelC${e+1} = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC${e+1}.zw = vec2(0.0);\n                  }\n                  xTexelC${e+1}Ready = 1;\n                }\n\n                xC${e} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n              `,e+1<d&&(p+=`\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC${e+1} = vec4(xTexelC${e+1}.xy, final.xy);\n                `)):(p+=`\n                if(xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                  xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e+1}.zw = vec2(0.);\n                  }\n                  xTexelC${e+1}Ready = 1;\n                }\n\n                xC${e} = vec4(\n                  xTexelC${e}.xy, xTexelC${e+1}.xy);\n              `,e+1<d&&(p+=`\n                  xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n                `)));e<d&&(p+=`\n            wTexel = getW(r, ${e}, d1, q);\n            dotProd += xC${e} * vec4(wTexel.xz, wTexel.xz);\n          `,e+1<d&&(p+=`\n              wTexel = getW(r, ${e+1}, d1, q);\n              dotProd += xC${e+1} * vec4(wTexel.xz, wTexel.xz);\n            `))}p+="\n    }\n  ",p+="\n      }\n    ";let g="",m="";n&&(g=o?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:a?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,m="result = activation(result);");const x=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${g}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${s};\n        int q = d2 - d1 * ${s};\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ${p}\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ${x}\n        ${m}\n        setOutput(result);\n      }\n    `}}},65120:(t,e,n)=>{"use strict";n.d(e,{A:()=>r});class r{constructor(t,e,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,s,u]=t,[l]=e,[h,c]=n;this.outputShape=[l,h,c,u];const d="bilinear"===r?1:0,[f,p]=[a-1+".0",s-1+".0"],[g,m,x]=h>1?[""+(a-1)/(h-1),"(y2-y1) * height_ratio",`y1*${f} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${f}`],[y,v,w]=c>1?[""+(s-1)/(c-1),"(x2-x1) * width_ratio",`x1*${p} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${p}`];this.userCode=`\n      const float height_ratio = float(${g});\n      const float width_ratio = float(${y});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${o}) {\n          return;\n        }\n\n        float height_scale = ${m};\n        float width_scale = ${v};\n\n        float in_y = ${x};\n        if( in_y < 0.0 || in_y > ${f} ) {\n          setOutput(float(${i}));\n          return;\n        }\n        float in_x = ${w};\n        if( in_x < 0.0 || in_x > ${p} ) {\n          setOutput(float(${i}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${d} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}},30330:(t,e,n)=>{"use strict";n.d(e,{Q:()=>r,Z:()=>o});var r,i=n(55156);!function(t){t.Prod="*",t.Sum="+"}(r||(r={}));class o{constructor(t,e,n,o){this.op=t,this.outputShape=e,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const u=this.outputShape.length,l=this.op===r.Prod?"1.0":"0.0",h=n?l:`getX(${a(u,"coords",this.op)})`,c=this.outputShape[this.outputShape.length-1];let d="",f="";n?(d=o?"end != "+(c-1):"end != 0",f=o?"end + 1":"end - 1"):(d=o?`end + pow2 < ${c}`:"end >= pow2",f=o?"end + pow2":"end - pow2"),this.userCode=`\n      void main() {\n        ${(0,i.kW)(u)} coords = getOutputCoords();\n        int end = ${s(u,"coords",this.op)};\n        float val = ${h};\n        int pow2 = int(pow(2.0, index));\n        if (${d}) {\n          int idx = ${f};\n          ${s(u,"coords",this.op)} = idx;\n          val ${this.op}= getX(${a(u,"coords",this.op)});\n        }\n        setOutput(val);\n      }\n    `}}function a(t,e,n){if(1===t)return`${e}`;if(2===t)return`${e}.x, ${e}.y`;if(3===t)return`${e}.x, ${e}.y, ${e}.z`;if(4===t)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function s(t,e,n){if(1===t)return`${e}`;if(2===t)return`${e}.y`;if(3===t)return`${e}.z`;if(4===t)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}},87033:(t,e,n)=>{"use strict";n.d(e,{h:()=>r});class r{constructor(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${e};\n      int offset_h = imod(h, ${e});\n      int in_w = w / ${e};\n      int offset_w = imod(w, ${e});\n      int offset_d = (offset_h * ${e} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}},76473:(t,e,n)=>{"use strict";n.d(e,{L:()=>r});class r{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}},93008:(t,e,n)=>{"use strict";n.d(e,{H:()=>r});class r{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:e,inWidth:n,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:s,dilationHeight:u,dilationWidth:l}=t,{top:h,left:c}=r;this.userCode=`\n      const ivec2 strides = ivec2(${i}, ${o});\n      const ivec2 pads = ivec2(${h}, ${c});\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ${a}; h++) {\n          int hIn = hBeg + h * ${u};\n\n          if (hIn >= 0 && hIn < ${e}) {\n            for (int w = 0; w < ${s}; w++) {\n              int wIn = wBeg + w * ${l};\n\n              if (wIn >= 0 && wIn < ${n}) {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    `}}},90615:(t,e,n)=>{"use strict";n.d(e,{O:()=>r});class r{constructor(t,e,n){this.variableNames=["real","imag"];const r=e[1];this.outputShape=e;const i=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=n?`${r}.0`:"1.0";let a;if("real"===t)a="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);a="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${i};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${a}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${r});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${r}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${o};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}},67137:(t,e,n)=>{"use strict";n.d(e,{o:()=>r});class r{constructor(t,e){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}},67079:(t,e,n)=>{"use strict";n.d(e,{i:()=>r});class r{constructor(t){this.variableNames=["Image"],this.outputShape=[];const e=t[2];this.outputShape=t,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${e} - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${e}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}},55795:(t,e,n)=>{"use strict";n.d(e,{S:()=>i});var r=n(55156);class i{constructor(t,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;const n=(0,r.kW)(this.rank),i=function(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let e=0;e<t.length;e++)2===e?r.push("index"):r.push(`${n[e]}`);return r.join()}(t);this.userCode=`\n      void main() {\n        ${n} resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;\n        setOutput(inBounds * getA(${i}));\n      }\n    `}}},78428:(t,e,n)=>{"use strict";n.d(e,{i:()=>i});var r=n(55156);class i{constructor(t,e,n,i){this.sliceDim=t,this.strides=e,this.paramsShape=i,this.variableNames=["x","indices"],this.outputShape=n;const o=(0,r.kW)(n.length);let a="\n    int index;";for(let t=0;t<this.sliceDim;t++)a+=`\n          index = round(getIndices(coords[0], ${t}));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[t]};\n          flattenIndex += index * ${this.strides[t]};`;this.userCode=`\n         void main() {\n          ${o} coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ${a}\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      `}}},29610:(t,e,n)=>{"use strict";n.d(e,{A:()=>i});var r=n(88478);function i(){let t,e,n,i,o,a,s,u,l,h;return 2===(0,r.OBj)().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",i="in",o="texture",a="outputColor",s="out vec4 outputColor;",u=(0,r.OBj)().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",l="",h="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",i="varying",o="texture2D",a="gl_FragColor",s="",u="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",l="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",h="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:i,texture2D:o,output:a,defineOutput:s,defineSpecialNaN:u,defineSpecialInf:l,defineRound:h}}},16697:(t,e,n)=>{"use strict";n.d(e,{C9:()=>c,IJ:()=>a,Yv:()=>s,_s:()=>l,mi:()=>h});var r=n(88478),i=n(55156),o=n(91906);function a(t,e,n,a){const u=n.map(((t,n)=>{const r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}})),l=u.map((t=>t.shapeInfo)),h={logicalShape:a.shape,texShape:a.texData.texShape,isUniform:!1,isPacked:a.texData.isPacked,flatOffset:null},c=i.Vm(u,h,e),d=(0,o.xc)(t.gl,c),f=t.createProgram(d);return(0,r.OBj)().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:d,source:c,webGLProgram:f,inShapeInfos:l,outShapeInfo:h,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:e,fragmentShader:d,source:c,webGLProgram:f,inShapeInfos:l,outShapeInfo:h},s(t,e,f))}function s(t,e,n){const i={},o={},a={},s=[];let u,l,h,c=null,d=null;d=t.getUniformLocation(n,"NAN",!1),1===(0,r.OBj)().getNumber("WEBGL_VERSION")&&(c=t.getUniformLocation(n,"INFINITY",!1));const f=!1;for(let r=0;r<e.variableNames.length;r++){const s=e.variableNames[r];i[s]=t.getUniformLocation(n,s,f),i[`offset${s}`]=t.getUniformLocation(n,`offset${s}`,f),e.enableShapeUniforms&&(o[`${s}Shape`]=t.getUniformLocation(n,`${s}Shape`,f),a[`${s}TexShape`]=t.getUniformLocation(n,`${s}TexShape`,f))}return e.enableShapeUniforms&&(u=t.getUniformLocation(n,"outShape",f),h=t.getUniformLocation(n,"outShapeStrides",f),l=t.getUniformLocation(n,"outTexShape",f)),e.customUniforms&&e.customUniforms.forEach(((e,r)=>{s[r]=t.getUniformLocation(n,e.name,f)})),{uniformLocations:i,customUniformLocations:s,infLoc:c,nanLoc:d,inShapesLocations:o,inTexShapesLocations:a,outShapeLocation:u,outShapeStridesLocation:h,outTexShapeLocation:l}}function u(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach(((t,n)=>{const i=t.logicalShape,o=e[n],a=o.shape;if(!r.D5U.arraysEqual(i,a))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${a} must match`);if(t.isUniform&&o.isUniform)return;const s=t.texShape,u=o.isUniform?null:o.texData.texShape;if(!r.D5U.arraysEqual(s,u))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${s} and ${u} must match`)}))}function l(t,e,n,o,a){e.program.enableShapeUniforms||(u(e.inShapeInfos,n),u([e.outShapeInfo],[o]));const s=o.texData.texture,l=o.texData.texShape;o.texData.isPacked?t.setOutputPackedMatrixTexture(s.texture,l[0],l[1]):t.setOutputMatrixTexture(s.texture,l[0],l[1]),t.setProgram(e.webGLProgram),1===(0,r.OBj)().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach(((n,o)=>{const a=e.program.variableNames[o],s=e.uniformLocations[a],u=e.uniformLocations[`offset${a}`],l=e.inShapesLocations[`${a}Shape`],h=e.inTexShapesLocations[`${a}TexShape`];if(l){const{uniformShape:r}=i.Tt(e.program.packedInputs,n.shape,n.texData.texShape);switch(r.length){case 1:t.gl.uniform1iv(l,new Int32Array(r));break;case 2:t.gl.uniform2iv(l,new Int32Array(r));break;case 3:t.gl.uniform3iv(l,new Int32Array(r));break;case 4:t.gl.uniform4iv(l,new Int32Array(r))}}if(h&&t.gl.uniform2i(h,n.texData.texShape[0],n.texData.texShape[1]),null!=s)if(n.isUniform)if(r.D5U.sizeFromShape(n.shape)<2)t.gl.uniform1f(s,n.uniformValues[0]);else{let e=n.uniformValues;e instanceof Float32Array||(e=new Float32Array(e)),t.gl.uniform1fv(s,e)}else null!=n.texData.slice&&null!=u&&t.gl.uniform1i(u,n.texData.slice.flatOffset),t.setInputMatrixTexture(n.texData.texture.texture,s,o)}));const h=e.outShapeLocation;if(h)switch(o.shape.length){case 1:t.gl.uniform1iv(h,new Int32Array(o.shape));break;case 2:t.gl.uniform2iv(h,new Int32Array(o.shape));break;case 3:t.gl.uniform3iv(h,new Int32Array(o.shape));break;case 4:t.gl.uniform4iv(h,new Int32Array(o.shape))}if(e.outShapeStridesLocation){const n=r.D5U.computeStrides(o.shape);switch(o.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(n));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(n));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(n))}}e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,o.texData.texShape[0],o.texData.texShape[1]),e.program.customUniforms&&a&&e.program.customUniforms.forEach(((n,r)=>{const i=e.customUniformLocations[r],o=a[r];if("float"===n.type)t.gl.uniform1fv(i,o);else if("vec2"===n.type)t.gl.uniform2fv(i,o);else if("vec3"===n.type)t.gl.uniform3fv(i,o);else if("vec4"===n.type)t.gl.uniform4fv(i,o);else if("int"===n.type)t.gl.uniform1iv(i,o);else if("ivec2"===n.type)t.gl.uniform2iv(i,o);else if("ivec3"===n.type)t.gl.uniform3iv(i,o);else{if("ivec4"!==n.type)throw Error(`uniform type ${n.type} is not supported yet.`);t.gl.uniform4iv(i,o)}})),t.executeProgram()}function h(t,e,n){let o="";e.concat(n).forEach((e=>{const a=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!e.isUniform){const s=e.texData.texShape,{useSqueezeShape:u,uniformShape:l,keptDims:h}=i.Tt(t.packedInputs,e.shape,s);let c="",d="",f="";if(1===l.length&&t.packedInputs){const t=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];c=`${t[0]>1}_${t[1]>1}`}else if(2!==l.length||t.packedInputs){if(l.length>2&&!t.packedInputs){const t=r.D5U.computeStrides(l);f=`${t[0]===s[1]}_${t[t.length-1]===s[1]}`}}else d=`${l[0]>1}_${l[1]>1}`;const p=e.shape.length,g=2===l.length&&r.D5U.arraysEqual(e.shape,s),m=1===r.D5U.sizeFromShape(e.shape),x=r.Wap.getBroadcastDims(e.shape,n.shape),y=!t.packedInputs&&p===n.shape.length&&r.D5U.arraysEqual(s,n.texData.texShape),v=t.packedInputs||l.length>2?"":`${s[0]>1}_${s[1]>1}`;o+=`${p}_${y}_${u?h:""}_${l.length}_${m}_${x}_${g}_${c}_${d}_${f}_${v}_${a}`}else{const t=e.isUniform?"uniform":e.texData.texShape;o+=`${e.shape}_${t}_${a}`}}));const a=t.userCode;let s=t.constructor.name;return s+="_"+o+"_"+a+`${(0,r.OBj)().getNumber("WEBGL_VERSION")}`,s}function c(t){return(0,r.OBj)().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}},4328:(t,e,n)=>{"use strict";n.d(e,{A8:()=>E,AD:()=>I,BQ:()=>m,Cs:()=>w,HC:()=>R,Hb:()=>l,Hc:()=>b,Jj:()=>s,NQ:()=>g,P1:()=>O,Qr:()=>T,T2:()=>d,Uk:()=>C,Y3:()=>u,cU:()=>y,ez:()=>S,gl:()=>x,hf:()=>v,iN:()=>p,m8:()=>f,q3:()=>c});var r=n(88478),i=n(29610),o=n(18378),a=n(91906);function s(t){const e=(0,i.A)(),n=`${e.version}\n    precision highp float;\n    ${e.attribute} vec3 clipSpacePos;\n    ${e.attribute} vec2 uv;\n    ${e.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`;return a.Jj(t,n)}function u(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return a.ED(t,e)}function l(t){const e=new Uint16Array([0,1,2,2,1,3]);return a.mZ(t,e)}function h(t,e,n,i,o,s){a.b6(e,n);const u=a.cU(t),l=t.TEXTURE_2D;return a.O7(t,(()=>t.bindTexture(l,u))),a.O7(t,(()=>t.texParameteri(l,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE))),a.O7(t,(()=>t.texParameteri(l,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE))),a.O7(t,(()=>t.texParameteri(l,t.TEXTURE_MIN_FILTER,t.NEAREST))),a.O7(t,(()=>t.texParameteri(l,t.TEXTURE_MAG_FILTER,t.NEAREST))),1===(0,r.OBj)().getNumber("WEBGL_VERSION")?a.O7(t,(()=>t.texImage2D(l,0,i,e,n,0,o,s,null))):a.O7(t,(()=>t.texStorage2D(l,1,i,e,n))),a.O7(t,(()=>t.bindTexture(t.TEXTURE_2D,null))),{texture:u,texShape:[n,e]}}function c(t){return t.internalFormatFloat}function d(t,e,n,r){const[i,a]=o.kk(e,n);return h(t,i,a,c(r),r.textureFormatFloat,t.FLOAT)}function f(t){return t.internalFormatHalfFloat}function p(t,e,n,r){const[i,a]=o.kk(e,n);return h(t,i,a,f(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function g(t){return t.downloadTextureFormat}function m(t,e,n,r){const[i,a]=o.kk(e,n);return h(t,i,a,g(r),t.RGBA,t.UNSIGNED_BYTE)}function x(t){return t.internalFormatPackedFloat}function y(t,e,n,r){const[i,a]=o.qe(e,n);return h(t,i,a,x(r),t.RGBA,t.FLOAT)}function v(t){return t.internalFormatPackedHalfFloat}function w(t,e,n,r){const[i,a]=o.qe(e,n);return h(t,i,a,v(r),t.RGBA,r.textureTypeHalfFloat)}function b(t,e,n){return a.O7(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n))),a.sb(t,e,"clipSpacePos",n,3,20,0)&&a.sb(t,e,"uv",n,2,20,12)}function C(t,e,n,i,o,s){let u,l,h;a.O7(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),o instanceof Uint8Array?(u=new Uint8Array(n*i*4),l=t.UNSIGNED_BYTE,h=t.RGBA):(u=new Float32Array(n*i*4),l=t.FLOAT,h=s.internalFormatPackedFloat),u.set(o),2===(0,r.OBj)().getNumber("WEBGL_VERSION")?a.O7(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,i,t.RGBA,l,u))):a.O7(t,(()=>t.texImage2D(t.TEXTURE_2D,0,h,n,i,0,t.RGBA,l,u))),a.O7(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}function T(t,e,n){a.O7(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),n.data instanceof Uint8Array?2===(0,r.OBj)().getNumber("WEBGL_VERSION")?a.O7(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data))):a.O7(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data))):2===(0,r.OBj)().getNumber("WEBGL_VERSION")?a.O7(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n))):a.O7(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n))),a.O7(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}function E(t,e,n,r){const i=t.createBuffer();a.O7(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,i)));const o=16*e*n;return a.O7(t,(()=>t.bufferData(t.PIXEL_PACK_BUFFER,o,t.STREAM_READ))),a.O7(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0))),a.O7(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null))),i}function S(t,e,n){const r=t,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function R(t,e,n,r){const[i,s]=o.kk(e,n),u=new Uint8Array(o.yb(e*n,4));return a.O7(t,(()=>t.readPixels(0,0,i,s,r.downloadTextureFormat,t.UNSIGNED_BYTE,u))),new Float32Array(u.buffer)}function I(t,e,n,r,i,a,s,u){const l=t,h=new Float32Array(o.Se(a,s));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,h),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),h}function O(t,e,n){const r=new Float32Array(e*n*4);return a.O7(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,r))),r}},77129:(t,e,n)=>{"use strict";n.d(e,{l:()=>o});var r=n(29610),i=n(16697);class o{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=(0,i.C9)(this.outputShape.length);const{dataFormat:n}=e,o=(0,r.A)(),a="channelsLast"===n,s=a?1:2,u=a?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`;let h="";for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)h+=`\n          blockIndex = rc.z + ${e};\n          pos = rc.y + ${t};\n\n          ${l}\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[${s}] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[${u}] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (${a}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*t+e}] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*t+e}] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${h}\n\n        ${o.output} = result;\n      }\n    `}}},38795:(t,e,n)=>{"use strict";var r=n(88478),i=n(91906);const o=(0,r.OBj)();o.registerFlag("HAS_WEBGL",(()=>o.getNumber("WEBGL_VERSION")>0)),o.registerFlag("WEBGL_VERSION",(()=>(0,i.uH)(2)?2:(0,i.uH)(1)?1:0)),o.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),o.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===o.get("WEBGL_VERSION"))),o.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),o.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),o.registerFlag("WEBGL_PACK",(()=>o.getBool("HAS_WEBGL"))),o.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_PACK_CLIP",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_PACK_REDUCE",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_LAZILY_UNPACK",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_CONV_IM2COL",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>(0,i.lo)(o.getNumber("WEBGL_VERSION")))),o.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>(0,i.KP)(o.getNumber("WEBGL_VERSION")))),o.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const t=o.getNumber("WEBGL_VERSION");return 0===t?0:(0,i.nr)(t)})),o.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>o.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!r.C2$.isMobile())),o.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>(0,i.wb)(o.getNumber("WEBGL_VERSION")))),o.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!o.getBool("WEBGL_FORCE_F16_TEXTURES")&&o.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),o.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>(0,i.BH)(o.getNumber("WEBGL_VERSION")))),o.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>(0,i.Qd)(o.getNumber("WEBGL_VERSION")))),o.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>o.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),o.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)})),o.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>r.C2$.isMobile()?1:-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)})),o.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128)),o.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(()=>!1)),o.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e5)),o.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(()=>128)),o.registerFlag("WEBGL_EXP_CONV",(()=>!1)),o.registerFlag("SOFTWARE_WEBGL_ENABLED",(()=>o.getBool("IS_TEST"))),o.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(()=>1/0)),o.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(()=>!1)),o.registerFlag("WEBGL2_ISNAN_CUSTOM",(()=>!1)),o.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));var a=n(90740),s=n(29610),u=n(16697),l=n(38110),h=n(18378);class c{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=h.m1.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=(0,s.A)();this.outputShape=t,this.enableShapeUniforms=(0,u.C9)(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?l.Kn(["r","c","d"],t):l.RW(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${e.output} = result;\n      }\n    `}}class d{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=h.m1.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=(0,s.A)();this.outputShape=t,this.enableShapeUniforms=(0,u.C9)(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?l.Kn(["r","c","d"],t):l.RW(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${e.output} = result;\n      }\n    `}}class f{constructor(t){this.variableNames=["A"],this.outTexUsage=h.v2.DOWNLOAD;const e=(0,s.A)();this.outputShape=t,this.userCode=`\n      ${l.ye}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${e.output} = encode_float(x);\n      }\n    `}}class p{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=h.v2.DOWNLOAD;const e=(0,s.A)();this.outputShape=t,this.userCode=`\n      ${l.ye}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${e.output} = encode_float(x);\n      }\n    `}}const g={R:0,G:1,B:2,A:3};class m{constructor(t,e=!1,n="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=(0,s.A)();this.outputShape=t,this.enableShapeUniforms=(0,u.C9)(this.outputShape.length);let i="result";e&&(i="floor(result * 255. + 0.5)");let o="";for(let t=0;t<n.length;t++){const e=n[t];o+=`\n          if(offset == ${t}) {\n            result = values[${g[e]}];\n          }`}this.userCode=`\n      ${this.enableShapeUniforms?l.nc():l.ku(t)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ${n.length});\n\n        flatIndex = idiv(flatIndex, ${n.length}, 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ${r.texture2D}(A, uv);\n          ${o}\n        }\n        ${r.output} = vec4(${i}, 0., 0., 0.);\n      }\n    `}}class x{constructor(t,e=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=(0,s.A)();this.outputShape=t,this.enableShapeUniforms=(0,u.C9)(this.outputShape.length);let r="",i="result";e&&(i="floor(result * 255. + 0.5)");for(let e=0;e<=1;e++)for(let i=0;i<=1;i++){const o=2*e+i;r+=`\n          localCoords = coords;\n          if(localCoords[2] + ${i} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {\n          localCoords[2] += ${i};\n          if (localCoords[1] + ${e} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {\n            localCoords[1] += ${e};\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ${n.texture2D}(A, uv);\n\n            if (offset == 0) {\n              result[${o}] = values[0];\n            } else if (offset == 1) {\n              result[${o}] = values[1];\n            } else if (offset == 2) {\n              result[${o}] = values[2];\n            } else {\n              result[${o}] = values[3];\n            }\n          }\n        }\n        `}this.userCode=`\n        ${this.enableShapeUniforms?l.nc():l.ku(t)}\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ${r}\n\n          ${n.output} = ${i};\n        }\n    `}}var y=n(4328);class v{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const e=(0,r.OBj)().getNumber("WEBGL_VERSION");if(null!=t?(this.gl=t,(0,a.nd)(e,t)):this.gl=(0,a.jl)(e),t=this.gl,2===(0,r.OBj)().getNumber("WEBGL_VERSION")){const e=t;this.createVertexArray=()=>i.O7(e,(()=>e.createVertexArray())),this.bindVertexArray=t=>i.O7(e,(()=>e.bindVertexArray(t))),this.deleteVertexArray=t=>i.O7(e,(()=>e.deleteVertexArray(t))),this.getVertexArray=()=>i.O7(e,(()=>e.getParameter(e.VERTEX_ARRAY_BINDING)))}else if(null!=t){const e=t.getExtension("OES_vertex_array_object");if(null==e)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>i.O7(t,(()=>e.createVertexArrayOES())),this.bindVertexArray=n=>i.O7(t,(()=>e.bindVertexArrayOES(n))),this.deleteVertexArray=n=>i.O7(t,(()=>e.deleteVertexArrayOES(n))),this.getVertexArray=()=>i.O7(t,(()=>t.getParameter(e.VERTEX_ARRAY_BINDING_OES)))}let n="WEBGL_color_buffer_float";const o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===(0,r.OBj)().getNumber("WEBGL_VERSION")){const t="OES_texture_float",e="OES_texture_half_float";if(this.textureFloatExtension=i.HH(this.gl,t),i.y_(this.gl,e))this.textureHalfFloatExtension=i.HH(this.gl,e);else if((0,r.OBj)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),i.y_(this.gl,o))this.colorBufferHalfFloatExtension=i.HH(this.gl,o);else if((0,r.OBj)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",i.y_(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!i.y_(this.gl,o))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(o)}this.vertexBuffer=y.Y3(this.gl),this.indexBuffer=y.Hb(this.gl),this.framebuffer=i.d8(this.gl),this.textureConfig=h.Sq(this.gl,this.textureHalfFloatExtension)}get debug(){return(0,r.OBj)().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;i.O7(t,(()=>t.finish())),i.O7(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,null))),i.O7(t,(()=>t.deleteFramebuffer(this.framebuffer))),i.O7(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,null))),i.O7(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null))),i.O7(t,(()=>t.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),y.T2(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),y.iN(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),y.BQ(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),y.Qr(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,n,r){this.throwIfDisposed(),y.Uk(this.gl,t,e,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),y.Cs(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),y.cU(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(i.ax(this.gl,this.framebuffer),this.outputTexture=null),i.O7(this.gl,(()=>this.gl.deleteTexture(t)))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>y.HC(this.gl,e,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(t,e,n,r,i,o){return y.AD(this.gl,t,e,n,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,e){return y.ez(this.gl,t,e)}createBufferFromTexture(t,e,n){this.bindTextureToFrameBuffer(t);const r=y.A8(this.gl,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,n;if((0,r.OBj)().getBool("WEBGL_FENCE_API_ENABLED")){const r=t,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=()=>{const t=r.clientWaitSync(i,0,0);return t===r.ALREADY_SIGNALED||t===r.CONDITION_SATISFIED},e=i}else(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(e,(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:e,isFencePassed:n}}downloadMatrixFromPackedTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>y.P1(this.gl,e,n)))}createProgram(t){this.throwIfDisposed();const e=this.gl;null==this.vertexShader&&(this.vertexShader=y.Jj(e));const n=i.HO(e);let r;return i.O7(e,(()=>e.attachShader(n,this.vertexShader))),i.O7(e,(()=>e.attachShader(n,t))),i.aj(e,n),r=Object.assign(n,{vao:this.createVertexArray()}),this.bindVertexArray(r.vao),i.O7(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer))),console.assert(y.Hc(e,r,this.vertexBuffer),"gpgpu_util.bindVertexProgramAttributeStreams not fully successful."),this.debug&&i.vu(e,r),this.setProgram(r),r}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&(i.O7(this.gl,(()=>this.gl.deleteProgram(t))),this.deleteVertexArray(t.vao))}setProgram(t){this.throwIfDisposed(),this.program=t,null!=this.program&&(this.bindVertexArray(this.program.vao),this.debug&&i.vu(this.gl,this.program)),i.O7(this.gl,(()=>this.gl.useProgram(t)))}getUniformLocation(t,e,n=!0){return this.throwIfDisposed(),n?i.XE(this.gl,t,e):i.Hg(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),i.O7(this.gl,(()=>this.gl.getAttribLocation(t,e)))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),i.B(this.gl,t,e,n)}setOutputMatrixTexture(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)}setOutputPackedMatrixTexture(t,e,n){this.throwIfDisposed();const[r,i]=h.qe(e,n);this.setOutputMatrixTextureDriver(t,r,i)}setOutputMatrixWriteRegion(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)}setOutputPackedMatrixWriteRegion(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&i.vu(this.gl,this.program),i.cu(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}i.O7(t,(()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),i.O7(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=i.HH(this.gl,2===(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}const t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(2===(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2();return void t.endQuery(e.TIME_ELAPSED_EXT)}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await r.D5U.repeatedTry((()=>this.disposed||this.isQueryAvailable(t,(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(t,(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,e){if(0===e)return null;if(2===e){const e=this.gl;return e.getQueryParameter(t,e.QUERY_RESULT)/1e6}{const e=this.getQueryTimerExtensionWebGL1();return e.getQueryObjectEXT(t,e.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,e){if(0===e)return!0;if(2===e){const e=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const e=this.getQueryTimerExtensionWebGL1(),n=e.getQueryObjectEXT(t,e.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(e.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(t){return new Promise((e=>{this.addItemToPoll((()=>t.isFencePassed()),(()=>e()))}))}pollItems(){const t=function(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}(this.itemsToPoll.map((t=>t.isDoneFn)));for(let e=0;e<=t;++e){const{resolveFn:t}=this.itemsToPoll[e];t()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in(0,r.OBj)().platform&&(n=(0,r.OBj)().platform.setTimeoutCustom.bind((0,r.OBj)().platform)),r.D5U.repeatedTry((()=>(this.pollItems(),0===this.itemsToPoll.length)),(()=>0),null,n)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),i.JG(this.gl,t,this.framebuffer),this.debug&&i.cu(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(i.JG(this.gl,this.outputTexture,this.framebuffer),this.debug&&i.cu(this.gl)):i.ax(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);const n=e();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(t,e,n){this.throwIfDisposed();const r=this.gl;i.JG(r,t,this.framebuffer),this.debug&&i.cu(r),this.outputTexture=t,i.O7(r,(()=>r.viewport(0,0,e,n))),i.O7(r,(()=>r.scissor(0,0,e,n)))}setOutputMatrixWriteRegionDriver(t,e,n,r){this.throwIfDisposed(),i.O7(this.gl,(()=>this.gl.scissor(t,e,n,r)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}var w=n(64272),b=n(55667),C=n(28831),T=n(42490),E=n(84518),S=n(29365),R=n(84595);const I=r.GDt.ZA,O={},_=(0,r.OBj)().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class A extends r.Zuw{constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!(0,r.OBj)().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let e;if(null!=t){if(t instanceof v)e=t;else{const n=(0,a.jl)((0,r.OBj)().getNumber("WEBGL_VERSION"),t);e=new v(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const t=(0,a.jl)((0,r.OBj)().getNumber("WEBGL_VERSION"));e=new v(t),this.binaryCache=((n=(0,r.OBj)().getNumber("WEBGL_VERSION"))in O||(O[n]={}),O[n]),this.gpgpuCreatedLocally=!0}var n;this.gpgpu=e,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new T.I(this.gpgpu),this.numMBBeforeWarning=null==(0,r.OBj)().global.screen?1024:(0,r.OBj)().global.screen.height*(0,r.OBj)().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new r.JLz(this,(0,r.SRH)())}nextDataId(){return A.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,e,n,r,o,a){const s=this.makeTensorInfo(e,n),u=this.texData.get(s.dataId);u.isPacked=!1,u.texture={texture:t,texShape:[r,o]},u.texShape=[r,o];const l=i.ih(e),h=new m(l,!1,a),c=this.runWebGLProgram(h,[s],n,[[r,o]]);return c.shape=e,u.texture=null,this.disposeIntermediateTensorInfo(s),c.dataId}write(t,e,n){if(((0,r.OBj)().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||(0,r.OBj)().getBool("DEBUG"))&&this.checkNumericalProblems(t),"complex64"===n&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:e,dtype:n,values:t,usage:h.v2.UPLOAD,refCount:1}),i}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){this.texData.get(t).refCount++}decRef(t){this.texData.has(t)&&this.texData.get(t).refCount--}move(t,e,n,i,o){if((0,r.OBj)().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===i)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:n,dtype:i,values:e,usage:h.v2.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const e=this.texData.get(t),{values:n,dtype:i,complexTensorInfos:o,slice:a,shape:s,isPacked:u}=e;if(null!=a){let e;e=u?new S.cc(s,E.bl):new E.l(s,E.bl);const n=this.runWebGLProgram(e,[{dataId:t,shape:s,dtype:i}],i),r=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),r}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===i)return n;const l=null!=this.activeTimers;let h,c;if(l&&(h=r.D5U.now()),"complex64"===i){const t=this.readSync(o.real.dataId),e=this.readSync(o.imag.dataId);c=r.Wap.mergeRealAndImagArrays(t,e)}else c=this.getValuesFromTexture(t);return l&&(this.downloadWaitMs+=r.D5U.now()-h),this.convertAndCacheOnCPU(t,c)}async read(t){if(this.pendingRead.has(t)){const e=this.pendingRead.get(t);return new Promise((t=>e.push(t)))}const e=this.texData.get(t),{values:n,shape:o,slice:a,dtype:s,complexTensorInfos:u,isPacked:l}=e;if(null!=a){let e;e=l?new S.cc(o,E.bl):new E.l(o,E.bl);const n=this.runWebGLProgram(e,[{dataId:t,shape:o,dtype:s}],s),r=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),r}if(null!=n)return this.convertAndCacheOnCPU(t);if((0,r.OBj)().getBool("DEBUG")&&!(0,r.OBj)().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===(0,r.OBj)().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c,d,f=null;if("complex64"!==s&&(0,r.OBj)().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(t);const e=this.texData.get(c.dataId);f=this.gpgpu.createBufferFromTexture(e.texture.texture,...h.Yz(o))}if(this.pendingRead.set(t,[]),"complex64"!==s&&await this.gpgpu.createAndWaitForFence(),"complex64"===s){const t=await Promise.all([this.read(u.real.dataId),this.read(u.imag.dataId)]),e=t[0],n=t[1];d=r.Wap.mergeRealAndImagArrays(e,n)}else if(null==f)d=this.getValuesFromTexture(t);else{const t=r.D5U.sizeFromShape(o);d=this.gpgpu.downloadFloat32MatrixFromBuffer(f,t)}if(null!=c&&this.disposeIntermediateTensorInfo(c),null!=f){const t=this.gpgpu.gl;i.O7(t,(()=>t.deleteBuffer(f)))}const p=this.convertAndCacheOnCPU(t,d),g=this.pendingRead.get(t);return this.pendingRead.delete(t),g.forEach((t=>t(p))),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&(0,r.SRH)().removeDataId(t,this),this.pendingDeletes--),p}readToGPU(t,e={}){const n=this.texData.get(t),{values:i,shape:o,slice:a,dtype:s,isPacked:u,texture:l}=n;if("complex64"===s)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=a){let n;n=u?new S.cc(o,E.bl):new E.l(o,E.bl);const r=this.runWebGLProgram(n,[{dataId:t,shape:o,dtype:s}],s),i=this.readToGPU(r,e);return this.disposeIntermediateTensorInfo(r),i}if(null==l)throw null!=i?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const h=this.decode(t,e.customTexShape),c=(0,r.SRH)().makeTensorFromTensorInfo(h),d=this.texData.get(h.dataId);return Object.assign({tensorRef:c},d.texture)}bufferSync(t){const e=this.readSync(t.dataId);if("string"===t.dtype)try{const n=e.map((t=>r.D5U.decodeString(t)));return(0,r.f3b)(t.shape,t.dtype,n)}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return(0,r.f3b)(t.shape,t.dtype,e)}checkNumericalProblems(t){if(null!=t)for(let e=0;e<t.length;e++){const n=t[e];if(!i.qF(n)){if((0,r.OBj)().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(t){const{shape:e,dtype:n,isPacked:o}=this.texData.get(t),a=r.D5U.sizeFromShape(e);if((0,r.OBj)().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(t),r=this.texData.get(n.dataId),i=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...h.Yz(e)).subarray(0,a);return this.disposeIntermediateTensorInfo(n),i}const s=(0,r.OBj)().getBool("WEBGL_PACK")&&!0===o,u=s?i.ih(e):e,l=s?new p(u):new f(u),c=this.runWebGLProgram(l,[{shape:u,dtype:n,dataId:t}],"float32"),d=this.texData.get(c.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(c),g}timerAvailable(){return(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const e=this.activeTimers,n=[];let i=!1;null==this.programTimersStack?(this.programTimersStack=n,i=!0):this.activeTimers.push(n),this.activeTimers=n,t();const o=r.D5U.flatten(this.activeTimers.map((t=>t.query))).filter((t=>null!=t)),a=r.D5U.flatten(this.activeTimers.map((t=>t.name))).filter((t=>null!=t));this.activeTimers=e,i&&(this.programTimersStack=null);const s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if((0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const t=await Promise.all(o);s.kernelMs=r.D5U.sum(t),s.getExtraProfileInfo=()=>t.map(((t,e)=>({name:a[e],ms:t}))).map((t=>`${t.name}: ${t.ms}`)).join(", ")}else s.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,s})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:r.D5U.now(),endMs:null}}endTimer(t){return(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=r.D5U.now(),t)}async getQueryTime(t){if((0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const e=t;return e.endMs-e.startMs}disposeData(t,e=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(e?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!e&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:n}=this.texData.get(t);return null!=n&&(this.disposeData(n.real.dataId,e),this.disposeData(n.imag.dataId,e)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:e,dtype:n,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(t),s=a&&a.origDataId||t,u=this.dataRefCount.get(s);u>1?this.dataRefCount.set(s,u-1):(this.dataRefCount.delete(s),null!=e&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(e,r,i,o)));const l=this.texData.get(t);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,e=_){return(0,r.OBj)().getBool("WEBGL_CPU_FORWARD")&&t.every((t=>null==this.texData.get(t.dataId).texture&&r.D5U.sizeFromShape(t.shape)<e))}getGPGPUContext(){return this.gpgpu}where(t){r.Wap.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const e=t.dataSync();return I(t.shape,e)}packedUnaryOp(t,e,n){const i=new S.cc(t.shape,e),o=this.compileAndRun(i,[t],n);return(0,r.SRH)().makeTensorFromTensorInfo(o)}abs(t){if(this.shouldExecuteOnCPU([t])&&"complex64"!==t.dtype){const e=(0,w.CJ)(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,e)}if((0,r.OBj)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,E.Et,t.dtype);const e=new E.l(t.shape,E.Et),n=this.compileAndRun(e,[t]);return(0,r.SRH)().makeTensorFromTensorInfo(n)}makeTensorInfo(t,e,n){let i;if("string"===e&&null!=n&&n.length>0&&r.D5U.isString(n[0])){const o=n.map((t=>r.D5U.encodeString(t)));i=this.write(o,t,e)}else i=this.write(n,t,e);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:e}}makeOutput(t,e,n){return(0,r.SRH)().makeTensorFromTensorInfo(this.makeTensorInfo(t,e,n),this)}unpackTensor(t){const e=new R.W(t.shape);return this.runWebGLProgram(e,[t],t.dtype)}packTensor(t){const e=new b.U(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)}packedReshape(t,e){const n=[i.Cp(t.shape),...i.W8(t.shape)],r={dtype:t.dtype,shape:n,dataId:t.dataId},o=[i.Cp(e),...i.W8(e)],a=new C.v(o,n),s=[n],u=this.runWebGLProgram(a,[r],t.dtype,s,!0);return{dataId:u.dataId,shape:e,dtype:u.dtype}}decode(t,e){const n=this.texData.get(t),{isPacked:o,shape:a,dtype:s}=n;if(null!=e){const t=r.D5U.sizeFromShape(a),n=e[0]*e[1]*4;r.D5U.assert(t<=n,(()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."))}const u=i.ih(a);let l;l=o?new d(u):new c(u);const f=[null!=e?e:h.Yz(u)];return{dtype:s,shape:a,dataId:this.runWebGLProgram(l,[{shape:u,dtype:s,dataId:t}],s,f,!0,e).dataId}}runWebGLProgram(t,e,n,o,a=!1,s){const l=this.makeTensorInfo(t.outputShape,n),c=this.texData.get(l.dataId);if(t.packedOutput&&(c.isPacked=!0),t.outPackingScheme===h.m1.DENSE){const e=null!=s?s:h.Yz(t.outputShape);c.texShape=e.map((t=>2*t))}if(null!=t.outTexUsage&&(c.usage=t.outTexUsage),0===r.D5U.sizeFromShape(l.shape))return c.values=r.D5U.getTypedArrayFromDType(l.dtype,0),l;const d=[],f=e.map((e=>{if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(e.dataId);if(null==n.texture){if(!t.packedInputs&&r.D5U.sizeFromShape(e.shape)<=(0,r.OBj)().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.packedInputs&&(n.isPacked=!0,n.shape=e.shape)}if(this.uploadToGPU(e.dataId),!!n.isPacked!=!!t.packedInputs)e=n.isPacked?this.unpackTensor(e):this.packTensor(e),d.push(e),n=this.texData.get(e.dataId);else if(n.isPacked&&!i.oT(n.shape,e.shape)){const t=e,r=e.shape;e.shape=n.shape,e=this.packedReshape(e,r),d.push(e),n=this.texData.get(e.dataId),t.shape=r}return{shape:e.shape,texData:n,isUniform:!1}}));this.uploadToGPU(l.dataId);const p={shape:l.shape,texData:c,isUniform:!1},g=u.mi(t,f,p),m=this.getAndSaveBinary(g,(()=>u.IJ(this.gpgpu,t,f,p))),x=null!=this.activeTimers;let y;x&&(y=this.startTimer()),(0,r.OBj)().get("ENGINE_COMPILE_ONLY")||u._s(this.gpgpu,m,f,p,o),d.forEach((t=>this.disposeIntermediateTensorInfo(t))),x&&(y=this.endTimer(y),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(y)}));const v=(0,r.OBj)().get("WEBGL_FLUSH_THRESHOLD");if(v>0){const t=r.D5U.now();t-this.lastGlFlushTime>v&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=t)}if(!(0,r.OBj)().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&!1===a){const t=this.unpackTensor(l);return this.disposeIntermediateTensorInfo(l),t}return l}compileAndRun(t,e,n,r,i=!1){return n=n||e[0].dtype,this.runWebGLProgram(t,e,n,r,i)}getAndSaveBinary(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||((0,r.OBj)().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=(0,r.lub)((()=>{if(!(0,r.OBj)().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=(0,r.OBj)().getBool("DEBUG");(0,r.OBj)().set("DEBUG",!1);const e=this.abs((0,r.iD$)(1e-8)).dataSync()[0];if((0,r.OBj)().set("DEBUG",t),e>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(t){const e=this.texData.get(t),{shape:n,dtype:o,values:a,texture:s,usage:u,isPacked:l}=e;if(null!=s)return;const c=null!=this.activeTimers;let d;c&&(d=r.D5U.now());let f=e.texShape;if(null==f&&(f=i.Yf(n,l),e.texShape=f),null!=a){const t=i.ih(n);let s,u=f[1],p=f[0];const g=a instanceof Uint8Array||a instanceof Uint8ClampedArray;!l&&g||([u,p]=h.qe(f[0],f[1])),s=l?new x(t,g):new m(t,g);const y=g?[p,u]:f,v=this.makeTensorInfo(y,o),w=this.texData.get(v.dataId);w.usage=g?h.v2.PIXELS:h.v2.UPLOAD,w.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),u,p,a);const b=[[p,u]],C=!0,T=this.runWebGLProgram(s,[v],o,b,C),E=this.texData.get(T.dataId);e.texShape=E.texShape,e.isPacked=E.isPacked,e.usage=E.usage,(0,r.OBj)().get("ENGINE_COMPILE_ONLY")?this.disposeData(T.dataId):(e.texture=E.texture,e.values=null,this.texData.delete(T.dataId)),this.disposeIntermediateTensorInfo(v),c&&(this.uploadWaitMs+=r.D5U.now()-d)}else{const t=this.acquireTexture(f,u,o,l);e.texture=t}}convertAndCacheOnCPU(t,e){const n=this.texData.get(t),{dtype:r}=n;return null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){const n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length);for(let e=0;e<n.length;++e)n[e]=Math.round(t[e]);return n}throw new Error(`Unknown dtype ${e}`)}(e,r)),n.values}acquireTexture(t,e,n,r){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const t=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${t} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,e,r)}computeBytes(t,e){return t[0]*t[1]*r.D5U.bytesPerElement(e)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,e]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(e));return Promise.all(t)}for(const[,e]of Object.entries(this.binaryCache)){const n=new Promise((t=>{try{this.checkCompletion_(e),t(!0)}catch(t){throw t}}));t.push(n)}return Promise.all(t)}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await(0,r.glt)(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(!1===this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw i.w4(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const[,t]of Object.entries(this.binaryCache)){const{uniformLocations:e,customUniformLocations:n,infLoc:r,nanLoc:i,inShapesLocations:o,inTexShapesLocations:a,outShapeLocation:s,outShapeStridesLocation:l,outTexShapeLocation:h}=(0,u.Yv)(this.gpgpu,t.program,t.webGLProgram);t.uniformLocations=e,t.customUniformLocations=n,t.infLoc=r,t.nanLoc=i,t.inShapesLocations=o,t.inTexShapesLocations=a,t.outShapeLocation=s,t.outShapeStridesLocation=l,t.outTexShapeLocation=h}}createTensorFromGPUData(t,e,n){t.channels=t.channels||"RGBA";const{texture:i,height:o,width:a,channels:s}=t,u=(0,r.SRH)().backend;if(!u.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=u.writeTexture(i,e,n,o,a,s);return(0,r.SRH)().makeTensorFromDataId(l,e,n,u)}}A.nextDataId=0;var $=n(25522);r.C2$.isBrowser()&&(0,r.jqO)("webgl",(()=>new A),2),$.kS,n(19665)},43720:t=>{t.exports=n;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function n(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function r(t){return!0===(t&&t.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var i={},o={};function a(t,e){var n,r,a;return e?(a=0<=(t>>>=0)&&t<256)&&(r=o[t])?r:(n=u(t,(0|t)<0?-1:0,!0),a&&(o[t]=n),n):(a=-128<=(t|=0)&&t<128)&&(r=i[t])?r:(n=u(t,t<0?-1:0,!1),a&&(i[t]=n),n)}function s(t,e){if(isNaN(t))return e?x:m;if(e){if(t<0)return x;if(t>=f)return C}else{if(t<=-p)return T;if(t+1>=p)return b}return t<0?s(-t,e).neg():u(t%d|0,t/d|0,e)}function u(t,e,r){return new n(t,e,r)}n.fromInt=a,n.fromNumber=s,n.fromBits=u;var l=Math.pow;function h(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return m;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return h(t.substring(1),e,n).neg();for(var i=s(l(n,8)),o=m,a=0;a<t.length;a+=8){var u=Math.min(8,t.length-a),c=parseInt(t.substring(a,a+u),n);if(u<8){var d=s(l(n,u));o=o.mul(d).add(s(c))}else o=(o=o.mul(i)).add(s(c))}return o.unsigned=e,o}function c(t,e){return"number"==typeof t?s(t,e):"string"==typeof t?h(t,e):u(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}n.fromString=h,n.fromValue=c;var d=4294967296,f=d*d,p=f/2,g=a(1<<24),m=a(0);n.ZERO=m;var x=a(0,!0);n.UZERO=x;var y=a(1);n.ONE=y;var v=a(1,!0);n.UONE=v;var w=a(-1);n.NEG_ONE=w;var b=u(-1,2147483647,!1);n.MAX_VALUE=b;var C=u(-1,-1,!0);n.MAX_UNSIGNED_VALUE=C;var T=u(0,-2147483648,!1);n.MIN_VALUE=T;var E=n.prototype;E.toInt=function(){return this.unsigned?this.low>>>0:this.low},E.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},E.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(T)){var e=s(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=s(l(t,6),this.unsigned),o=this,a="";;){var u=o.div(i),h=(o.sub(u.mul(i)).toInt()>>>0).toString(t);if((o=u).isZero())return h+a;for(;h.length<6;)h="0"+h;a=""+h+a}},E.getHighBits=function(){return this.high},E.getHighBitsUnsigned=function(){return this.high>>>0},E.getLowBits=function(){return this.low},E.getLowBitsUnsigned=function(){return this.low>>>0},E.getNumBitsAbs=function(){if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},E.isZero=function(){return 0===this.high&&0===this.low},E.eqz=E.isZero,E.isNegative=function(){return!this.unsigned&&this.high<0},E.isPositive=function(){return this.unsigned||this.high>=0},E.isOdd=function(){return 1==(1&this.low)},E.isEven=function(){return 0==(1&this.low)},E.equals=function(t){return r(t)||(t=c(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},E.eq=E.equals,E.notEquals=function(t){return!this.eq(t)},E.neq=E.notEquals,E.ne=E.notEquals,E.lessThan=function(t){return this.comp(t)<0},E.lt=E.lessThan,E.lessThanOrEqual=function(t){return this.comp(t)<=0},E.lte=E.lessThanOrEqual,E.le=E.lessThanOrEqual,E.greaterThan=function(t){return this.comp(t)>0},E.gt=E.greaterThan,E.greaterThanOrEqual=function(t){return this.comp(t)>=0},E.gte=E.greaterThanOrEqual,E.ge=E.greaterThanOrEqual,E.compare=function(t){if(r(t)||(t=c(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},E.comp=E.compare,E.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(y)},E.neg=E.negate,E.add=function(t){r(t)||(t=c(t));var e=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,a=t.high>>>16,s=65535&t.high,l=t.low>>>16,h=0,d=0,f=0,p=0;return f+=(p+=o+(65535&t.low))>>>16,d+=(f+=i+l)>>>16,h+=(d+=n+s)>>>16,h+=e+a,u((f&=65535)<<16|(p&=65535),(h&=65535)<<16|(d&=65535),this.unsigned)},E.subtract=function(t){return r(t)||(t=c(t)),this.add(t.neg())},E.sub=E.subtract,E.multiply=function(t){if(this.isZero())return m;if(r(t)||(t=c(t)),e)return u(e.mul(this.low,this.high,t.low,t.high),e.get_high(),this.unsigned);if(t.isZero())return m;if(this.eq(T))return t.isOdd()?T:m;if(t.eq(T))return this.isOdd()?T:m;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(g)&&t.lt(g))return s(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,i=65535&this.high,o=this.low>>>16,a=65535&this.low,l=t.high>>>16,h=65535&t.high,d=t.low>>>16,f=65535&t.low,p=0,x=0,y=0,v=0;return y+=(v+=a*f)>>>16,x+=(y+=o*f)>>>16,y&=65535,x+=(y+=a*d)>>>16,p+=(x+=i*f)>>>16,x&=65535,p+=(x+=o*d)>>>16,x&=65535,p+=(x+=a*h)>>>16,p+=n*f+i*d+o*h+a*l,u((y&=65535)<<16|(v&=65535),(p&=65535)<<16|(x&=65535),this.unsigned)},E.mul=E.multiply,E.divide=function(t){if(r(t)||(t=c(t)),t.isZero())throw Error("division by zero");var n,i,o;if(e)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?u((this.unsigned?e.div_u:e.div_s)(this.low,this.high,t.low,t.high),e.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?x:m;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return x;if(t.gt(this.shru(1)))return v;o=x}else{if(this.eq(T))return t.eq(y)||t.eq(w)?T:t.eq(T)?y:(n=this.shr(1).div(t).shl(1)).eq(m)?t.isNegative()?y:w:(i=this.sub(t.mul(n)),o=n.add(i.div(t)));if(t.eq(T))return this.unsigned?x:m;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();o=m}for(i=this;i.gte(t);){n=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(n)/Math.LN2),h=a<=48?1:l(2,a-48),d=s(n),f=d.mul(t);f.isNegative()||f.gt(i);)f=(d=s(n-=h,this.unsigned)).mul(t);d.isZero()&&(d=y),o=o.add(d),i=i.sub(f)}return o},E.div=E.divide,E.modulo=function(t){return r(t)||(t=c(t)),e?u((this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,t.low,t.high),e.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},E.mod=E.modulo,E.rem=E.modulo,E.not=function(){return u(~this.low,~this.high,this.unsigned)},E.and=function(t){return r(t)||(t=c(t)),u(this.low&t.low,this.high&t.high,this.unsigned)},E.or=function(t){return r(t)||(t=c(t)),u(this.low|t.low,this.high|t.high,this.unsigned)},E.xor=function(t){return r(t)||(t=c(t)),u(this.low^t.low,this.high^t.high,this.unsigned)},E.shiftLeft=function(t){return r(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?u(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):u(0,this.low<<t-32,this.unsigned)},E.shl=E.shiftLeft,E.shiftRight=function(t){return r(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?u(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):u(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},E.shr=E.shiftRight,E.shiftRightUnsigned=function(t){if(r(t)&&(t=t.toInt()),0==(t&=63))return this;var e=this.high;return t<32?u(this.low>>>t|e<<32-t,e>>>t,this.unsigned):u(32===t?e:e>>>t-32,0,this.unsigned)},E.shru=E.shiftRightUnsigned,E.shr_u=E.shiftRightUnsigned,E.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},E.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},E.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},E.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},E.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},n.fromBytes=function(t,e,r){return r?n.fromBytesLE(t,e):n.fromBytesBE(t,e)},n.fromBytesLE=function(t,e){return new n(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},n.fromBytesBE=function(t,e){return new n(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)}},36377:(t,e,n)=>{var r=n(84832),i=n(68652),o=n(90801),a=n(92030),s=n(3618),u=n(89049),l=n(51971);l.alea=r,l.xor128=i,l.xorwow=o,l.xorshift7=a,l.xor4096=s,l.tychei=u,t.exports=l},84832:function(t,e,n){var r;!function(t,i,o){function a(t){var e,n=this,r=(e=4022871197,function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}function s(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function u(t,e){var n=new a(t),r=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.alea=u}(0,t=n.nmd(t),n.amdD)},89049:function(t,e,n){var r;!function(t,i,o){function a(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function u(t,e){var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.tychei=u}(0,t=n.nmd(t),n.amdD)},68652:function(t,e,n){var r;!function(t,i,o){function a(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function u(t,e){var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.xor128=u}(0,t=n.nmd(t),n.amdD)},3618:function(t,e,n){var r;!function(t,i,o){function a(t){var e=this;e.next=function(){var t,n,r=e.w,i=e.X,o=e.i;return e.w=r=r+1640531527|0,n=i[o+34&127],t=i[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=i[o]=n^t,e.i=o,n+(r^r>>>16)|0},function(t,e){var n,r,i,o,a,s=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),i=0,o=-32;o<u;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(a=a+1640531527|0,i=0==(n=s[127&o]^=r+a)?i+1:0);for(i>=128&&(s[127&(e&&e.length||0)]=-1),i=127,o=512;o>0;--o)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;t.w=a,t.X=s,t.i=i}(e,t)}function s(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function u(t,e){null==t&&(t=+new Date);var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&(r.X&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.xor4096=u}(0,t=n.nmd(t),n.amdD)},92030:function(t,e,n){var r;!function(t,i,o){function a(t){var e=this;e.next=function(){var t,n,r=e.x,i=e.i;return t=r[i],n=(t^=t>>>7)^t<<24,n^=(t=r[i+1&7])^t>>>10,n^=(t=r[i+3&7])^t>>>3,n^=(t=r[i+4&7])^t<<7,t=r[i+7&7],n^=(t^=t<<13)^t<<9,r[i]=n,e.i=i+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function s(t,e){return e.x=t.x.slice(),e.i=t.i,e}function u(t,e){null==t&&(t=+new Date);var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&(r.x&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.xorshift7=u}(0,t=n.nmd(t),n.amdD)},90801:function(t,e,n){var r;!function(t,i,o){function a(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function u(t,e){var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.xorwow=u}(0,t=n.nmd(t),n.amdD)},51971:function(t,e,n){var r;!function(i,o,a){var s,u=256,l=a.pow(u,6),h=a.pow(2,52),c=2*h,d=255;function f(t,e,n){var r=[],d=x(m((e=1==e?{entropy:!0}:e||{}).entropy?[t,y(o)]:null==t?function(){try{var t;return s&&(t=s.randomBytes)?t=t(u):(t=new Uint8Array(u),(i.crypto||i.msCrypto).getRandomValues(t)),y(t)}catch(t){var e=i.navigator,n=e&&e.plugins;return[+new Date,i,n,i.screen,y(o)]}}():t,3),r),f=new p(r),v=function(){for(var t=f.g(6),e=l,n=0;t<h;)t=(t+n)*u,e*=u,n=f.g(1);for(;t>=c;)t/=2,e/=2,n>>>=1;return(t+n)/e};return v.int32=function(){return 0|f.g(4)},v.quick=function(){return f.g(4)/4294967296},v.double=v,x(y(f.S),o),(e.pass||n||function(t,e,n,r){return r&&(r.S&&g(r,f),t.state=function(){return g(f,{})}),n?(a.random=t,e):t})(v,d,"global"in e?e.global:this==a,e.state)}function p(t){var e,n=t.length,r=this,i=0,o=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);i<u;)a[i]=i++;for(i=0;i<u;i++)a[i]=a[o=d&o+t[i%n]+(e=a[i])],a[o]=e;(r.g=function(t){for(var e,n=0,i=r.i,o=r.j,a=r.S;t--;)e=a[i=d&i+1],n=n*u+a[d&(a[i]=a[o=d&o+e])+(a[o]=e)];return r.i=i,r.j=o,n})(u)}function g(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function m(t,e){var n,r=[],i=typeof t;if(e&&"object"==i)for(n in t)try{r.push(m(t[n],e-1))}catch(t){}return r.length?r:"string"==i?t:t+"\0"}function x(t,e){for(var n,r=t+"",i=0;i<r.length;)e[d&i]=d&(n^=19*e[d&i])+r.charCodeAt(i++);return y(e)}function y(t){return String.fromCharCode.apply(0,t)}if(x(a.random(),o),t.exports){t.exports=f;try{s=n(75042)}catch(t){}}else void 0===(r=function(){return f}.call(e,n,e,t))||(t.exports=r)}("undefined"!=typeof self?self:this,[],Math)}}]);